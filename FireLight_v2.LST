1			   1: ;*****************************************************
2			   2: ;Company :
3			   3: ;File Name : FireLight.asm
4			   4: ;Author :
5			   5: ;Create Data : 2015-12-16
6			   6: ;Last Modified : 2015-12-16
7			   7: ;Description :
8			   8: ;Version : 2.0
9			   9: ;*****************************************************
10			   
11			   11: LIST P=69P48
12			   12: ROMSIZE=4096
13			   
14			   14: ;*****************************************************
15			   15: ;系统寄存器 ($000 ~ $02F, $380 ~ $38C)
16			   16: ;*****************************************************
17			   17: IE		EQU	00H		;中断使能/禁能控制
18			   18: IRQ		EQU	01H		;中断请求标志
19			   
20			   20: TM0		EQU	02H		;Timer0 模式寄存器
21			   21: TM1		EQU	03H		;Timer1 模式寄存器
22			   
23			   23: TL0		EQU	04H		;Timer0 重载值低4位
24			   24: TH0		EQU	05H		;Timer0 重载值高4位
25			   
26			   26: TL1		EQU	06H		;Timer1 重载值低4位
27			   27: TH1		EQU	07H		;Timer1 重载值高4位
28			   
29			   29: PORTA		EQU	08H		;PortA 数据寄存器
30			   30: PORTB		EQU	09H		;PortB 数据寄存器
31			   31: PORTC		EQU	0AH		;PortC 数据寄存器
32			   32: PORTD		EQU	0BH		;PortD 数据寄存器
33			   33: PORTE		EQU	0CH		;PortE 数据寄存器
34			   
35			   35: 					;0DH Reserved
36			   36: 				
37			   37: TBR		EQU	0EH		;查表寄存器
38			   38: INX		EQU	0FH		;间接寻址伪索引寄存器
39			   39: DPL		EQU	10H		;INX数据指针低4位
40			   40: DPM		EQU	11H		;INX数据指针中4位
41			   41: DPH		EQU	12H		;INX数据指针高4位
42			   
43			   43: TCTL1		EQU	13H		;Timer1 控制寄存器
44			   
45			   45: ADCCTL		EQU	14H		;ADC 使能与参考电压
46			   46: ADCCFG		EQU	15H		;ADC configuration
47			   47: ADCPORT		EQU	16H		;ADC PORT CONFIGURATION
48			   48: ADCCHN		EQU	17H		;ADC channel selection
49			   
50			   50: PACR		EQU	18H		;PortA 控制寄存器
51			   51: PBCR		EQU	19H		;PortB 控制寄存器
52			   52: PCCR		EQU	1AH		;PortC 控制寄存器
53			   53: PDCR		EQU	1BH		;PortD 控制寄存器
54			   54: PECR		EQU	1CH		;PortE 控制寄存器
55			   
56			   56: 					;1DH Reserved
57			   57: 					
58			   58: WDT		EQU	1EH		;Whichdog timer control
59			   59: 					
60			   
61			   61: PWMC0		EQU	20H		;PWM0 控制寄存器
62			   62: PWMC1		EQU	21H		;PWM1 控制寄存器
63			   
64			   64: PWMP00		EQU	22H		;PWM0 周期控制寄存器低4位
65			   65: PWMP01		EQU	23H		;PWM0 周期控制寄存器高4位
66			   
67			   67: PWMD00		EQU	24H		;PWM0 占空比控制寄存器低2位
68			   68: PWMD01		EQU	25H		;PWM0 占空比控制寄存器中4位
69			   69: PWMD02		EQU	26H		;PWM0 占空比控制寄存器高4位
70			   
71			   71: PWMP10		EQU	27H		;PWM1 周期控制寄存器低4位
72			   72: PWMP11		EQU	28H		;PWM1 周期控制寄存器高4位
73			   
74			   74: PWMD10		EQU	29H		;PWM1 占空比控制寄存器低2位
75			   75: PWMD11		EQU	2AH		;PWM1 占空比控制寄存器中4位
76			   76: PWMD12		EQU	2BH		;PWM1 占空比控制寄存器高4位
77			   
78			   78: 					;2CH Reserved
79			   79: 					
80			   80: AD_RET0		EQU	2DH		;ADC 转换结果低2位
81			   81: AD_RET1		EQU	2EH		;ADC 转换结果中4位
82			   82: AD_RET2		EQU	2FH		;ADC 转换结果高4位
83			   
84			   
85			   85: PPACR 		EQU 	388H		;PORTA 口上拉电阻控制寄存器 
86			   86: PPBCR 		EQU 	389H		;PORTB 口上拉电阻控制寄存器 
87			   87: PPCCR 		EQU 	38AH		;PORTC 口上拉电阻控制寄存器 
88			   88: PPDCR 		EQU 	38BH		;PORTD 口上拉电阻控制寄存器 
89			   89: PPECR 		EQU 	38CH		;PORTE 口上拉电阻控制寄存器 
90			   
91			   
92			   92: ;*****************************************************
93			   93: ;用户自定义寄存器 ($030 ~ $0EF)
94			   94: ;*****************************************************
95			   95: ;Bank0
96			   96: ;------------------------------------------------------------------
97			   97: AC_BAK 		EQU 	30H 		;AC 值备份寄存器
98			   
99			   99: SYSTEM_STATE	EQU	31H		;bit 0:  0 - 主电状态(主电源正常),  1 - 应急状态(主电源停电)
100			   
101			   101: SELF_STATE	EQU	32H		;bit 0:  0 - 主电状态(主电源正常),  1 - 模拟应急状态(模拟主电源停电)
102			   102: 					;bit 1:  0 - 非月检状态,	         1 - 月检状态
103			   103: 					;bit 2:  0 - 非年检状态,	         1 - 年检状态
104			   104: 					;bit 3:  0 - 自动模式	         1 - 手动模式
105			   105: 					;注释:自动模式是指，bit 0 - bit 2 均为时间流逝或是停电导致系统进入的相应状态
106			   106: 					;手动模式是指，bit 0 - bit 2 均为通过持续不同时长的按键而导致系统进入的相应状态
107			   
108			   108: ALREADY_ENTER	EQU	33H		;bit 0:  0 - 当前并未开始充电,      1 - 当前已经开始充电
109			   109: 					;bit 1:  0 - 当前并未开始放电(应急),1 - 当前已经开始放电(应急)
110			   110: 					;bit 2:  0 - 当前并未进入手动月检,  1 - 当前已经进入手动月检状态
111			   111: 					;bit 3:  0 - 当前并未进入手动年检,  1 - 当前已经进入手动年检状态
112			   112: 				
113			   113: ; 用于TIMER 定时
114			   114: F_1S		EQU	35H		;bit0 = 1, 1s 到，用于计时应急时长
115			   115: 					
116			   116: F_TIME 		EQU 	36H 		;bit0 = 1, 1秒到; 
117			   117: 					;bit1 = 1, 1月到; 
118			   118: 					;bit2 = 1, 1年到; 
119			   119: 					;bit3 = 1, 1分钟到。
120			   
121			   121: CNT0_8MS 	EQU 	37H	 	;CNT1_8MS, CNT0_8MS组成的8BIT数据达到125时，即Timer0产生125次中断后，表示1S计时已到
122			   122: CNT1_8MS 	EQU 	38H 		;所以，初始化CNT1_8MS=07H, CNT0_8MS=0DH
123			   
124			   124: SEC_CNT0	EQU	39H		;SEC_CNT0/1/2 以秒为单位计时
125			   125: SEC_CNT1	EQU	3AH		;当数值达到1小时，即3600(E10H)秒时，向HOUR_CNT0/1进位，自身清零。
126			   126: SEC_CNT2	EQU	3BH
127			   
128			   128: HOUR_CNT0	EQU	3CH		;HOUR_CNT0/1 以小时为单位计时
129			   129: HOUR_CNT1	EQU	3DH		;当数值达到1月时，即744(2EBH)小时时，向MONTH_CNT0/1进位，同时置F_TIME.1，自身清零。
130			   130: HOUR_CNT2	EQU	3EH		
131			   
132			   132: MONTH_CNT	EQU	3FH		;MONTH_CNT0/1 以月为单位计时
133			   133: 					;当数值达到1年时，即12(0CH)月时，，同时置F_TIME.2，自身清零。
134			   
135			   135: TEMP_SUM_CY	EQU	40H		;AD子程序参数临时变量
136			   136: FLAG_OCCUPIED	EQU	41H		;bit0/1/2/3 = 1时分别表示CHN0、1、6、7的转换结果(CHN0_FINAL_RET1等)正被前台使用,
137			   137: 					;此时ADC中断不能修改这些数据。	
138			   
139			   139: FLAG_TYPE	EQU	42H		;bit0 = 1表示已经完成灯具类型选择(PORTB.3/AN7),此位为1后不再需要对AN7进行AD采样
140			   
141			   
142			   142: CMP_MIN_PWR0	EQU	43H		;上电自检时，灯具电源最小电压值.(1.396V -> 0x23B ->(丢弃最低2位) 0x8E)
143			   143: CMP_MIN_PWR1	EQU	44H		;
144			   
145			   145: CMP_TYPE00	EQU	45H		;灯具类型门限0
146			   146: CMP_TYPE01	EQU	46H		;
147			   
148			   148: CMP_TYPE10	EQU	47H		;灯具类型门限1
149			   149: CMP_TYPE11	EQU	48H		;
150			   
151			   151: CMP_TYPE20	EQU	49H		;灯具类型门限2
152			   152: CMP_TYPE21	EQU	4AH		;
153			   
154			   154: LIGHT_TYPE	EQU	4BH		;灯具类型
155			   155: 					;bit0 = 1, 锂电池，常亮型
156			   156: 					;bit1 = 1, 锂电池，常灭型
157			   157: 					;bit2 = 1, 镍镉电池，常亮型
158			   158: 					;bit3 = 1, 镍镉电池，常灭型
159			   
160			   160: CMP_SUPPLY0	EQU	4CH		;检测到电源电压小于此数值时，开始应急放电.(1.115V -> 0x72)
161			   161: CMP_SUPPLY1	EQU	4DH
162			   
163			   163: DURATION_EMER	EQU	4EH		;bit0 = 1, 应急时长小于5分钟
164			   164: 					;bit1 = 1, 应急时长大于5分钟，小于30分钟
165			   165: 					;bit2 = 1, 应急时长大于30分钟
166			   166: 					
167			   167: CNT0_EMERGENCY	EQU	4FH		;对应急时长计时，单位s
168			   168: CNT1_EMERGENCY	EQU	50H
169			   169: CNT2_EMERGENCY	EQU	51H
170			   
171			   171: CMP_EXIT_EMER0	EQU	52H		;检测到电池电压小于此数值时(0.96V -> 0x62)，应该关闭应急放电功能
172			   172: CMP_EXIT_EMER1	EQU	53H
173			   
174			   174: CMP_BAT_OPEN0	EQU	54H		;检测到电池电压大于此数值时(1.56V -> 0x9F)，视为电池充电回路开路
175			   175: CMP_BAT_OPEN1	EQU	55H
176			   
177			   177: CMP_BAT_FULL0	EQU	56H		;检测到电池电压大于此数值时(1.44V -> 0x93)，视为电池已充满
178			   178: CMP_BAT_FULL1	EQU	57H
179			   
180			   180: CMP_BAT_CHARGE0	EQU	58H		;检测到电池电压小于此数值时(1.35V -> 0x8A)，视为电池得开始充电了
181			   181: CMP_BAT_CHARGE1	EQU	59H
182			   
183			   
184			   
185			   185: BAT_STATE	EQU	69H		;bit0 = 0, 表示充电回路未开路；bit0 = 1, 表示充电回路开路
186			   186: 					;bit1 = 0, 表示电池未充满；bit1 = 1, 表示电池已充满
187			   187: 					;bit2 = 0, 表示电池还不需要充电；bit2 = 1, 表示电池需要充电
188			   188: 					;bit3 = 1, 表示电池电压过低，不能再继续应急放电了
189			   
190			   
191			   191: CMP_LIGHT0	EQU	6AH		;供光源检测使用,AD转换结果小于此数值时(0.2V -> 0x14)，表示光源产生故障
192			   192: CMP_LIGHT1	EQU	5AH
193			   
194			   194: LIGHT_STATE	EQU	5BH		;bit0 = 1, 表示光源故障
195			   
196			   
197			   197: ALARM_STATE	EQU	5CH		;bit0 = 1, 表示电池故障(开路或短路)
198			   198: 					;bit1 = 1, 表示光源故障(开路或短路)
199			   199: 					;bit2 = 1, 表示自检放电时间不足
200			   
201			   
202			   202: CNT_LED_YELLOW	EQU	5FH		;计数器，供翻转黄灯输出使用，计时单位为168MS
203			   
204			   
205			   205: FLAG_SIMU_EMER	EQU	60H		;bit0 = 1, 表示在"模拟停电"状态下已经打开应急功能
206			   206: 					;bit1 = 1表示1s已到
207			   
208			   208: CNT0_1MINUTE	EQU	61H		;每1秒加1，直至计时满1分钟为止
209			   209: CNT1_1MINUTE	EQU	62H
210			   
211			   
212			   212: CNT0_CHARGE	EQU	63H		;还应充电多长时间，初始值为20小时，即20 * 60 =1200分钟(0x4B0)
213			   213: CNT1_CHARGE	EQU	64H
214			   214: CNT2_CHARGE	EQU	65H
215			   
216			   216: GREEN_FLASH	EQU	66H		;用于手动月检或手动年检时的LED闪烁
217			   217: 					;BIT1 = 1, 按键时长超过了3秒，绿灯开始以1HZ的频率闪烁
218			   218: 					;BIT2 = 1, 按键时长超过了5秒，绿灯开始以3HZ的频率闪烁
219			   
220			   
221			   221: CNT_LED_GREEN	EQU	67H		;供绿色LED翻转用
222			   
223			   223: ;按键相关寄存器
224			   224: DELAY_TIMER2	EQU	71H		;延时子程序使用
225			   225: DELAY_TIMER1	EQU	72H		;延时子程序使用
226			   226: DELAY_TIMER0	EQU	73H		;延时子程序使用
227			   227: CLEAR_AC 	EQU 	74H 		;清除累加器A 值用寄存器
228			   228: TEMP 		EQU 	75H 		;临时寄存器
229			   
230			   230: ;CNT0_496MS	EQU	76H		;用于定时496MS
231			   231: ;CNT1_496MS	EQU	77H
232			   
233			   233: BTN_PRE_STA	EQU	78H		;bit0储存上一次按键状态,0:按下,1:未按下
234			   234: BTN_PRESS_CNT0	EQU	79H		;按键按下时长，单位为168ms
235			   235: BTN_PRESS_CNT1	EQU	68H
236			   
237			   237: ;led
238			   238: CNT0_168MS	EQU	7AH		;用于定时168MS,供翻转LED用
239			   239: CNT1_168MS	EQU	7BH
240			   
241			   241: F_168MS		EQU	7CH		;每168ms将bit0 = 1, 供翻转LED使用
242			   242: 					;每168ms将bit1 = 1, 供按键检测使用
243			   
244			   244: CMP_RESUME0	EQU	7DH		;检测到电源电压大于此数值时，表示市电供电已恢复，应关闭应急.(1.396V -> 0x8E)
245			   245: CMP_RESUME1	EQU	7EH
246			   
247			   247: PRESS_DURATION	EQU	7FH		;按键被按下持续时长标志
248			   248: 					;bit0 = 1;  被按下时长小于3秒
249			   249: 					;bit1 = 1;  被按下时长大于3秒，小于5秒
250			   250: 					;bit2 = 1;  被按下时长大于5秒，小于7秒
251			   251: 					;bit3 = 1;  被按下时长大于7秒
252			   
253			   253: ;Bank1(以下寄存器真实地址应加上80H)
254			   254: ;------------------------------------------------------------------
255			   255: CHN0_RET0_BAK0	EQU	00H		;ADC CHN0 转换结果低2位备份
256			   256: CHN0_RET1_BAK0	EQU	01H		;ADC CHN0 转换结果中4位备份
257			   257: CHN0_RET2_BAK0	EQU	02H		;ADC CHN0 转换结果高4位备份
258			   
259			   259: CHN0_RET0_BAK1	EQU	03H		;ADC CHN0 转换结果低2位备份
260			   260: CHN0_RET1_BAK1	EQU	04H		;ADC CHN0 转换结果中4位备份
261			   261: CHN0_RET2_BAK1	EQU	05H		;ADC CHN0 转换结果高4位备份
262			   
263			   263: AD_RET0,	00H 	;保存第四次A/D 转换结果
264			   264: CHN0_RET1_BAK2	EQU	07H		;ADC CHN0 转换结果中4位备份
265			   265: CHN0_RET2_BAK2	EQU	08H		;ADC CHN0 转换结果高4位备份
266			   
267			   267: CHN0_RET0_BAK3	EQU	09H		;ADC CHN0 转换结果低2位备份
268			   268: CHN0_RET1_BAK3	EQU	0AH		;ADC CHN0 转换结果中4位备份
269			   269: CHN0_RET2_BAK3	EQU	0BH		;ADC CHN0 转换结果高4位备份
270			   
271			   271: CHN0_FINAL_RET0	EQU	0CH		;通道0平均后的结果
272			   272: CHN0_FINAL_RET1	EQU	0DH		;
273			   273: CHN0_FINAL_RET2	EQU	0EH
274			   
275			   275: DET0_CT		EQU	0FH		;ADC 通道0 转换结果个数
276			   
277			   277: ;------------------------------------------------------------------
278			   278: CHN1_RET0_BAK0	EQU	10H		;ADC CHN1 转换结果低2位备份
279			   279: CHN1_RET1_BAK0	EQU	11H		;ADC CHN1 转换结果中4位备份
280			   280: CHN1_RET2_BAK0	EQU	12H		;ADC CHN1 转换结果高4位备份
281			   
282			   282: CHN1_RET0_BAK1	EQU	13H		;ADC CHN1 转换结果低2位备份
283			   283: CHN1_RET1_BAK1	EQU	14H		;ADC CHN1 转换结果中4位备份
284			   284: CHN1_RET2_BAK1	EQU	15H		;ADC CHN1 转换结果高4位备份
285			   
286			   286: CHN1_RET0_BAK2	EQU	16H		;ADC CHN1 转换结果低2位备份
287			   287: CHN1_RET1_BAK2	EQU	17H		;ADC CHN1 转换结果中4位备份
288			   288: CHN1_RET2_BAK2	EQU	18H		;ADC CHN1 转换结果高4位备份
289			   
290			   290: CHN1_RET0_BAK3	EQU	19H		;ADC CHN1 转换结果低2位备份
291			   291: CHN1_RET1_BAK3	EQU	1AH		;ADC CHN1 转换结果中4位备份
292			   292: CHN1_RET2_BAK3	EQU	1BH		;ADC CHN1 转换结果高4位备份
293			   
294			   294: CHN1_FINAL_RET0	EQU	1CH		;通道1平均后的结果
295			   295: CHN1_FINAL_RET1	EQU	1DH		;
296			   296: CHN1_FINAL_RET2	EQU	1EH		;
297			   
298			   298: DET1_CT		EQU	1FH		;ADC 通道1 转换结果个数
299			   
300			   300: ;------------------------------------------------------------------
301			   301: CHN6_RET0_BAK0	EQU	20H		;ADC CHN6 转换结果低2位备份
302			   302: CHN6_RET1_BAK0	EQU	21H		;ADC CHN6 转换结果中4位备份
303			   303: CHN6_RET2_BAK0	EQU	22H		;ADC CHN6 转换结果高4位备份
304			   
305			   305: CHN6_RET0_BAK1	EQU	23H		;ADC CHN6 转换结果低2位备份
306			   306: CHN6_RET1_BAK1	EQU	24H		;ADC CHN6 转换结果中4位备份
307			   307: CHN6_RET2_BAK1	EQU	25H		;ADC CHN6 转换结果高4位备份
308			   
309			   309: CHN6_RET0_BAK2	EQU	26H		;ADC CHN6 转换结果低2位备份
310			   310: CHN6_RET1_BAK2	EQU	27H		;ADC CHN6 转换结果中4位备份
311			   311: CHN6_RET2_BAK2	EQU	28H		;ADC CHN6 转换结果高4位备份
312			   
313			   313: CHN6_RET0_BAK3	EQU	29H		;ADC CHN6 转换结果低2位备份
314			   314: CHN6_RET1_BAK3	EQU	2AH		;ADC CHN6 转换结果中4位备份
315			   315: CHN6_RET2_BAK3	EQU	2BH		;ADC CHN6 转换结果高4位备份
316			   
317			   317: CHN6_FINAL_RET0	EQU	2CH		;通道6平均后的结果
318			   318: CHN6_FINAL_RET1	EQU	2DH		;
319			   319: CHN6_FINAL_RET2	EQU	2EH
320			   
321			   321: DET6_CT		EQU	2FH		;ADC 通道6 转换结果个数
322			   
323			   323: ;------------------------------------------------------------------
324			   324: CHN7_RET0_BAK0	EQU	30H		;ADC CHN7 转换结果低2位备份
325			   325: CHN7_RET1_BAK0	EQU	31H		;ADC CHN7 转换结果中4位备份
326			   326: CHN7_RET2_BAK0	EQU	32H		;ADC CHN7 转换结果高4位备份
327			   
328			   328: CHN7_RET0_BAK1	EQU	33H		;ADC CHN7 转换结果低2位备份
329			   329: CHN7_RET1_BAK1	EQU	34H		;ADC CHN7 转换结果中4位备份
330			   330: CHN7_RET2_BAK1	EQU	35H		;ADC CHN7 转换结果高4位备份
331			   
332			   332: CHN7_RET0_BAK2	EQU	36H		;ADC CHN7 转换结果低2位备份
333			   333: CHN7_RET1_BAK2	EQU	37H		;ADC CHN7 转换结果中4位备份
334			   334: CHN7_RET2_BAK2	EQU	38H		;ADC CHN7 转换结果高4位备份
335			   
336			   336: CHN7_RET0_BAK3	EQU	39H		;ADC CHN7 转换结果低2位备份
337			   337: CHN7_RET1_BAK3	EQU	3AH		;ADC CHN7 转换结果中4位备份
338			   338: CHN7_RET2_BAK3	EQU	3BH		;ADC CHN7 转换结果高4位备份
339			   
340			   340: CHN7_FINAL_RET0	EQU	3CH		;通道7平均后的结果
341			   341: CHN7_FINAL_RET1	EQU	3DH		;
342			   342: CHN7_FINAL_RET2	EQU	3EH		;
343			   
344			   344: DET7_CT		EQU	3FH		;ADC 通道7 转换结果个数
345			   
346			   
347			   347: ;*****************************************************
348			   348: ;程序
349			   349: ;*****************************************************
350			   350: 	ORG	0000H
351			   
352			   352: 	;中断向量表
353	0x0000	0xe0ff	   353: 	JMP	RESET			;RESET ISP
354	0x0001	0xe036	   354: 	JMP	ADC_ISP			;ADC INTERRUPT ISP
355	0x0002	0xe005	   355: 	JMP	TIMER0_ISP		;TIMER0 ISP
356	0x0003	0xd400	   356: 	RTNI				;TIMER1 ISP
357	0x0004	0xd400	   357: 	RTNI				;PORTB/D ISP
358			   
359			   
360			   360: ;*****************************************************
361			   361: ;Timer0 中断服务程序
362			   362: ;Timer0已配置为每8ms产生一次中断
363			   363: ;
364			   364: ;*****************************************************
365			   365: TIMER0_ISP:
366	0x0005	0x3c30	   366: 	STA 	AC_BAK,		00H 	;备份AC 值
367	0x0006	0x7581	   367: 	ANDIM 	IRQ,		1011B 	;清TIMER0 中断请求标志
368			   
369			   369: J_168MS:
370	0x0007	0x58fa	   370: 	SBIM	CNT0_168MS,	01H
371	0x0008	0x780e	   371: 	LDI	TBR,		00H
372	0x0009	0x147b	   372: 	SBCM	CNT1_168MS
373	0x000a	0x980e	   373: 	BC	J_1S
374			   
375	0x000b	0x7a7a	   375: 	LDI	CNT0_168MS,	04H	;8ms * 21 = 168ms
376	0x000c	0x78fb	   376: 	LDI	CNT1_168MS,	01H
377			   
378	0x000d	0x69fc	   378: 	ORIM	F_168MS,	0011B	;设置 "168ms 到"标志，1)bit0供翻转LED用，2)bit1供按键检测用
379			   
380			   380: J_1S:	
381	0x000e	0x58b7	   381: 	SBIM 	CNT0_8MS,	01H	;每次Timer0中断产生后，将CNT0_8MS减1
382	0x000f	0x780e	   382: 	LDI	TBR,		00H
383	0x0010	0x1438	   383: 	SBCM	CNT1_8MS		;每次CNT0_8MS-1产生借位时，将CNT1_8MS减1
384	0x0011	0x9833	   384: 	BC	TIMER0_ISP_END
385			   385: 	
386	0x0012	0x7e37	   386: 	LDI 	CNT0_8MS,	0CH 	;重置1s 计数器 1S = 125 * 8 MS
387	0x0013	0x7bb8	   387: 	LDI 	CNT1_8MS,	07H 	;重置1s 计数器
388			   388: 	
389	0x0014	0x68b6	   389: 	ORIM 	F_TIME,		0001B 	;设置 "1s 到"标志
390	0x0015	0x68b5	   390: 	ORIM	F_1S,		0001B	;为应急功能提供 "1s 到"标志
391	0x0016	0x6960	   391: 	ORIM	FLAG_SIMU_EMER,	0010B	;为手动自检提供 "1s 到"标志
392			   
393			   393: J_MINUTE:
394	0x0017	0x58e1	   394: 	SBIM	CNT0_1MINUTE,	01H
395	0x0018	0x780e	   395: 	LDI	TBR,		00H
396	0x0019	0x1462	   396: 	SBCM	CNT1_1MINUTE
397	0x001a	0x981e	   397: 	BC	J_HOUR			;因为J_HOUR是以秒为单位累加，所以应跳至J_HOUR
398			   
399	0x001b	0x7de1	   399: 	LDI	CNT0_1MINUTE,	0BH	;0x3c * 1s = 60s
400	0x001c	0x79e2	   400: 	LDI	CNT1_1MINUTE,	03H
401			   
402	0x001d	0x6c36	   402: 	ORIM	F_TIME,		1000B	;设置 "1分钟 到"标志	
403			   
404			   404: J_HOUR:
405	0x001e	0x58b9	   405: 	SBIM	SEC_CNT0,	01H	;SEC_CNT0 每秒减1
406	0x001f	0x780e	   406: 	LDI	TBR,		00H
407	0x0020	0x143a	   407: 	SBCM	SEC_CNT1		;每次SEC_CNT0-1产生借位时，将SEC_CNT1减1
408	0x0021	0x780e	   408: 	LDI	TBR,		00H
409	0x0022	0x143b	   409: 	SBCM	SEC_CNT2		;每次SEC_CNT1-1产生借位时，将SEC_CNT2减1
410	0x0023	0x9833	   410: 	BC	TIMER0_ISP_END		;SEC_CNT2减1产生借位时，则表示1小时计时已到
411			   411: 	
412	0x0024	0x7fb9	   412: 	LDI 	SEC_CNT0,	0FH 	;重置SEC_CNT0/1/2 为E10H-1(3600-1)
413	0x0025	0x783a	   413: 	LDI 	SEC_CNT1,	00H
414	0x0026	0x7f3b	   414: 	LDI 	SEC_CNT2,	0EH
415			   415: 	
416			   416: J_MONTH:	
417	0x0027	0x58bc	   417: 	SBIM 	HOUR_CNT0,	01H	;HOUR_CNT0 每小时减1
418	0x0028	0x780e	   418: 	LDI	TBR,		00H
419	0x0029	0x143d	   419: 	SBCM	HOUR_CNT1		;每次 HOUR_CNT0 产生借位时，将 HOUR_CNT1 减1
420	0x002a	0x9833	   420: 	BC	TIMER0_ISP_END		;HOUR_CNT1 减1产生借位时，则表示1月计时已到
421			   421: 	
422	0x002b	0x7bbc	   422: 	LDI 	HOUR_CNT0,	07H 	;重置HOUR_CNT0/1/2 为2E8H-1(744-1)
423	0x002c	0x7f3d	   423: 	LDI 	HOUR_CNT1,	0EH
424	0x002d	0x793e	   424: 	LDI	HOUR_CNT2,	02H
425			   425: 	
426	0x002e	0x6936	   426: 	ORIM 	F_TIME,		0010B 	;设置 "1月到" 标志
427			   427: 	
428			   428: J_YEAR:	
429	0x002f	0x58bf	   429: 	SBIM 	MONTH_CNT,	01H	;MONTH_CNT 每月减1
430	0x0030	0x9833	   430: 	BC 	TIMER0_ISP_END		;MONTH_CNT 减1产生借位时，则表示1年计时已到
431			   431: 	
432	0x0031	0x7dbf	   432: 	LDI 	MONTH_CNT,	0BH 	;重置MONTH_CNT 为0CH-1(12-1)
433			   433: 	
434	0x0032	0x6a36	   434: 	ORIM 	F_TIME,		0100B 	;设置 "1年到" 标志
435			   
436			   436: TIMER0_ISP_END:
437	0x0033	0x7e00	   437: 	LDI 	IE,		1100B 	;打开ADC,Timer0 中断
438	0x0034	0x3830	   438: 	LDA 	AC_BAK,		00H 	;恢复AC 值
439	0x0035	0xd400	   439: 	RTNI
440			   
441			   
442			   442: ;*****************************************************
443			   443: ;ADC 中断服务程序
444			   444: ;*****************************************************	
445			   445: ADC_ISP:
446	0x0036	0x3c30	   446: 	STA 	AC_BAK,		00H 	;备份AC 值
447	0x0037	0x7381	   447: 	ANDIM 	IRQ,		0111B 	;清ADC 中断请求标志
448			   
449	0x0038	0x3817	   449: 	LDA	ADCCHN			
450	0x0039	0x9041	   450: 	BAZ	CHN0_VOL_1		;此次为通道0 转换结果
451	0x003a	0x5097	   451: 	SBI	ADCCHN,		01H
452	0x003b	0x906b	   452: 	BAZ	CHN1_VOL_1		;此次为通道1 转换结果	
453	0x003c	0x5317	   453: 	SBI	ADCCHN,		06H
454	0x003d	0x9095	   454: 	BAZ	CHN6_VOL_1		;此次为通道6 转换结果
455	0x003e	0x5397	   455: 	SBI	ADCCHN,		07H
456	0x003f	0x90bf	   456: 	BAZ	CHN7_VOL_1		;此次为通道7 转换结果
457	0x0040	0xe0fb	   457: 	JMP	ADC_ISP_END		;正常情况下不应执行此语句
458			   
459			   459: ;----------------------------------------------------------------	
460			   
461			   461: ;转存通道0 转换结果
462			   462: ;----------------------------------------------------------------
463			   463: CHN0_VOL_1:
464	0x0041	0x788e	   464: 	LDI	TBR,		01H	;次数加一
465	0x0042	0x0c8f	   465: 	ADDM	DET0_CT,	01H	
466			   
467	0x0043	0x7a0e	   467: 	LDI	TBR,		04H	;DET0_CT - 4 -> A
468	0x0044	0x188f	   468: 	SUB	DET0_CT,	01H
469	0x0045	0x9061	   469: 	BAZ 	CHN0_VOL_14		;第4个转换结果
470			   
471	0x0046	0x798e	   471: 	LDI	TBR,		03H	;DET0_CT - 3 -> A
472	0x0047	0x188f	   472: 	SUB	DET0_CT,	01H
473	0x0048	0x905a	   473: 	BAZ 	CHN0_VOL_13		;第3个转换结果
474			   
475	0x0049	0x790e	   475: 	LDI	TBR,		02H	;DET0_CT - 2 -> A
476	0x004a	0x188f	   476: 	SUB	DET0_CT,	01H
477	0x004b	0x9053	   477: 	BAZ 	CHN0_VOL_12		;第2个转换结果
478			   
479			   479: CHN0_VOL_11:
480	0x004c	0x382d	   480: 	LDA 	AD_RET0,	00H 	;保存第一次A/D 转换结果
481	0x004d	0x3c80	   481: 	STA 	CHN0_RET0_BAK0,	01H
482	0x004e	0x382e	   482: 	LDA 	AD_RET1,	00H
483	0x004f	0x3c81	   483: 	STA 	CHN0_RET1_BAK0,	01H
484	0x0050	0x382f	   484: 	LDA 	AD_RET2,	00H
485	0x0051	0x3c82	   485: 	STA 	CHN0_RET2_BAK0,	01H
486	0x0052	0xe0e9	   486: 	JMP 	NEXT_CHN	
487			   
488			   488: CHN0_VOL_12:
489	0x0053	0x382d	   489: 	LDA 	AD_RET0,	00H 	;保存第二次A/D 转换结果
490	0x0054	0x3c83	   490: 	STA 	CHN0_RET0_BAK1,	01H
491	0x0055	0x382e	   491: 	LDA 	AD_RET1,	00H
492	0x0056	0x3c84	   492: 	STA 	CHN0_RET1_BAK1,	01H
493	0x0057	0x382f	   493: 	LDA 	AD_RET2,	00H
494	0x0058	0x3c85	   494: 	STA 	CHN0_RET2_BAK1,	01H
495	0x0059	0xe0e9	   495: 	JMP 	NEXT_CHN
496			   496: 	
497			   497: CHN0_VOL_13:
498	0x005a	0x382d	   498: 	LDA 	AD_RET0,	00H 	;保存第三次A/D 转换结果
499	0x005b	0x3c86	   499: 	STA 	CHN0_RET0_BAK2,	01H
500	0x005c	0x382e	   500: 	LDA 	AD_RET1,	00H
501	0x005d	0x3c87	   501: 	STA 	CHN0_RET1_BAK2,	01H
502	0x005e	0x382f	   502: 	LDA 	AD_RET2,	00H
503	0x005f	0x3c88	   503: 	STA 	CHN0_RET2_BAK2,	01H
504	0x0060	0xe0e9	   504: 	JMP 	NEXT_CHN	
505			   505: 	
506			   506: CHN0_VOL_14:
507	0x0061	0x382d	   507: 	LDA 	AD_RET0,	00H 	;保存第四次A/D 转换结果
508	0x0062	0x3c89	   508: 	STA 	CHN0_RET0_BAK3,	01H
509	0x0063	0x382e	   509: 	LDA 	AD_RET1,	00H
510	0x0064	0x3c8a	   510: 	STA 	CHN0_RET1_BAK3,	01H
511	0x0065	0x382f	   511: 	LDA 	AD_RET2,	00H
512	0x0066	0x3c8b	   512: 	STA 	CHN0_RET2_BAK3,	01H
513			   
514	0x0067	0x780e	   514: 	LDI	TBR,		00H	;DET0_CT 清0
515	0x0068	0x3c8f	   515: 	STA	DET0_CT,	01H
516			   516: 	
517	0x0069	0xc370	   517: 	CALL	CAL_CHN0_ADCDATA
518			   518: 	
519	0x006a	0xe0e9	   519: 	JMP 	NEXT_CHN	
520			   520: ;----------------------------------------------------------------	
521			   
522			   522: ;转存通道1 转换结果
523			   523: ;----------------------------------------------------------------
524			   524: CHN1_VOL_1:
525	0x006b	0x788e	   525: 	LDI	TBR,		01H	;次数加一
526	0x006c	0x0c9f	   526: 	ADDM	DET1_CT,	01H	
527			   
528	0x006d	0x7a0e	   528: 	LDI	TBR,		04H	;DET1_CT - 4 -> A
529	0x006e	0x189f	   529: 	SUB	DET1_CT,	01H
530	0x006f	0x908b	   530: 	BAZ 	CHN1_VOL_14		;第4个转换结果
531			   
532	0x0070	0x798e	   532: 	LDI	TBR,		03H	;DET1_CT - 3 -> A
533	0x0071	0x189f	   533: 	SUB	DET1_CT,	01H
534	0x0072	0x9084	   534: 	BAZ 	CHN1_VOL_13		;第3个转换结果
535			   
536	0x0073	0x790e	   536: 	LDI	TBR,		02H	;DET1_CT - 2 -> A
537	0x0074	0x189f	   537: 	SUB	DET1_CT,	01H
538	0x0075	0x907d	   538: 	BAZ 	CHN1_VOL_12		;第2个转换结果
539			   
540			   540: CHN1_VOL_11:
541	0x0076	0x382d	   541: 	LDA 	AD_RET0,	00H 	;保存第一次A/D 转换结果
542	0x0077	0x3c90	   542: 	STA 	CHN1_RET0_BAK0,	01H
543	0x0078	0x382e	   543: 	LDA 	AD_RET1,	00H
544	0x0079	0x3c91	   544: 	STA 	CHN1_RET1_BAK0,	01H
545	0x007a	0x382f	   545: 	LDA 	AD_RET2,	00H
546	0x007b	0x3c92	   546: 	STA 	CHN1_RET2_BAK0,	01H
547	0x007c	0xe0e9	   547: 	JMP 	NEXT_CHN	
548			   
549			   549: CHN1_VOL_12:
550	0x007d	0x382d	   550: 	LDA 	AD_RET0,	00H 	;保存第二次A/D 转换结果
551	0x007e	0x3c93	   551: 	STA 	CHN1_RET0_BAK1,	01H
552	0x007f	0x382e	   552: 	LDA 	AD_RET1,	00H
553	0x0080	0x3c94	   553: 	STA 	CHN1_RET1_BAK1,	01H
554	0x0081	0x382f	   554: 	LDA 	AD_RET2,	00H
555	0x0082	0x3c95	   555: 	STA 	CHN1_RET2_BAK1,	01H
556	0x0083	0xe0e9	   556: 	JMP 	NEXT_CHN
557			   
558			   558: CHN1_VOL_13:
559	0x0084	0x382d	   559: 	LDA 	AD_RET0,	00H 	;保存第三次A/D 转换结果
560	0x0085	0x3c96	   560: 	STA 	CHN1_RET0_BAK2,	01H
561	0x0086	0x382e	   561: 	LDA 	AD_RET1,	00H
562	0x0087	0x3c97	   562: 	STA 	CHN1_RET1_BAK2,	01H
563	0x0088	0x382f	   563: 	LDA 	AD_RET2,	00H
564	0x0089	0x3c98	   564: 	STA 	CHN1_RET2_BAK2,	01H
565	0x008a	0xe0e9	   565: 	JMP 	NEXT_CHN	
566			   
567			   567: CHN1_VOL_14:
568	0x008b	0x382d	   568: 	LDA 	AD_RET0,	00H 	;保存第四次A/D 转换结果
569	0x008c	0x3c99	   569: 	STA 		
570	0x008d	0x382e	   570: 	LDA 	AD_RET1,	00H
571	0x008e	0x3c9a	   571: 	STA 	CHN1_RET1_BAK3,	01H
572	0x008f	0x382f	   572: 	LDA 	AD_RET2,	00H
573	0x0090	0x3c9b	   573: 	STA 	CHN1_RET2_BAK3,	01H
574			   
575	0x0091	0x780e	   575: 	LDI	TBR,		00H	;DET1_CT 清0
576	0x0092	0x3c9f	   576: 	STA	DET1_CT,	01H
577			   577: 	
578	0x0093	0xc404	   578: 	CALL	CAL_CHN1_ADCDATA
579			   579: 	
580	0x0094	0xe0e9	   580: 	JMP 	NEXT_CHN	
581			   581: ;----------------------------------------------------------------	
582			   
583			   583: ;转存通道6 转换结果
584			   584: ;----------------------------------------------------------------
585			   585: CHN6_VOL_1:
586	0x0095	0x788e	   586: 	LDI	TBR,		01H	;次数加一
587	0x0096	0x0caf	   587: 	ADDM	DET6_CT,	01H	
588			   
589	0x0097	0x7a0e	   589: 	LDI	TBR,		04H	;DET6_CT - 4 -> A
590	0x0098	0x18af	   590: 	SUB	DET6_CT,	01H
591	0x0099	0x90b5	   591: 	BAZ 	CHN6_VOL_14		;第4个转换结果
592			   
593	0x009a	0x798e	   593: 	LDI	TBR,		03H	;DET6_CT - 3 -> A
594	0x009b	0x18af	   594: 	SUB	DET6_CT,	01H
595	0x009c	0x90ae	   595: 	BAZ 	CHN6_VOL_13		;第3个转换结果
596			   
597	0x009d	0x790e	   597: 	LDI	TBR,		02H	;DET6_CT - 2 -> A
598	0x009e	0x18af	   598: 	SUB	DET6_CT,	01H
599	0x009f	0x90a7	   599: 	BAZ 	CHN6_VOL_12		;第2个转换结果
600			   
601			   601: CHN6_VOL_11:
602	0x00a0	0x382d	   602: 	LDA 	AD_RET0,	00H 	;保存第一次A/D 转换结果
603	0x00a1	0x3ca0	   603: 	STA 	CHN6_RET0_BAK0,	01H
604	0x00a2	0x382e	   604: 	LDA 	AD_RET1,	00H
605	0x00a3	0x3ca1	   605: 	STA 	CHN6_RET1_BAK0,	01H
606	0x00a4	0x382f	   606: 	LDA 	AD_RET2,	00H
607	0x00a5	0x3ca2	   607: 	STA 	CHN6_RET2_BAK0,	01H
608	0x00a6	0xe0e9	   608: 	JMP 	NEXT_CHN	
609			   
610			   610: CHN6_VOL_12:
611	0x00a7	0x382d	   611: 	LDA 	AD_RET0,	00H 	;保存第二次A/D 转换结果
612	0x00a8	0x3ca3	   612: 	STA 	CHN6_RET0_BAK1,	01H
613	0x00a9	0x382e	   613: 	LDA 	AD_RET1,	00H
614	0x00aa	0x3ca4	   614: 	STA 	CHN6_RET1_BAK1,	01H
615	0x00ab	0x382f	   615: 	LDA 	AD_RET2,	00H
616	0x00ac	0x3ca5	   616: 	STA 	CHN6_RET2_BAK1,	01H
617	0x00ad	0xe0e9	   617: 	JMP 	NEXT_CHN
618			   618: 	
619			   619: CHN6_VOL_13:
620	0x00ae	0x382d	   620: 	LDA 	AD_RET0,	00H 	;保存第三次A/D 转换结果
621	0x00af	0x3ca6	   621: 	STA 	CHN6_RET0_BAK2,	01H
622	0x00b0	0x382e	   622: 	LDA 	AD_RET1,	00H
623	0x00b1	0x3ca7	   623: 	STA 	CHN6_RET1_BAK2,	01H
624	0x00b2	0x382f	   624: 	LDA 	AD_RET2,	00H
625	0x00b3	0x3ca8	   625: 	STA 	CHN6_RET2_BAK2,	01H
626	0x00b4	0xe0e9	   626: 	JMP 	NEXT_CHN	
627			   627: 	
628			   628: CHN6_VOL_14:
629	0x00b5	0x382d	   629: 	LDA 	AD_RET0,	00H 	;保存第四次A/D 转换结果
630	0x00b6	0x3ca9	   630: 	STA 	CHN6_RET0_BAK3,	01H
631	0x00b7	0x382e	   631: 	LDA 	AD_RET1,	00H
632	0x00b8	0x3caa	   632: 	STA 	CHN6_RET1_BAK3,	01H
633	0x00b9	0x382f	   633: 	LDA 	AD_RET2,	00H
634	0x00ba	0x3cab	   634: 	STA 	CHN6_RET2_BAK3,	01H
635			   
636	0x00bb	0x780e	   636: 	LDI	TBR,		00H	;DET6_CT 清0
637	0x00bc	0x3caf	   637: 	STA	DET6_CT,	01H
638			   638: 	
639	0x00bd	0xc498	   639: 	CALL	CAL_CHN6_ADCDATA
640			   640: 	
641	0x00be	0xe0e9	   641: 	JMP 	NEXT_CHN	
642			   642: ;----------------------------------------------------------------	
643			   
644			   644: ;转存通道7 转换结果
645			   645: ;----------------------------------------------------------------
646			   646: CHN7_VOL_1:
647	0x00bf	0x788e	   647: 	LDI	TBR,		01H	;次数加一
648	0x00c0	0x0cbf	   648: 	ADDM	DET7_CT,	01H	
649			   
650	0x00c1	0x7a0e	   650: 	LDI	TBR,		04H	;DET7_CT - 4 -> A
651	0x00c2	0x18bf	   651: 	SUB	DET7_CT,	01H
652	0x00c3	0x90df	   652: 	BAZ 	CHN7_VOL_14		;第4个转换结果
653			   
654	0x00c4	0x798e	   654: 	LDI	TBR,		03H	;DET7_CT - 3 -> A
655	0x00c5	0x18bf	   655: 	SUB	DET7_CT,	01H
656	0x00c6	0x90d8	   656: 	BAZ 	CHN7_VOL_13		;第3个转换结果
657			   
658	0x00c7	0x790e	   658: 	LDI	TBR,		02H	;DET7_CT - 2 -> A
659	0x00c8	0x18bf	   659: 	SUB	DET7_CT,	01H
660	0x00c9	0x90d1	   660: 	BAZ 	CHN7_VOL_12		;第2个转换结果
661			   
662			   662: CHN7_VOL_11:
663	0x00ca	0x382d	   663: 	LDA 	AD_RET0,	00H 	;保存第一次A/D 转换结果
664	0x00cb	0x3cb0	   664: 	STA 	CHN7_RET0_BAK0,	01H
665	0x00cc	0x382e	   665: 	LDA 	AD_RET1,	00H
666	0x00cd	0x3cb1	   666: 	STA 	CHN7_RET1_BAK0,	01H
667	0x00ce	0x382f	   667: 	LDA 	AD_RET2,	00H
668	0x00cf	0x3cb2	   668: 	STA 	CHN7_RET2_BAK0,	01H
669	0x00d0	0xe0e9	   669: 	JMP 	NEXT_CHN	
670			   
671			   671: CHN7_VOL_12:
672	0x00d1	0x382d	   672: 	LDA 	AD_RET0,	00H 	;保存第二次A/D 转换结果
673	0x00d2	0x3cb3	   673: 	STA 	CHN7_RET0_BAK1,	01H
674	0x00d3	0x382e	   674: 	LDA 	AD_RET1,	00H
675	0x00d4	0x3cb4	   675: 	STA 	CHN7_RET1_BAK1,	01H
676	0x00d5	0x382f	   676: 	LDA 	AD_RET2,	00H
677	0x00d6	0x3cb5	   677: 	STA 	CHN7_RET2_BAK1,	01H
678	0x00d7	0xe0e9	   678: 	JMP 	NEXT_CHN
679			   679: 	
680			   680: CHN7_VOL_13:
681	0x00d8	0x382d	   681: 	LDA 	AD_RET0,	00H 	;保存第三次A/D 转换结果
682	0x00d9	0x3cb6	   682: 	STA 	CHN7_RET0_BAK2,	01H
683	0x00da	0x382e	   683: 	LDA 	AD_RET1,	00H
684	0x00db	0x3cb7	   684: 	STA 	CHN7_RET1_BAK2,	01H
685	0x00dc	0x382f	   685: 	LDA 	AD_RET2,	00H
686	0x00dd	0x3cb8	   686: 	STA 	CHN7_RET2_BAK2,	01H
687	0x00de	0xe0e9	   687: 	JMP 	NEXT_CHN	
688			   688: 	
689			   689: CHN7_VOL_14:
690	0x00df	0x382d	   690: 	LDA 	AD_RET0,	00H 	;保存第四次A/D 转换结果
691	0x00e0	0x3cb9	   691: 	STA 	CHN7_RET0_BAK3,	01H
692	0x00e1	0x382e	   692: 	LDA 	AD_RET1,	00H
693	0x00e2	0x3cba	   693: 	STA 	CHN7_RET1_BAK3,	01H
694	0x00e3	0x382f	   694: 	LDA 	AD_RET2,	00H
695	0x00e4	0x3cbb	   695: 	STA 	CHN7_RET2_BAK3,	01H
696			   
697	0x00e5	0x780e	   697: 	LDI	TBR,		00H	;DET7_CT 清0
698	0x00e6	0x3cbf	   698: 	STA	DET7_CT,	01H
699			   699: 	
700	0x00e7	0xc52c	   700: 	CALL	CAL_CHN7_ADCDATA
701			   701: 	
702	0x00e8	0xe0e9	   702: 	JMP 	NEXT_CHN	
703			   703: ;----------------------------------------------------------------
704			   
705			   705: ;----------------------------------------------------------------	
706			   706: NEXT_CHN:
707	0x00e9	0x3817	   707: 	LDA	ADCCHN
708	0x00ea	0x90f4	   708: 	BAZ	NEXT_CHN1
709	0x00eb	0x5097	   709: 	SBI	ADCCHN,		01H
710	0x00ec	0x90f6	   710: 	BAZ	NEXT_CHN6
711	0x00ed	0x5317	   711: 	SBI	ADCCHN,		06H
712	0x00ee	0x90f8	   712: 	BAZ	NEXT_CHN7
713	0x00ef	0x5397	   713: 	SBI	ADCCHN,		07H
714	0x00f0	0x90f2	   714: 	BAZ	NEXT_CHN0
715			   715: 	
716	0x00f1	0xe0fb	   716: 	JMP 	ADC_ISP_END		;不可能执行这一句
717			   
718			   718: NEXT_CHN0:
719	0x00f2	0x7817	   719: 	LDI	ADCCHN,		00H	;设定为CHN0
720	0x00f3	0xe0fb	   720: 	JMP 	ADC_ISP_END
721			   
722			   722: NEXT_CHN1:
723	0x00f4	0x7897	   723: 	LDI	ADCCHN,		01H	;设定为CHN1
724	0x00f5	0xe0fb	   724: 	JMP 	ADC_ISP_END
725			   725: 	
726			   726: NEXT_CHN6:
727	0x00f6	0x7b17	   727: 	LDI 	ADCCHN,		06H 	;设定为CHN6
728	0x00f7	0xe0fb	   728: 	JMP	ADC_ISP_END
729			   
730			   730: NEXT_CHN7:
731	0x00f8	0x3842	   731: 	LDA	FLAG_TYPE
732	0x00f9	0xa0f2	   732: 	BA0	NEXT_CHN0		;若FLAG_TYPE的bit0=1，则表示已完成灯具类型选择，此时不再需要对AN7进行采样。
733			   733: 	
734	0x00fa	0x7b97	   734: 	LDI	ADCCHN,		07H	;设定为CHN7
735			   735: ;----------------------------------------------------------------
736			   
737			   
738			   738: ADC_ISP_END:
739	0x00fb	0x6c15	   739: 	ORIM 	ADCCFG,		1000B 	;启动A/D 转换
740			   
741	0x00fc	0x7e00	   741: 	LDI 	IE,		1100B 	;打开ADC,Timer0 中断
742	0x00fd	0x3830	   742: 	LDA 	AC_BAK,		00H 	;取出AC 值
743	0x00fe	0xd400	   743: 	RTNI
744			   
745			   
746			   746: ;*****************************************************
747			   747: ; 主程序
748			   748: ;*****************************************************
749			   749: RESET:
750	0x00ff	0xffff	   750: 	NOP	
751	0x0100	0x7800	   751: 	LDI 	IE,		0000B	;关闭所有中断
752	0x0101	0xffff	   752:  	NOP
753			   
754	0x0102	0xc110	   754: 	CALL	RESET_USER_DATA		;清除用户寄存器
755	0x0103	0xc11f	   755: 	CALL	REGISTER_INITIAL	;初始化系统寄存器与用户数据寄存器
756			   
757	0x0104	0xc169	   757: 	CALL	PRE_START_PWR_CHK	;检查主电源是否正常，如异常则一直等待，直至恢复
758	0x0105	0xc175	   758: 	CALL	PRE_START_TYPE_CHK	;判断灯具的电池类型与光源类型
759			   759: 	
760	0x0106	0xc18f	   760: 	CALL	CHARGE_BAT_ENABLE	;上电后，即开始对电池进行充电
761			   
762			   762: MAIN_LOOP:
763	0x0107	0xc1af	   763: 	CALL	CHARGE_BAT_CTRL		;[充电控制]  根据主电源状态、待充电时长、电池是否充满标志位等进行电池充电控制
764	0x0108	0xc1fa	   764: 	CALL	EMERGENCY_CTRL		;[放电控制]  主电源停电后的应急放电控制，退出应急状态时，计算此次应急放电时长
765			   765: 	
766	0x0109	0xc2a5	   766: 	CALL	KEY_PROCESS		;[按键扫描]  按键扫描
767	0x010a	0xc2d9	   767: 	CALL	SELF_CHK_STATE		;[自检状态]  根据系统运行时长与按键时长，置"停电"，"月检"，"年检"标志位
768	0x010b	0xc300	   768: 	CALL	SELF_CHK_PROCESS	;[系统自检]  根据自检标志位，进行自检
769			   
770	0x010c	0xc23d	   770: 	CALL	BAT_STATE_CHK		;[电池状态]  检测电池状态，并置相应标志位
771	0x010d	0xc266	   771: 	CALL	LIGHT_STATE_CHK		;[光源状态]  光源状态检测，并置相应标志位
772	0x010e	0xc270	   772: 	CALL	TIPS_PROCESS		;[声光提示]  处理LED与蜂鸣器
773			   
774	0x010f	0xe107	   774: 	JMP	MAIN_LOOP
775			   
776			   
777			   777: ;*****************************************************
778			   778: ;清用户寄存器($030 ~ $0EF)
779			   779: ;*****************************************************
780			   780: RESET_USER_DATA:
781			   
782			   782: POWER_RESET:
783	0x0110	0x7810	   783: 	LDI 	DPL,		00H
784	0x0111	0x7991	   784: 	LDI 	DPM,		03H
785	0x0112	0x7812	   785: 	LDI 	DPH,		00H	;从$30 开始
786			   
787			   787: POWER_RESET_1:
788	0x0113	0x780f	   788: 	LDI 	INX,		00H	;向DPH,DPM,DPL组成的地址处写0
789	0x0114	0x4890	   789: 	ADIM 	DPL,		01H
790	0x0115	0x780e	   790: 	LDI 	TBR,		00H	;将累加器A 清0
791	0x0116	0x0411	   791: 	ADCM 	DPM,		00H
792	0x0117	0xb919	   792: 	BA3 	POWER_RESET_2
793	0x0118	0xe11a	   793: 	JMP 	POWER_RESET_3
794			   
795			   795: POWER_RESET_2:
796	0x0119	0x4892	   796: 	ADIM 	DPH,		01H
797			   
798			   798: POWER_RESET_3:
799	0x011a	0x5092	   799: 	SBI 	DPH,		01H	;到$EF 结束，即在地址001 111 000B时停止
800	0x011b	0x8113	   800: 	BNZ 	POWER_RESET_1
801	0x011c	0x5391	   801: 	SBI 	DPM,		07H
802	0x011d	0x8113	   802: 	BNZ 	POWER_RESET_1
803			   
804			   804: RESET_USER_DATA_END:
805	0x011e	0xd400	   805: 	RTNI
806			   
807			   
808			   808: ;*****************************************************
809			   809: ;初始化系统寄存器
810			   810: ;*****************************************************
811			   811: REGISTER_INITIAL:
812			   
813			   813: 	;TIMER0 初始化
814			   814: 	;
815			   815: 	;  fosc=4M, fsys=4M/4=1M
816			   816: 	;
817			   817: 	;  fsys=1M                 31250Hz                   125Hz
818			   818: 	;           -------------            -------------
819			   819: 	;  -------->| Prescaler |----------->|  Counter  |----------->
820			   820: 	;           -------------            -------------
821			   821: 	;               (32)                     (250)
822			   822: 	
823	0x011f	0x7982	   823: 	LDI 	TM0,		03H 	;设置TIMER0 预分频为/32
824	0x0120	0x7b04	   824: 	LDI 	TL0,		06H
825	0x0121	0x7805	   825: 	LDI 	TH0,		00H 	;设置中断时间为8ms
826			   
827	0x0122	0x7a7a	   827: 	LDI	CNT0_168MS,	04H	;定时168ms
828	0x0123	0x78fb	   828: 	LDI	CNT1_168MS,	01H	;
829			   
830	0x0124	0x7eb7	   830: 	LDI 	CNT0_8MS,	0DH 	;定时1s
831	0x0125	0x7bb8	   831: 	LDI 	CNT1_8MS,	07H 	;定时1s
832			   832: 	
833	0x0126	0x7fb9	   833: 	LDI	SEC_CNT0,	0FH	;SEC_CNT0/1/2 初始化为E10H - 1，即3600 -1
834	0x0127	0x783a	   834: 	LDI	SEC_CNT1,	00H
835	0x0128	0x7f3b	   835: 	LDI	SEC_CNT2,	0EH
836			   
837	0x0129	0x7bbc	   837: 	LDI	HOUR_CNT0,	07H	;HOUR_CNT0/1/2 初始化为2E8H - 1，即744 - 1
838	0x012a	0x7f3d	   838: 	LDI	HOUR_CNT1,	0EH
839	0x012b	0x793e	   839: 	LDI	HOUR_CNT2,	02H
840			   
841	0x012c	0x7dbf	   841: 	LDI	MONTH_CNT,	0BH	;MONTH_CNT 初始化为12 -1 个月
842			   842: 		
843			   
844			   844: 	;I/O 口初始化
845	0x012d	0x7808	   845: 	LDI 	PORTA,		00H
846	0x012e	0x7818	   846: 	LDI 	PACR,		00H 	;设置PortA 作为输入口
847			   847: 	
848	0x012f	0x7809	   848: 	LDI 	PORTB,		00H
849	0x0130	0x7819	   849: 	LDI 	PBCR,		00H 	;设置PortB 作为输入口
850			   
851	0x0131	0x780a	   851: 	LDI	PORTC,		00H
852	0x0132	0x7f9a	   852: 	LDI	PCCR,		0FH	;设置PortC.0/PortC.1/PortC.2/PortC.3 作为输出
853			   853: 	
854	0x0133	0x7f1b	   854: 	LDI 	PDCR,		1110B 	;设置PD.0为输入，PD.3为输出
855	0x0134	0x788e	   855: 	LDI	TBR,		0001B	;打开PD.0 内部上拉电阻
856	0x0135	0x3f8b	   856: 	STA	PPDCR
857			   
858	0x0136	0x780c	   858: 	LDI 	PORTE,		00H
859	0x0137	0x7f9c	   859: 	LDI 	PECR,		0FH 	;设置PortE 作为输出口
860			   
861			   861: 	;ADC初始化
862			   862: 	;tosc = 1/4M = 0.25us, tAD = 8tosc = 2us, 一次A/D 转换时间 = 204tAD = 408 us.
863	0x0138	0x7818	   863: 	LDI 	PACR,		0000B 	;设置PortA0/1 作为输入口
864	0x0139	0x7819	   864: 	LDI 	PBCR,		0000B 	;设置PortB2/3 作为输入口
865	0x013a	0x7894	   865: 	LDI 	ADCCTL,		0001B 	;选择内部参考电压VDD，使能ADC
866	0x013b	0x7a15	   866: 	LDI 	ADCCFG,		0100B 	;A/D 时钟tAD=8tOSC, A/D 转换时间= 204tAD
867	0x013c	0x7e16	   867: 	LDI	ADCPORT,	1100B	;使用AN0 ~ AN7
868	0x013d	0x7817	   868: 	LDI	ADCCHN,		00H	;选择AN0
869	0x013e	0x6c15	   869: 	ORIM 	ADCCFG,		1000B 	;启动A/D 转换
870			   
871			   871: 	;PWM初始化
872	0x013f	0x7820	   872: 	LDI	PWMC0,		0000B	;PWM0 Clock = tosc = 4M
873	0x0140	0x7ea2	   873: 	LDI	PWMP00,		0DH	;周期为125个PWM0 Clock
874	0x0141	0x7ba3	   874: 	LDI	PWMP01,		07H	
875	0x0142	0x7824	   875: 	LDI	PWMD00,		00H	;无微调
876	0x0143	0x7f25	   876: 	LDI	PWMD01,		0EH	;占空比为50%
877	0x0144	0x79a6	   877: 	LDI	PWMD02,		03H	
878			   
879	0x0145	0x7821	   879: 	LDI	PWMC1,		0000B	;PWM0 Clock = tosc = 4M
880	0x0146	0x7ea7	   880: 	LDI	PWMP10,		0DH	;周期为125个PWM0 Clock
881	0x0147	0x7ba8	   881: 	LDI	PWMP11,		07H	
882	0x0148	0x7829	   882: 	LDI	PWMD10,		00H	;无微调
883	0x0149	0x7f2a	   883: 	LDI	PWMD11,		0EH	;占空比为50%
884	0x014a	0x79ab	   884: 	LDI	PWMD12,		03H
885			   
886			   
887			   887: 	;按键相关
888			   888: 	;LDI	CNT0_496MS,	0DH	;初始化496ms 计数器,496 = 8 * 62
889			   889: 	;LDI	CNT0_496MS,	03H	;初始化496ms 计数器
890	0x014b	0x78f8	   890: 	LDI	BTN_PRE_STA,	01H	;初始化上一次没有按键
891			   
892			   892: 	;状态相关
893	0x014c	0x7831	   893: 	LDI	SYSTEM_STATE,	00H	;初始化为"主电"
894			   
895			   895: 	;门限值
896	0x014d	0x7f43	   896: 	LDI	CMP_MIN_PWR0,	0EH	;最小上电电压(1.396V -> 0x8E)
897	0x014e	0x7c44	   897: 	LDI	CMP_MIN_PWR1,	08H	
898			   
899	0x014f	0x794c	   899: 	LDI	CMP_SUPPLY0,	02H	;小于此电压，则开启应急功能(1.115V -> 0x72)
900	0x0150	0x7bcd	   900: 	LDI	CMP_SUPPLY1,	07H
901			   
902	0x0151	0x7f7d	   902: 	LDI	CMP_RESUME0,	0EH	;大于此电压，则由应急转入主电(1.396V -> 0x8E)
903	0x0152	0x7c7e	   903: 	LDI	CMP_RESUME1,	08H
904			   
905	0x0153	0x7952	   905: 	LDI	CMP_EXIT_EMER0,	02H	;电池电压小于此电压时，关闭应急功能(0.96V -> 0x62)
906	0x0154	0x7b53	   906: 	LDI	CMP_EXIT_EMER1,	06H
907			   
908	0x0155	0x7fd4	   908: 	LDI	CMP_BAT_OPEN0,	0FH	;电池电压大于此电压时，视为电池充电回路开路(1.56V -> 0x9F)
909	0x0156	0x7cd5	   909: 	LDI	CMP_BAT_OPEN1,	09H
910			   
911	0x0157	0x79d6	   911: 	LDI	CMP_BAT_FULL0,	03H	;检测到电池电压大于此数值时(1.44V -> 0x93)，视为电池已充满
912	0x0158	0x7cd7	   912: 	LDI	CMP_BAT_FULL1,	09H
913			   
914	0x0159	0x7d58	   914: 除停电标志位
915	0x015a	0x7c59	   915: 	LDI	CMP_BAT_CHARGE1,08H
916			   
917	0x015b	0x7a6a	   917: 	LDI	CMP_LIGHT0,	04H	;供光源检测使用,AD转换结果小于此数值时(0.2V -> 0x14)，表示光源产生故障
918	0x015c	0x78da	   918: 	LDI	CMP_LIGHT1,	01H
919			   919: 	
920	0x015d	0x7ec5	   920: 	LDI	CMP_TYPE00,	0DH	;灯具类型门限0   (0.6V -> 0x3D)
921	0x015e	0x79c6	   921: 	LDI	CMP_TYPE01,	03H
922			   
923	0x015f	0x7d47	   923: 	LDI	CMP_TYPE10,	0AH	;灯具类型门限1   (1.2V -> 0x7A)
924	0x0160	0x7bc8	   924: 	LDI	CMP_TYPE11,	07H
925			   
926	0x0161	0x7c49	   926: 	LDI	CMP_TYPE20,	08H	;灯具类型门限2   (1.8V -> 0xB8)
927	0x0162	0x7dca	   927: 	LDI	CMP_TYPE21,	0BH
928			   
929	0x0163	0x7fe3	   929: 	LDI	CNT0_CHARGE,	0FH	;还应充电多长时间，初始值为20小时，即20 * 60 =1200分钟(0x4B0)
930	0x0164	0x7d64	   930: 	LDI	CNT1_CHARGE,	0AH
931	0x0165	0x7a65	   931: 	LDI	CNT2_CHARGE,	04H
932			   932: 	
933	0x0166	0x7801	   933: 	LDI 	IRQ,		00H
934	0x0167	0x7e00	   934: 	LDI 	IE,		1100B 	;打开ADC,Timer0 中断
935			   
936			   
937			   937: REGISTER_INITIAL_END:
938	0x0168	0xd400	   938: 	RTNI
939			   
940			   
941			   
942			   942: ;*****************************************************
943			   943: ;检查供电是否正常
944			   944: ;*****************************************************
945			   945: PRE_START_PWR_CHK:
946			   
947			   947: WAIT_AD_RESULT:
948			   948: 	;一个通道采样4个数据，去掉最小与最大值，将余下的2个数据平均后得到最终结果。
949			   949: 	;上述过程耗时约408us * 4 = 2ms
950			   950: 	;根据以上推断，四个通道各得出一个最终结果需耗时 2ms * 4 = 8ms
951			   
952			   952: 	;保险起见，此处延时20ms
953	0x0169	0xc366	   953: 	CALL	DELAY_5MS
954	0x016a	0xc366	   954: 	CALL	DELAY_5MS
955	0x016b	0xc366	   955: 	CALL	DELAY_5MS
956	0x016c	0xc366	   956: 	CALL	DELAY_5MS
957			   
958			   958: WAIT_PWR_NML:	
959	0x016d	0x6a41	   959: 	ORIM	FLAG_OCCUPIED,	0100B	;锁定通道6最终结果
960			   
961	0x016e	0x38ad	   961: 	LDA	CHN6_FINAL_RET1,01H
962	0x016f	0x1843	   962: 	SUB	CMP_MIN_PWR0
963	0x0170	0x38ae	   963: 	LDA	CHN6_FINAL_RET2,01H
964	0x0171	0x1044	   964: 	SBC	CMP_MIN_PWR1
965			   
966	0x0172	0x75c1	   966: 	ANDIM	FLAG_OCCUPIED,	1011B	;释放对通道6最终结果的锁定
967			   967: 	
968	0x0173	0x9969	   968: 	BC	WAIT_AD_RESULT		;如果未达到最小上电电压，则一直等待电压升至最小上电电压之上。
969			   
970			   970: PRE_START_PWR_CHK_END:
971	0x0174	0xd400	   971: 	RTNI
972			   
973			   
974			   
975			   975: ;***********************************************************
976			   976: ; 检查灯具类型
977			   977: ; 输入: CHN7_FINAL_RET1, CHN7_FINAL_RET2
978			   978: ; 输出: LIGHT_TYPE
979			   979: ;***********************************************************
980			   980: PRE_START_TYPE_CHK:
981			   
982	0x0175	0x6c41	   982: 	ORIM	FLAG_OCCUPIED,	1000B	;锁定通道7最终结果
983			   
984	0x0176	0x38bd	   984: 	LDA	CHN7_FINAL_RET1,01H	;和门限0比较
985	0x0177	0x1845	   985: 	SUB	CMP_TYPE00
986	0x0178	0x38be	   986: 	LDA	CHN7_FINAL_RET2,01H
987	0x0179	0x1046	   987: 	SBC	CMP_TYPE01
988	0x017a	0x8987	   988: 	BNC	LI_ON			;
989			   
990	0x017b	0x38bd	   990: 	LDA	CHN7_FINAL_RET1,01H	;和门限1比较
991	0x017c	0x1847	   991: 	SUB	CMP_TYPE10
992	0x017d	0x38be	   992: 	LDA	CHN7_FINAL_RET2,01H
993	0x017e	0x1048	   993: 	SBC	CMP_TYPE11
994	0x017f	0x8989	   994: 	BNC	LI_OFF			;
995			   
996	0x0180	0x38bd	   996: 	LDA	CHN7_FINAL_RET1,01H	;和门限2比较
997	0x0181	0x1849	   997: 	SUB	CMP_TYPE20
998	0x0182	0x38be	   998: 	LDA	CHN7_FINAL_RET2,01H
999	0x0183	0x104a	   999: 	SBC	CMP_TYPE21
1000	0x0184	0x898b	   1000: 	BNC	NI_ON			;
1001			   
1002			   1002: NI_OFF:
1003	0x0185	0x7c4b	   1003: 	LDI	LIGHT_TYPE,	1000B
1004	0x0186	0xe18c	   1004: 	JMP	PRE_START_TYPE_CHK_END
1005			   1005: 	
1006			   1006: LI_ON:
1007	0x0187	0x78cb	   1007: 	LDI	LIGHT_TYPE,	0001B
1008	0x0188	0xe18c	   1008: 	JMP	PRE_START_TYPE_CHK_END
1009			   1009: 	
1010			   1010: LI_OFF:
1011	0x0189	0x794b	   1011: 	LDI	LIGHT_TYPE,	0010B
1012	0x018a	0xe18c	   1012: 	JMP	PRE_START_TYPE_CHK_END
1013			   1013: 	
1014			   1014: NI_ON:
1015	0x018b	0x7a4b	   1015: 	LDI	LIGHT_TYPE,	0100B
1016			   1016: 	
1017			   1017: PRE_START_TYPE_CHK_END:
1018	0x018c	0x73c1	   1018: 	ANDIM	FLAG_OCCUPIED,	0111B	;释放对通道7最终结果的锁定
1019	0x018d	0x68c2	   1019: 	ORIM	FLAG_TYPE,	0001B	;不再对通道7进行采样
1020			   1020: 	
1021	0x018e	0xd400	   1021: 	RTNI
1022			   
1023			   
1024			   
1025			   
1026			   
1027			   1027: ;***********************************************************
1028			   1028: ; 通过PWM1输出高电平，对电池进行充电
1029			   1029: ;***********************************************************
1030			   1030: CHARGE_BAT_ENABLE:
1031			   
1032	0x018f	0x7821	   1032: 	LDI	PWMC1,		0000B	;PWM0 Clock = tosc = 4M
1033	0x0190	0x7ea7	   1033: 	LDI	PWMP10,		0DH	;周期为125个PWM0 Clock
1034	0x0191	0x7ba8	   1034: 	LDI	PWMP11,		07H	
1035	0x0192	0x7829	   1035: 	LDI	PWMD10,		00H	;无微调
1036	0x0193	0x7eaa	   1036: 	LDI	PWMD11,		0DH	;占空比为100%
1037	0x0194	0x7bab	   1037: 	LDI	PWMD12,		07H
1038	0x0195	0x68a1	   1038: 	ORIM	PWMC1,		0001B	;使能PWM1输出
1039			   
1040	0x0196	0x68b3	   1040: 	ORIM	ALREADY_ENTER,	0001B	;置已经开始充电标志位
1041	0x0197	0x7fe3	   1041: 	LDI	CNT0_CHARGE,	0FH
1042	0x0198	0x7d64	   1042: 	LDI	CNT1_CHARGE,	0AH
1043	0x0199	0x7a65	   1043: 	LDI	CNT2_CHARGE,	04H
1044			   1044: 	
1045			   1045: CHARGE_BAT_ENABLE_END:
1046	0x019a	0xd400	   1046: 	RTNI
1047			   
1048			   
1049			   1049: ;***********************************************************
1050			   1050: ; 对于锂电池，通过PWM1输出低电平，停止对电池充电
1051			   1051: ; 对于镍镉电池，通过PWM1输出方波，对电池进行涓流充电
1052			   1052: ;***********************************************************
1053			   1053: CHARGE_BAT_DISABLE:
1054	0x019b	0x398e	   1054: 	LDA	TBR,		0011B
1055	0x019c	0x304b	   1055: 	AND	LIGHT_TYPE		;判断电池类型
1056	0x019d	0x81a6	   1056: 	BNZ	LI_BAT
1057			   
1058			   1058: NI_BAT:
1059	0x019e	0x7821	   1059: 	LDI	PWMC1,		0000B	;PWM0 Clock = 8 * tosc = 2us
1060	0x019f	0x7d27	   1060: 	LDI	PWMP10,		0AH	;周期为250个PWM0 Clock
1061	0x01a0	0x7fa8	   1061: 	LDI	PWMP11,		0FH	
1062	0x01a1	0x7829	   1062: 	LDI	PWMD10,		00H	;无微调
1063	0x01a2	0x7f2a	   1063: 	LDI	PWMD11,		0EH	;占空比为1/4
1064	0x01a3	0x79ab	   1064: 	LDI	PWMD12,		03H
1065	0x01a4	0x68a1	   1065: 	ORIM	PWMC1,		0001B	;使能PWM1输出
1066			   1066: 	
1067	0x01a5	0xe1ad	   1067: 	JMP	CHARGE_BAT_DISABLE_END
1068			   
1069			   1069: LI_BAT:
1070	0x01a6	0x7821	   1070: 	LDI	PWMC1,		0000B	;PWM0 Clock = tosc = 4M
1071	0x01a7	0x7827	   1071: 	LDI	PWMP10,		00H	;周期为0个PWM0 Clock
1072	0x01a8	0x7828	   1072: 	LDI	PWMP11,		00H	
1073	0x01a9	0x7829	   1073: 	LDI	PWMD10,		00H	;无微调
1074	0x01aa	0x7eaa	   1074: 	LDI	PWMD11,		0DH	;占空比为100%
1075	0x01ab	0x7bab	   1075: 	LDI	PWMD12,		07H
1076	0x01ac	0x68a1	   1076: 	ORIM	PWMC1,		0001B	;使能PWM1输出
1077			   
1078			   1078: CHARGE_BAT_DISABLE_END:
1079	0x01ad	0x7733	   1079: 	ANDIM	ALREADY_ENTER,	1110B	;清已经开始充电标志位
1080	0x01ae	0xd400	   1080: 	RTNI
1081			   
1082			   
1083			   1083: ;***********************************************************
1084			   1084: ;电池充电控制
1085			   1085: ;***********************************************************
1086			   1086: CHARGE_BAT_CTRL:
1087			   
1088	0x01af	0x6a41	   1088: 	ORIM	FLAG_OCCUPIED,	0100B	;锁定通道6最终结果
1089			   
1090	0x01b0	0x38ad	   1090: 	LDA	CHN6_FINAL_RET1,01H
1091	0x01b1	0x184c	   1091: 	SUB	CMP_SUPPLY0
1092	0x01b2	0x38ae	   1092: 	LDA	CHN6_FINAL_RET2,01H
1093	0x01b3	0x104d	   1093: 	SBC	CMP_SUPPLY1
1094			   
1095	0x01b4	0x75c1	   1095: 	ANDIM	FLAG_OCCUPIED,	1011B	;释放对通道6最终结果的锁定
1096			   
1097	0x01b5	0x99ca	   1097: 	BC	SET_PWR_DOWN_BIT	;如果停电,则跳转
1098			   
1099	0x01b6	0x3833	   1099: 	LDA	ALREADY_ENTER		;如果主电源供电正常，则检查是否已经进入充电状态
1100	0x01b7	0xa1bc	   1100: 	BA0	CHARGE_DURATION		;如果已经进入充电状态
1101			   
1102	0x01b8	0x4269	   1102: 	ADI	BAT_STATE,	0100B		
1103	0x01b9	0xb1cb	   1103: 	BA2	CHARGE_BAT_CTRL_END	;不需要对电池充电
1104			   1104: 	
1105	0x01ba	0xc18f	   1105: 	CALL	CHARGE_BAT_ENABLE	;如果电池电压过低，则开始对电池充电
1106			   
1107	0x01bb	0xe1cb	   1107: 	JMP	CHARGE_BAT_CTRL_END	;不需要对电池充电
1108			   1108: 	
1109			   1109: CHARGE_DURATION:
1110	0x01bc	0x4436	   1110: 	ADI	F_TIME,		1000B
1111	0x01bd	0xb9c5	   1111: 	BA3	IS_BAT_FULL		;1分钟未到
1112			   
1113	0x01be	0x73b6	   1113: 	ANDIM	F_TIME,		0111B	;清1分钟到标志位
1114			   
1115	0x01bf	0x58e3	   1115: 	SBIM	CNT0_CHARGE,	01H	;待充电时长减1分钟
1116	0x01c0	0x780e	   1116: 	LDI	TBR,		00H
1117	0x01c1	0x1464	   1117: 	SBCM	CNT1_CHARGE
1118	0x01c2	0x780e	   1118: 	LDI	TBR,		00H
1119	0x01c3	0x1465	   1119: 	SBCM	CNT2_CHARGE
1120			   
1121	0x01c4	0x89c8	   1121: 	BNC	STOP_CHARGE		;
1122			   1122: 	
1123			   1123: IS_BAT_FULL:
1124	0x01c5	0x3869	   1124: 	LDA	BAT_STATE
1125	0x01c6	0xa9c8	   1125: 	BA1	STOP_CHARGE		;电池已充满
1126			   1126: 	
1127	0x01c7	0xe1cb	   1127: 	JMP	CHARGE_BAT_CTRL_END
1128			   1128: 	
1129			   1129: STOP_CHARGE:
1130	0x01c8	0xc19b	   1130: 	CALL	CHARGE_BAT_DISABLE
1131	0x01c9	0xe1cb	   1131: 	JMP	CHARGE_BAT_CTRL_END
1132			   
1133			   1133: SET_PWR_DOWN_BIT:
1134	0x01ca	0x68b1	   1134: 	ORIM	SYSTEM_STATE,	0001B
1135			   
1136			   1136: CHARGE_BAT_CTRL_END:
1137	0x01cb	0xd400	   1137: 	RTNI
1138			   
1139			   
1140			   1140: ;***********************************************************
1141			   1141: ;打开应急放电
1142			   1142: ;通过PWM0输出频率为32KHZ，占空比为50%的方波，以此驱动应急电路
1143			   1143: ;置停电标志位
1144			   1144: ;置进入应急放电标志位
1145			   1145: ;应急时长清零
1146			   1146: ;***********************************************************
1147			   1147: EMERGENCY_ENABLE:
1148	0x01cc	0x68b1	   1148: 	ORIM	SYSTEM_STATE,	0001B	;置停电标志位
1149	0x01cd	0x6933	   1149: 	ORIM	ALREADY_ENTER,	0010B	;置标志位，表明已打开应急放电功能
1150			   1150: 	
1151	0x01ce	0x784f	   1151: 	LDI	CNT0_EMERGENCY,	00H	;应急时长清零
1152	0x01cf	0x7850	   1152: 	LDI	CNT1_EMERGENCY,	00H
1153	0x01d0	0x7851	   1153: 	LDI	CNT2_EMERGENCY,	00H
1154			   
1155	0x01d1	0x7820	   1155: 	LDI	PWMC0,		0000B	;PWM0 Clock = tosc = 4M
1156	0x01d2	0x7ea2	   1156: 	LDI	PWMP00,		0DH	;周期为125个PWM0 Clock
1157	0x01d3	0x7ba3	   1157: 	LDI	PWMP01,		07H	
1158	0x01d4	0x7824	   1158: 	LDI	PWMD00,		00H	;无微调
1159	0x01d5	0x7f25	   1159: 	LDI	PWMD01,		0EH	;占空比为50%
1160	0x01d6	0x79a6	   1160: 	LDI	PWMD02,		03H
1161	0x01d7	0x68a0	   1161: 	ORIM	PWMC0,		0001B	;使能PWM0输出
1162			   
1163			   1163: EMERGENCY_ENABLE_END:
1164	0x01d8	0xd400	   1164: 	RTNI
1165			   
1166			   
1167			   1167: ;***********************************************************
1168			   1168: ;禁能PWM0，关闭应急功能
1169			   1169: ;***********************************************************
1170			   1170: EMERGENCY_DISABLE:
1171	0x01d9	0x7820	   1171: 	LDI	PWMC0,		0000B	;禁能PWM0
1172			   
1173			   1173: EMERGENCY_DISABLE_END:
1174	0x01da	0xd400	   1174: 	RTNI
1175			   
1176			   
1177			   1177: ;***********************************************************
1178			   1178: ; 发生了应急放电事件，重新计算待充电时长
1179			   1179: ;***********************************************************
1180			   1180: RE_CALC_TIME:
1181	0x01db	0x384e	   1181: 	LDA	DURATION_EMER
1182	0x01dc	0xa1df	   1182: 	BA0	BETWEEN_0_5
1183	0x01dd	0xa9e5	   1183: 	BA1	BETWEEN_5_30
1184	0x01de	0xb1eb	   1184: 	BA2	OVER_30
1185			   
1186			   1186: BETWEEN_0_5:
1187	0x01df	0x4ae3	   1187: 	ADIM	CNT0_CHARGE,	05H	;将待充电时长增加5分钟
1188	0x01e0	0x780e	   1188: 	LDI	TBR,		00H
1189	0x01e1	0x0464	   1189: 	ADCM	CNT1_CHARGE
1190	0x01e2	0x780e	   1190: 	LDI	TBR,		00H
1191	0x01e3	0x0465	   1191: 	ADCM	CNT2_CHARGE
1192			   
1193	0x01e4	0xe1f0	   1193: 	JMP	ADJUST_TIME
1194			   1194: 	
1195			   1195: BETWEEN_5_30:
1196	0x01e5	0x4c63	   1196: 	ADIM	CNT0_CHARGE,	08H	;将待充电时长增加10小时
1197	0x01e6	0x7a8e	   1197: 	LDI	TBR,		05H
1198	0x01e7	0x0464	   1198: 	ADCM	CNT1_CHARGE
1199	0x01e8	0x790e	   1199: 	LDI	TBR,		02H
1200	0x01e9	0x0465	   1200: 	ADCM	CNT2_CHARGE
1201			   
1202	0x01ea	0xe1f0	   1202: 	JMP	ADJUST_TIME
1203			   1203: 	
1204			   1204: OVER_30:				;即使20+20小时，也不会发生溢出
1205	0x01eb	0x4863	   1205: 	ADIM	CNT0_CHARGE,	00H	;将待充电时长增加20小时
1206	0x01ec	0x7d8e	   1206: 	LDI	TBR,		0BH
1207	0x01ed	0x0464	   1207: 	ADCM	CNT1_CHARGE
1208	0x01ee	0x7a0e	   1208: 	LDI	TBR,		04H
1209	0x01ef	0x0465	   1209: 	ADCM	CNT2_CHARGE
1210			   1210: 	
1211			   1211: ADJUST_TIME:
1212	0x01f0	0x1863	   1212: 	SUB	CNT0_CHARGE,	00H	;将待充电时长与20小时作比较
1213	0x01f1	0x7d8e	   1213: 	LDI	TBR,		0BH
1214	0x01f2	0x1064	   1214: 	SBC	CNT1_CHARGE
1215	0x01f3	0x7a0e	   1215: 	LDI	TBR,		04H
1216	0x01f4	0x1065	   1216: 	SBC	CNT2_CHARGE
1217			   
1218	0x01f5	0x89f9	   1218: 	BNC	RE_CALC_TIME_END	;待充电时长小于20小时
1219			   
1220	0x01f6	0x7863	   1220: 	LDI	CNT0_CHARGE,	00H	;将待充电时长设置为20小时
1221	0x01f7	0x7de4	   1221: 	LDI	CNT1_CHARGE,	0BH
1222	0x01f8	0x7a65	   1222: 	LDI	CNT2_CHARGE,	04H
1223			   1223: 		
1224			   1224: RE_CALC_TIME_END:
1225	0x01f9	0xd400	   1225: 	RTNI
1226			   
1227			   
1228			   1228: ;***********************************************************
1229			   1229: ;应急放电控制
1230			   1230: ;主电源停电后的应急放电控制。
1231			   1231: ;何时开始应急放电:主电源AD引脚电压低于1.115V后
1232			   1232: ;何时停止应急放电:主电源AD引脚电压高于1.396V后，或是电池耗尽(电池AD引脚电压低于0.96V)
1233			   1233: ;停止应急放电时，得出应急放电时长
1234			   1234: ;***********************************************************
1235			   1235: EMERGENCY_CTRL:
1236	0x01fa	0x6a41	   1236: 	ORIM	FLAG_OCCUPIED,	0100B	;锁定通道6最终结果
1237			   
1238	0x01fb	0x38ad	   1238: 	LDA	CHN6_FINAL_RET1,01H
1239	0x01fc	0x184c	   1239: 	SUB	CMP_SUPPLY0
1240	0x01fd	0x38ae	   1240: 	LDA	CHN6_FINAL_RET2,01H
1241	0x01fe	0x104d	   1241: 	SBC	CMP_SUPPLY1
1242			   
1243	0x01ff	0x75c1	   1243: 	ANDIM	FLAG_OCCUPIED,	1011B	;释放对通道6最终结果的锁定
1244			   
1245			   
1246	0x0200	0x8a05	   1246: 	BNC	CHK_PWR_RESUME		;如果主电源引脚电压大于1.115V，则跳转
1247			   
1248	0x0201	0x3833	   1248: 	LDA	ALREADY_ENTER		;如果主电源引脚电压小于1.115V，则检查是否已经进入应急状态
1249	0x0202	0xaa2a	   1249: 	BA1	EMERGENCY_CNT		;如果已经进入应急状态，则跳转
1250			   
1251	0x0203	0xc1cc	   1251: 	CALL	EMERGENCY_ENABLE	;如果停电且还未进入应急状态,则打开应急
1252	0x0204	0xe23c	   1252: 	JMP	EMERGENCY_CTRL_END
1253			   
1254			   
1255			   1255: CHK_PWR_RESUME:
1256	0x0205	0x6a41	   1256: 	ORIM	FLAG_OCCUPIED,	0100B	;锁定通道6最终结果
1257			   
1258	0x0206	0x38ad	   1258: 	LDA	CHN6_FINAL_RET1,01H
1259	0x0207	0x187d	   1259: 	SUB	CMP_RESUME0
1260	0x0208	0x38ae	   1260: 	LDA	CHN6_FINAL_RET2,01H
1261	0x0209	0x107e	   1261: 	SBC	CMP_RESUME1
1262			   
1263	0x020a	0x75c1	   1263: 	ANDIM	FLAG_OCCUPIED,	1011B	;释放对通道6最终结果的锁定
1264			   
1265	0x020b	0x9a0f	   1265: 	BC	SMALL_THAN_1P396V	;如果1.115v < X < 1.396V
1266			   
1267	0x020c	0x3833	   1267: 	LDA	ALREADY_ENTER		;X > 1.396V
1268	0x020d	0xaa12	   1268: 	BA1	STOP_EMERGENCY		;如果已经进入应急状态，则跳转
1269	0x020e	0xe23c	   1269: 	JMP	EMERGENCY_CTRL_END
1270			   
1271			   
1272			   1272: SMALL_THAN_1P396V:
1273	0x020f	0x3833	   1273: 	LDA	ALREADY_ENTER		;检查是否已经进入应急状态
1274	0x0210	0xaa2a	   1274: 	BA1	EMERGENCY_CNT		;如果已经进入应急状态，则跳转
1275	0x0211	0xe23c	   1275: 	JMP	EMERGENCY_CTRL_END
1276			   
1277			   
1278			   1278: STOP_EMERGENCY:
1279	0x0212	0x7731	   1279: 	ANDIM	SYSTEM_STATE,	1110B	;清除停电标志位
1280	0x0213	0x76b3	   1280: H
1281			   
1282			   1282: BAT_DOWN:	
1283	0x0214	0xc1d9	   1283: 	CALL	EMERGENCY_DISABLE
1284			   
1285	0x0215	0x564f	   1285: 	SBI	CNT0_EMERGENCY,	0CH	;和5分钟比较(0x12C)
1286	0x0216	0x790e	   1286: 	LDI	TBR,		02H
1287	0x0217	0x1050	   1287: 	SBC	CNT1_EMERGENCY
1288	0x0218	0x788e	   1288: 	LDI	TBR,		01H
1289	0x0219	0x1051	   1289: 	SBC	CNT2_EMERGENCY
1290			   
1291	0x021a	0x8a24	   1291: 	BNC	LESS_5_MINUTE		;应急时长小于5分钟
1292			   
1293	0x021b	0x544f	   1293: 	SBI	CNT0_EMERGENCY,	08H	;和30分钟比较(0x708)
1294	0x021c	0x780e	   1294: 	LDI	TBR,		00H
1295	0x021d	0x1050	   1295: 	SBC	CNT1_EMERGENCY
1296	0x021e	0x7b8e	   1296: 	LDI	TBR,		07H
1297	0x021f	0x1051	   1297: 	SBC	CNT2_EMERGENCY
1298			   
1299	0x0220	0x8a27	   1299: 	BNC	LESS_30_MINUTE		;应急时长小于30分钟
1300			   
1301			   1301: MORE_30_MINUTE:				;应急时长大于30分钟
1302	0x0221	0x6a4e	   1302: 	ORIM	DURATION_EMER,	0100B
1303	0x0222	0xc1db	   1303: 	CALL	RE_CALC_TIME		;发生了应急放电事件，重新计算待充电时长
1304	0x0223	0xe23c	   1304: 	JMP	EMERGENCY_CTRL_END
1305			   
1306			   1306: LESS_5_MINUTE:
1307	0x0224	0x68ce	   1307: 	ORIM	DURATION_EMER,	0001B
1308	0x0225	0xc1db	   1308: 	CALL	RE_CALC_TIME		;发生了应急放电事件，重新计算待充电时长
1309	0x0226	0xe23c	   1309: 	JMP	EMERGENCY_CTRL_END
1310			   1310: 	
1311			   1311: LESS_30_MINUTE:
1312	0x0227	0x694e	   1312: 	ORIM	DURATION_EMER,	0010B
1313	0x0228	0xc1db	   1313: 	CALL	RE_CALC_TIME		;发生了应急放电事件，重新计算待充电时长
1314	0x0229	0xe23c	   1314: 	JMP	EMERGENCY_CTRL_END
1315			   1315: 	
1316			   
1317			   1317: EMERGENCY_CNT:
1318	0x022a	0x40b5	   1318: 	ADI	F_1S,		0001B	;每秒检查一次
1319	0x022b	0xa234	   1319: 	BA0	EMERGENCY_BATTERY
1320			   
1321	0x022c	0x7735	   1321: 	ANDIM	F_1S,		1110B	;清除1s标志位
1322	0x022d	0x5451	   1322: 	SBI	CNT2_EMERGENCY,	08H	;如果CNT达到0x800，则表示已应急放电0x800s = 2048s > 30min
1323	0x022e	0x9a34	   1323: 	BC	EMERGENCY_BATTERY	;此时无需再对应急放电时长计时
1324			   
1325	0x022f	0x48cf	   1325: 	ADIM	CNT0_EMERGENCY,	01H
1326	0x0230	0x780e	   1326: 	LDI	TBR,		00H
1327	0x0231	0x0450	   1327: 	ADCM	CNT1_EMERGENCY
1328	0x0232	0x780e	   1328: 	LDI	TBR,		00H
1329	0x0233	0x0451	   1329: 	ADCM	CNT2_EMERGENCY
1330			   
1331			   1331: EMERGENCY_BATTERY:			;检查电池是否已经耗尽
1332	0x0234	0x6941	   1332: 	ORIM	FLAG_OCCUPIED,	0010B	;锁定通道1最终结果
1333			   
1334	0x0235	0x389d	   1334: 	LDA	CHN1_FINAL_RET1,01H
1335	0x0236	0x1852	   1335: 	SUB	CMP_EXIT_EMER0
1336	0x0237	0x389e	   1336: 	LDA	CHN1_FINAL_RET2,01H
1337	0x0238	0x1053	   1337: 	SBC	CMP_EXIT_EMER1
1338			   
1339	0x0239	0x76c1	   1339: 	ANDIM	FLAG_OCCUPIED,	1101B	;释放对通道1最终结果的锁定
1340			   
1341	0x023a	0x8a3c	   1341: 	BNC	EMERGENCY_CTRL_END
1342	0x023b	0xe214	   1342: 	JMP	BAT_DOWN		;
1343			   
1344			   
1345			   1345: EMERGENCY_CTRL_END:
1346	0x023c	0xd400	   1346: 	RTNI
1347			   
1348			   
1349			   
1350			   1350: ;***********************************************************
1351			   1351: ;检查电池电压。
1352			   1352: ;根据所测得电池电压结果，置相应电池状态标志位
1353			   1353: ;输出
1354			   1354: ;-- BAT_STATE		电池状态，位图形式表示
1355			   1355: ;-- ALARM_STATE.0		故障标志位
1356			   1356: ;***********************************************************
1357			   1357: BAT_STATE_CHK:
1358			   
1359	0x023d	0x6941	   1359: 	ORIM	FLAG_OCCUPIED,	0010B	;锁定通道1最终结果
1360			   
1361	0x023e	0x389d	   1361: 	LDA	CHN1_FINAL_RET1,01H	
1362	0x023f	0x1854	   1362: 	SUB	CMP_BAT_OPEN0		;判断电池是否开路
1363	0x0240	0x389e	   1363: 	LDA	CHN1_FINAL_RET2,01H
1364	0x0241	0x1055	   1364: 	SBC	CMP_BAT_OPEN1
1365	0x0242	0x8a51	   1365: 	BNC	BAT_OPEN		;AD转换结果大于1.56V，电池开路
1366	0x0243	0x7769	   1366: 	ANDIM	BAT_STATE,	1110B	;清除充电回路开路标志位
1367	0x0244	0x775c	   1367: 	ANDIM	ALARM_STATE,	1110B	;清除充电回路开路故障标志位
1368			   
1369	0x0245	0x389d	   1369: 	LDA	CHN1_FINAL_RET1,01H	
1370	0x0246	0x1856	   1370: 	SUB	CMP_BAT_FULL0		;判断电池是否充满
1371	0x0247	0x389e	   1371: 	LDA	CHN1_FINAL_RET2,01H
1372	0x0248	0x1057	   1372: 	SBC	CMP_BAT_FULL1
1373	0x0249	0x8a54	   1373: 	BNC	BAT_FULL		;AD转换结果大于1.44V，电池已充满
1374	0x024a	0x76e9	   1374: 	ANDIM	BAT_STATE,	1101B	;清除电池已充满标志位
1375			   
1376	0x024b	0x389d	   1376: 	LDA	CHN1_FINAL_RET1,01H	
1377	0x024c	0x1858	   1377: 	SUB	CMP_BAT_CHARGE0		;判断电池是否过低，需要充电了
1378	0x024d	0x389e	   1378: 	LDA	CHN1_FINAL_RET2,01H
1379	0x024e	0x1059	   1379: 	SBC	CMP_BAT_CHARGE1
1380	0x024f	0x9a57	   1380: 	BC	BAT_NEED_CHARGE		;AD转换结果小于1.35V，电池需要重新充电
1381	0x0250	0xe259	   1381: 	JMP	BAT_STATE_CHK_END
1382			   
1383			   1383: BAT_OPEN:
1384	0x0251	0x68e9	   1384: 	ORIM	BAT_STATE,	0001B	;置充电回路开路标志位
1385	0x0252	0x68dc	   1385: 	ORIM	ALARM_STATE,	0001B	;置充电回路开路故障标志位	
1386	0x0253	0xe259	   1386: 	JMP	BAT_STATE_CHK_END
1387			   
1388			   1388: BAT_FULL:
1389	0x0254	0x6969	   1389: 	ORIM	BAT_STATE,	0010B	;置电池已充满标志位
1390	0x0255	0x75e9	   1390: 	ANDIM	BAT_STATE,	1011B	;清电池需要重新充电标志位
1391	0x0256	0xe259	   1391: 	JMP	BAT_STATE_CHK_END
1392			   
1393			   1393: BAT_NEED_CHARGE:
1394	0x0257	0x6a69	   1394: 	ORIM	BAT_STATE,	0100B	;置电池需要重新充电标志位
1395	0x0258	0xe259	   1395: 	JMP	BAT_STATE_CHK_END
1396			   
1397			   1397: BAT_STATE_CHK_END:
1398	0x0259	0x76c1	   1398: 	ANDIM	FLAG_OCCUPIED,	1101B	;释放对通道1最终结果的锁定
1399	0x025a	0xd400	   1399: 	RTNI
1400			   
1401			   
1402			   1402: ;***********************************************************
1403			   1403: ;根据通道0转换结果，检测光源状态，并设置光源故障标志位
1404			   1404: ;***********************************************************
1405			   1405: PROCESS_LIGHT:
1406			   
1407	0x025b	0x68c1	   1407: 	ORIM	FLAG_OCCUPIED,	0001B	;锁定通道0最终结果
1408			   
1409	0x025c	0x388d	   1409: 	LDA	CHN0_FINAL_RET1,01H
1410	0x025d	0x186a	   1410: 	SUB	CMP_LIGHT0
1411	0x025e	0x388e	   1411: 	LDA	CHN0_FINAL_RET2,01H
1412	0x025f	0x105a	   1412: 	SBC	CMP_LIGHT1
1413			   
1414	0x0260	0x7741	   1414: 	ANDIM	FLAG_OCCUPIED,	1110B	;释放对通道0最终结果的锁定
1415			   
1416	0x0261	0x9a64	   1416: 	BC	ERROR_LIGHT		;光源故障
1417			   
1418	0x0262	0x76dc	   1418: 	ANDIM	ALARM_STATE,	1101B	;清除光源故障标志位
1419	0x0263	0xe265	   1419: 	JMP     PROCESS_LIGHT_END
1420			   
1421			   1421: ERROR_LIGHT:
1422	0x0264	0x695c	   1422: 	ORIM	ALARM_STATE,	0010B	;置光源故障标志位
1423			   
1424			   1424: PROCESS_LIGHT_END:
1425	0x0265	0xd400	   1425: 	RTNI
1426			   
1427			   1427: ;***********************************************************
1428			   1428: ;光源状态检测，并置相应标志位
1429			   1429: ;***********************************************************
1430			   1430: LIGHT_STATE_CHK:
1431			   
1432	0x0266	0x7a8e	   1432: 	LDI	TBR,		0101B	;将立即数0101B载入累加器A中
1433	0x0267	0x304b	   1433: 	AND	LIGHT_TYPE		;BIT0\2为1，代表灯具为常亮型
1434			   
1435	0x0268	0x826a	   1435: 	BNZ	TYPE_ON			;为常亮型灯具
1436	0x0269	0xe26c	   1436: 	JMP	TYPE_OFF		;为常灭型灯具
1437			   1437: 	
1438			   1438: TYPE_ON:
1439	0x026a	0xc25b	   1439: 	CALL	PROCESS_LIGHT		;检测光源，并设置相应标志位
1440	0x026b	0xe26f	   1440: 	JMP     LIGHT_STATE_CHK_END
1441			   
1442			   1442: TYPE_OFF:
1443	0x026c	0x40b1	   1443: 	ADI	SYSTEM_STATE,	01H	;检查主电源供电是否正常
1444	0x026d	0xa26f	   1444: 	BA0	LIGHT_STATE_CHK_END	;处于主电源正常供电状态，无需对光源进行检测
1445	0x026e	0xc25b	   1445: 	CALL	PROCESS_LIGHT		;检测光源，并设置相应标志位
1446			   
1447			   1447: LIGHT_STATE_CHK_END:
1448	0x026f	0xd400	   1448: 	RTNI
1449			   
1450			   
1451			   1451: ;***********************************************************
1452			   1452: ;LED与蜂鸣器控制
1453			   1453: ;充电回路无故障的前提下，红色LED:未充电时关闭红灯，在充电时打开红灯
1454			   1454: ;充电回路开路/短路: 红灯灭，黄灯1HZ闪烁
1455			   1455: ;光源开路/短路:             黄灯3HZ闪烁
1456			   1456: ;放电时间不足:              黄灯常亮
1457			   1457: ;并根据模式标志位，控制蜂鸣器
1458			   1458: ;***********************************************************
1459			   1459: TIPS_PROCESS:
1460			   1460: ;红灯的处理
1461			   1461: RED:
1462	0x0270	0x385c	   1462: 	LDA	ALARM_STATE 		;判断电池充电回路是否处于故障状态
1463	0x0271	0xa274	   1463: 	BA0	RED_ERROR		;电池有故障，则跳转
1464			   
1465	0x0272	0x3833	   1465: 	LDA	ALREADY_ENTER		;电池充电回路没有故障，
1466	0x0273	0xa276	   1466: 	BA0	RED_ON
1467			   1467: 	
1468			   1468: RED_ERROR:	
1469	0x0274	0x770a	   1469: 	ANDIM	PORTC,		1110B	;关闭红灯
1470	0x0275	0xe277	   1470: 	JMP	GREEN
1471			   
1472			   1472: RED_ON:
1473	0x0276	0x688a	   1473: 	ORIM	PORTC,		0001B	;打开红灯	
1474			   
1475			   1475: ;--------------------------------------------------------------------------
1476			   1476: ;绿灯的处理
1477			   1477: GREEN:
1478	0x0277	0x3866	   1478: 	LDA	GREEN_FLASH
1479	0x0278	0xaa80	   1479: 	BA1	GREEN_1HZ
1480	0x0279	0xb288	   1480: 	BA2	GREEN_3HZ
1481			   
1482	0x027a	0x3831	   1482: 	LDA	SYSTEM_STATE
1483	0x027b	0x827e	   1483: 	BNZ	GREEN_OFF		;如果当前系统为应急状态，则绿灯灭
1484	0x027c	0x690a	   1484: 	ORIM	PORTC,		0010B	;如果当前系统主电源正常，则绿灯亮
1485	0x027d	0xe28b	   1485: 	JMP	ALARM_BAT
1486			   
1487			   1487: GREEN_OFF:
1488	0x027e	0x768a	   1488: 	ANDIM	PORTC,		1101B	;熄灭绿灯
1489	0x027f	0xe28b	   1489: 	JMP	ALARM_BAT
1490			   
1491			   1491: GREEN_1HZ:	
1492	0x0280	0x40fc	   1492: 	ADI	F_168MS,	01H	;判断是否到了一个新168MS
1493	0x0281	0xa2a3	   1493: 	BA0 	TIPS_PROCESS_END	;还没有到168MS，直接跳至结束
1494			   1494: 	
1495	0x0282	0x48e7	   1495: 	ADIM	CNT_LED_GREEN,	01H
1496	0x0283	0x51e7	   1496: 	SBI	CNT_LED_GREEN,	03H
1497			   
1498	0x0284	0x8a8b	   1498: 	BNC	ALARM_BAT
1499	0x0285	0x7867	   1499: 	LDI	CNT_LED_GREEN,	00H
1500	0x0286	0x610a	   1500: 	EORIM	PORTC,		0010B
1501	0x0287	0xe28b	   1501: 	JMP	ALARM_BAT
1502			   
1503			   1503: GREEN_3HZ:	
1504	0x0288	0x40fc	   1504: 	ADI	F_168MS,	01H	;判断是否到了一个新168MS
1505	0x0289	0xa2a3	   1505: 	BA0 	TIPS_PROCESS_END
1506	0x028a	0x610a	   1506: 	EORIM	PORTC,		0010B
1507			   1507: 	
1508			   1508: ;--------------------------------------------------------------------------
1509			   1509: ;电池充电回路故障处理
1510			   1510: ALARM_BAT:	
1511	0x028b	0x788e	   1511: 	LDI	TBR,		0001B	;将0001B载入累加器A中
1512	0x028c	0x305c	   1512: 	AND	ALARM_STATE 		;判断电池是否处于故障状态
1513	0x028d	0x9295	   1513: 	BAZ	ALARM_LIGHT		;电池没有故障，则跳转
1514			   
1515	0x028e	0x40fc	   1515: 	ADI	F_168MS,	01H	;判断是否到了一个新168MS
1516	0x028f	0xa29b	   1516: 	BA0	ALARM_TIME_NOT_ENOUGH	;还未到新的168MS,跳转
1517			   
1518	0x0290	0x48df	   1518: 	ADIM	CNT_LED_YELLOW,	01H	;168MS已到，计数器加1
1519			   
1520	0x0291	0x51df	   1520: 	SBI	CNT_LED_YELLOW,	03H
1521	0x0292	0x8a95	   1521: 	BNC	ALARM_LIGHT		;未满500ms
1522			   
1523	0x0293	0x785f	   1523: 	LDI	CNT_LED_YELLOW,	00H	;清零计数器
1524	0x0294	0x608c	   1524: 	EORIM	PORTE,		0001B	;以1HZ频率翻转黄灯
1525			   
1526			   1526: ;--------------------------------------------------------------------------
1527			   1527: ;光源故障的处理
1528			   1528: ALARM_LIGHT:
1529	0x0295	0x790e	   1529: 	LDI	TBR,		0010B	;将0010B载入累加器A中
1530	0x0296	0x305c	   1530: 	AND	ALARM_STATE		;判断光源是否处于故障状态
1531	0x0297	0x929b	   1531: 	BAZ	ALARM_TIME_NOT_ENOUGH	;光源没有故障，则跳转
1532			   
1533	0x0298	0x40fa	   1533: 	ADI	CNT0_168MS,	01H	;判断是否到了一个新168MS
1534	0x0299	0xa29b	   1534: 	BA0	ALARM_TIME_NOT_ENOUGH	;还未到新的168MS,跳转
1535			   
1536	0x029a	0x608c	   1536: 	EORIM	PORTE,		0001B	;以3HZ频率翻转黄灯
1537			   
1538			   1538: ;--------------------------------------------------------------------------
1539			   1539: ;应急时长不足的处理
1540			   1540: ALARM_TIME_NOT_ENOUGH:
1541	0x029b	0x7a0e	   1541: 	LDI	TBR,		0100B	;将0100B载入累加器A中
1542	0x029c	0x305c	   1542: 	AND	ALARM_STATE		;判断是否出现放电时间不足之故障
1543	0x029d	0x92a0	   1543: 	BAZ	OFF_LED_YELLOW		;没有出现放电时间不足之故障，则跳转
1544			   1544: 	
1545	0x029e	0x688c	   1545: 	ORIM	PORTE,		0001B	;黄灯长亮
1546	0x029f	0xe2a3	   1546: 	JMP	TIPS_PROCESS_END
1547			   
1548			   1548: OFF_LED_YELLOW:
1549	0x02a0	0x385c	   1549: 	LDA	ALARM_STATE		;如果没有任何故障，则关闭黄灯
1550	0x02a1	0x82a3	   1550: 	BNZ	TIPS_PROCESS_END
1551	0x02a2	0x770c	   1551: 	ANDIM	PORTE,		1110B
1552			   
1553			   1553: ;--------------------------------------------------------------------------
1554			   
1555			   1555: TIPS_PROCESS_END:
1556	0x02a3	0x777c	   1556: 	ANDIM	F_168MS,	1110B	;清除168MS标志
1557	0x02a4	0xd400	   1557: 	RTNI
1558			   
1559			   
1560			   
1561			   1561: ;***********************************************************
1562			   1562: ;按键扫描
1563			   1563: ;输入: 
1564			   1564: ;-- F_168MS.1		168ms标志
1565			   1565: ;-- PORTD.0		按键状态，1为未按下，0表示按键被按下
1566			   1566: ;输出: 		
1567			   1567: ;-- BTN_PRE_STA		上一次按键扫描时的按键状态
1568			   1568: ;-- PRESS_DURATION		本次按键按下的时长，位图形式表示
1569			   1569: ;局部变量:
1570			   1570: ;-- TEMP	
1571			   1571: ;-- BTN_PRESS_CNT		本次按键按下的时长，单位为多少个168ms
1572			   1572: ;***********************************************************
1573			   1573: KEY_PROCESS:
1574			   
1575	0x02a5	0x7f1b	   1575: 	LDI 	PDCR,		1110B 	;设置PD.0 为输入，PD.3 为输出
1576			   1576: 	
1577			   1577: KEY_CHECK:
1578	0x02a6	0x417c	   1578: 	ADI	F_168MS,	0010B	;检查168MS标志位
1579	0x02a7	0xaad8	   1579: 	BA1	KEY_PROCESS_END		;未到168ms，暂时不做按键扫描
1580			   
1581	0x02a8	0x76fc	   1581: 	ANDIM	F_168MS,	1101B	;清168MS标志位
1582			   1582: 	;CALL 	DELAY_5MS 		;消除按键抖动
1583			   1583: 	
1584	0x02a9	0x380b	   1584: 	LDA 	PORTD,		00H 	;读取PD 口状态
1585	0x02aa	0x3c75	   1585: 	STA 	TEMP,		00H 	;把PD 口状态存到TEMP 寄存器中
1586			   1586: 	;CALL 	DELAY_5MS 		;消除按键抖动
1587			   1587: 	
1588			   1588: 	;LDA 	PORTD,		00H 	;读取PD 口状态
1589			   1589: 	;SUB 	TEMP,		00H 	;比较读取PD.0 口状态值，不相等则错误
1590			   1590: 	;BA0 	KEY_ERROR
1591			   1591: 	;CALL 	DELAY_5MS 		;消除按键抖动
1592			   1592: 	
1593	0x02ab	0x380b	   1593: 	LDA 	PORTD,		00H 	;读取PD 口状态
1594	0x02ac	0x1875	   1594: 	SUB 	TEMP,		00H 	;比较读取PD.0 口状态值，不相等则错误
1595	0x02ad	0xa2d4	   1595: 	BA0 	KEY_ERROR
1596			   1596: 	
1597	0x02ae	0x3875	   1597: 	LDA 	TEMP		 	;将TEMP 中的数据储存至累加器A 中
1598	0x02af	0xa2b1	   1598: 	BA0	NO_KEY_PRESSED		;没有检测到按键
1599			   1599: 	
1600	0x02b0	0xe2b8	   1600: 	JMP	KEY_PRESSED		;检测到按键被按下
1601			   
1602			   1602: NO_KEY_PRESSED:
1603	0x02b1	0x3878	   1603: 	LDA	BTN_PRE_STA		;将上一次按键状态载入累加器A 中
1604	0x02b2	0x0875	   1604: 	ADD	TEMP			;TEMP + A -> A
1605	0x02b3	0xa2b5	   1605: 	BA0	KEY_RELEASED		;上一次按下，本次未按下
1606			   
1607	0x02b4	0xe2d3	   1607: 	JMP 	ALWAYS_NO_KEY		;上一次未按下，本次也未按下
1608			   
1609			   1609: KEY_RELEASED:
1610	0x02b5	0x7879	   1610: 	LDI	BTN_PRESS_CNT0,	00H
1611	0x02b6	0x7868	   1611: 	LDI	BTN_PRESS_CNT1,	00H
1612	0x02b7	0xe2d6	   1612: 	ALREADY_ENTER,	0111B	;清
1613			   
1614			   1614: KEY_PRESSED:	
1615	0x02b8	0x5579	   1615: 	SBI	BTN_PRESS_CNT0, 0AH	;比较BTN_PRESS_CNT 与 0x2A 的大小
1616	0x02b9	0x790e	   1616: 	LDI	TBR,		02H
1617	0x02ba	0x1068	   1617: 	SBC	BTN_PRESS_CNT1
1618	0x02bb	0x9ad6	   1618: 	BC	KEY_CHECK_PROCESS_OVER	;如果BTN_PRESS_CNT已经累加至0x2A，则不再累加
1619			   
1620	0x02bc	0x48f9	   1620: 	ADIM	BTN_PRESS_CNT0,	01H	;168MS计时次数加1
1621	0x02bd	0x780e	   1621: 	LDI	TBR,		00H
1622	0x02be	0x0468	   1622: 	ADCM	BTN_PRESS_CNT1
1623			   
1624			   1624: KEY_PRESSED_DURATION_CHK:
1625	0x02bf	0x5179	   1625: 	SBI	BTN_PRESS_CNT0,	02H	;
1626	0x02c0	0x788e	   1626: 	LDI	TBR,		01H
1627	0x02c1	0x1068	   1627: 	SBC	BTN_PRESS_CNT1
1628	0x02c2	0x8acd	   1628: 	BNC	KPC_LESS_3S		;按键持续时长小于3S, 18 * 168ms = 3s
1629			   
1630	0x02c3	0x5779	   1630: 	SBI	BTN_PRESS_CNT0,	0EH	;
1631	0x02c4	0x788e	   1631: 	LDI	TBR,		01H
1632	0x02c5	0x1068	   1632: 	SBC	BTN_PRESS_CNT1
1633	0x02c6	0x8acf	   1633: 	BNC	KPC_LESS_5S		;按键持续时长小于5S, 30 * 168ms = 5s
1634			   
1635	0x02c7	0x5579	   1635: 	SBI	BTN_PRESS_CNT0,	0AH	;
1636	0x02c8	0x790e	   1636: 	LDI	TBR,		02H
1637	0x02c9	0x1068	   1637: 	SBC	BTN_PRESS_CNT1
1638	0x02ca	0x8ad1	   1638: 	BNC	KPC_LESS_7S		;按键持续时长小于7S, 42 * 168ms = 7s
1639			   
1640			   1640: KPC_MORE_7S:
1641	0x02cb	0x7c7f	   1641: 	LDI	PRESS_DURATION,	1000B	;置"大于7秒"状态
1642	0x02cc	0xe2d6	   1642: 	JMP	KEY_CHECK_PROCESS_OVER	
1643			   1643: KPC_LESS_3S:
1644	0x02cd	0x78ff	   1644: 	LDI	PRESS_DURATION,	0001B	;置"小于3秒"状态
1645	0x02ce	0xe2d6	   1645: 	JMP	KEY_CHECK_PROCESS_OVER
1646			   1646: KPC_LESS_5S:
1647	0x02cf	0x797f	   1647: 	LDI	PRESS_DURATION,	0010B	;置"大于3秒，小于5秒"状态
1648	0x02d0	0xe2d6	   1648: 	JMP	KEY_CHECK_PROCESS_OVER
1649			   1649: KPC_LESS_7S:
1650	0x02d1	0x7a7f	   1650: 	LDI	PRESS_DURATION,	0100B	;置"大于5秒，小于7秒"状态
1651	0x02d2	0xe2d6	   1651: 	JMP	KEY_CHECK_PROCESS_OVER
1652			   
1653			   1653: ALWAYS_NO_KEY:
1654	0x02d3	0x787f	   1654: 	LDI	PRESS_DURATION,	00H
1655			   1655: KEY_ERROR: 				;错误键值处理
1656			   1656: ;ON_RELEASED:
1657	0x02d4	0x7879	   1657: 	LDI	BTN_PRESS_CNT0,	00H
1658	0x02d5	0x7868	   1658: 	LDI	BTN_PRESS_CNT1,	00H
1659			   1659: 	
1660			   1660: KEY_CHECK_PROCESS_OVER: 		;按键扫描及处理结束，返回
1661	0x02d6	0x70f5	   1661: 	ANDIM	TEMP,		0001B	;
1662	0x02d7	0x3c78	   1662: 	STA	BTN_PRE_STA		;TEMP -> BTN_PRE_STA
1663			   1663: 	
1664			   1664: KEY_PROCESS_END:
1665	0x02d8	0xd400	   1665: 	RTNI
1666			   
1667			   1667: 	
1668			   
1669			   
1670			   1670: ;***********************************************************
1671			   1671: ;设置自检标志位
1672			   1672: ;输入
1673			   1673: ;-- F_TIME		系统时间的月、年标志位
1674			   1674: ;-- BTN_PRE_STA		当前按键状态
1675			   1675: ;-- PRESS_DURATION		按键被按下所持续时长，位图形式表示
1676			   1676: ;输出
1677			   1677: ;-- SELF_STATE		自检标志
1678			   1678: ;-- GREEN_FLASH		绿灯闪烁标志位
1679			   1679: ;
1680			   1680: ;***********************************************************
1681			   1681: SELF_CHK_STATE:
1682			   1682: 	;LDA	SYSTEM_STATE
1683			   1683: 	;BA0	SELF_CHK_STATE_END	;当前处于停电状态，不作自检标志位检查
1684			   
1685	0x02d9	0x3836	   1685: 	LDA	F_TIME
1686	0x02da	0xb2fc	   1686: 	BA2	SET_YEAR_BIT		;如果1年时间已到，则跳转
1687	0x02db	0xaaf9	   1687: 	BA1	SET_MONTH_BIT		;如果1月时间已到，则跳转
1688			   
1689			   1689: ;--------------------------------------------------------------------------------------
1690			   
1691			   1691: MANUAL_CHK:
1692	0x02dc	0x3878	   1692: 	LDA	BTN_PRE_STA		;载入当前按键状态
1693	0x02dd	0xa2e5	   1693: 	BA0	SCT_BTN_RELEASED	;如果当前没有按键被按下，则跳转
1694			   
1695	0x02de	0x7b0e	   1695: 	LDI	TBR,		0110B
1696	0x02df	0x3032	   1696: 	AND	SELF_STATE
1697	0x02e0	0x92e4	   1697: 	BAZ	SCT_SET_EMEG		;如果按键被按下，并且系统未进入月检或是年检状态，则跳转
1698			   
1699	0x02e1	0x7832	   1699: 	LDI	SELF_STATE,	00H	;如果按键被按下，并且系统处于月检可是年检状态，则退出
1700	0x02e2	0x7866	   1700: 	LDI	GREEN_FLASH,	00H	;月检或是年检状态，停止绿灯的闪烁
1701	0x02e3	0xe2ff	   1701: 	JMP	SELF_CHK_STATE_END
1702			   
1703			   1703: SCT_SET_EMEG:
1704	0x02e4	0x7cb2	   1704: 	LDI	SELF_STATE,	1001B	;置模拟应急标志位
1705			   
1706			   1706: SCT_BTN_RELEASED:
1707	0x02e5	0x387f	   1707: 	LDA	PRESS_DURATION		
1708	0x02e6	0xa2ea	   1708: 	BA0	SCS_LESS_3S		;如果持续按键时长小于3秒，则跳转
1709	0x02e7	0xaaef	   1709: 	BA1	SCS_LESS_5S		;如果持续按键时长大于3秒，小于5秒，则跳转
1710	0x02e8	0xb2f4	   1710: 	BA2	SCS_LESS_7S		;如果持续按键时长大于5秒，小于7秒，则跳转
1711	0x02e9	0xe2ff	   1711: 	JMP	SELF_CHK_STATE_END
1712			   1712: 	
1713			   1713: ;--------------------------------------------------------------------------------------
1714			   
1715			   1715: SCS_LESS_3S:
1716	0x02ea	0x7866	   1716: 	LDI	GREEN_FLASH,	00H	;让绿灯停止闪烁
1717			   
1718	0x02eb	0x40f8	   1718: 	ADI	BTN_PRE_STA,	01H
1719	0x02ec	0xa2ff	   1719: 	BA0	SELF_CHK_STATE_END	;如果当前按键为按下状态，则跳转
1720			   1720: 	
1721	0x02ed	0x7832	   1721: 	LDI	SELF_STATE,	00H	;退出月检、年检、模拟停电、手动月检、手动年检状态
1722	0x02ee	0xe2ff	   1722: 	JMP	SELF_CHK_STATE_END
1723			   
1724			   1724: ;--------------------------------------------------------------------------------------
1725			   
1726			   1726: SCS_LESS_5S:
1727	0x02ef	0x7966	   1727: 	LDI	GREEN_FLASH,	0010B	;让绿灯以1HZ的频率开始闪烁
1728			   
1729	0x02f0	0x40f8	   1729: 	ADI	BTN_PRE_STA,	01H
1730	0x02f1	0xa2ff	   1730: 	BA0	SELF_CHK_STATE_END	;如果当前按键为按下状态，则跳转
1731			   1731: 	
1732	0x02f2	0x7d32	   1732: 	LDI	SELF_STATE,	1010B	;置手动月检标志位
1733	0x02f3	0xe2ff	   1733: 	JMP	SELF_CHK_STATE_END
1734			   
1735			   1735: ;--------------------------------------------------------------------------------------
1736			   
1737			   1737: SCS_LESS_7S:
1738	0x02f4	0x7a66	   1738: 	LDI	GREEN_FLASH,	0100B	;让绿灯以3HZ的频率开始闪烁
1739			   1739: 	
1740	0x02f5	0x40f8	   1740: 	ADI	BTN_PRE_STA,	01H
1741	0x02f6	0xa2ff	   1741: 	BA0	SELF_CHK_STATE_END	;如果当前按键为按下状态，则跳转
1742			   1742: 	
1743	0x02f7	0x7e32	   1743: 	LDI	SELF_STATE,	1100B	;置手动年检标志位
1744	0x02f8	0xe2ff	   1744: 	JMP	SELF_CHK_STATE_END
1745			   
1746			   1746: ;--------------------------------------------------------------------------------------	
1747			   
1748			   1748: SET_MONTH_BIT:
1749	0x02f9	0x76b6	   1749: 	ANDIM	F_TIME,		1101B	;清1月到标志位
1750	0x02fa	0x7932	   1750: 	LDI	SELF_STATE,	0010B	;置自动月检标志位
1751	0x02fb	0xe2ff	   1751: 	JMP	SELF_CHK_STATE_END
1752			   
1753			   1753: ;--------------------------------------------------------------------------------------	
1754			   
1755			   1755: SET_YEAR_BIT:
1756	0x02fc	0x75b6	   1756: 	ANDIM	F_TIME,		1011B	;清1年到标志位
1757	0x02fd	0x7a32	   1757: 	LDI	SELF_STATE,	0100B	;置自动年检标志位
1758	0x02fe	0xe2ff	   1758: 	JMP	SELF_CHK_STATE_END
1759			   
1760			   1760: ;--------------------------------------------------------------------------------------	
1761			   
1762			   1762: SELF_CHK_STATE_END:
1763	0x02ff	0xd400	   1763: 	RTNI
1764			   
1765			   
1766			   1766: ;***********************************************************
1767			   1767: ;根据自检标志位，进行自检
1768			   1768: ;输入
1769			   1769: ;-- SELF_STATE		当前系统自检状态
1770			   1770: ;--
1771			   1771: ;输出
1772			   1772: ;-- DURATION_EMER		应急持续时长，位图形式表示
1773			   1773: ;-- ALARM_STATE.0		应急时长不足故障标志位
1774			   1774: ;-- CNT0/1/2_EMERGENCY	应急持续时长，单位秒
1775			   1775: ;-- ALREADY_ENTER.2/3	在月检或年检状态下，已经使能应急功能
1776			   1776: ;***********************************************************
1777			   1777: SELF_CHK_PROCESS:
1778			   
1779	0x0300	0x3831	   1779: 	LDA	SYSTEM_STATE
1780	0x0301	0xa365	   1780: 	BA0	SELF_CHK_PROCESS_END	;如果停电，则跳转
1781			   
1782	0x0302	0x3832	   1782: 	LDA	SELF_STATE		;检查自检状态标志
1783	0x0303	0xa309	   1783: 	BA0	SCP_EMERGENCY		;如果模拟停电标志位为1，则跳转
1784			   
1785	0x0304	0x3832	   1785: 	LDA	SELF_STATE
1786	0x0305	0xab0d	   1786: 	BA1	SCP_MONTH		;如果手动月检标志为1，则跳转
1787			   
1788			   1788: 	;ADI	ALREADY_ENTER,	0100B	
1789			   1789: 	;BA2	SCP_CHK_YEAR_BIT	;如果上一次不是月检，则跳转
1790			   1790: 	;JMP	SCP_ARRIVE_120S		;如果上一次月检标志为1，本次为0，则退出月检	
1791			   
1792			   1792: ;SCP_CHK_YEAR_BIT:
1793	0x0306	0x3832	   1793: 	LDA	SELF_STATE
1794	0x0307	0xb32e	   1794: 	BA2	SCP_YEAR		;如果手动年检标志为1，则跳转
1795			   
1796			   1796: 	;ADI	ALREADY_ENTER,	1000B	
1797			   1797: 	;BA3	SCP_CLEAR_ALL		;如果上一次不是年检，则跳转
1798			   1798: 	;JMP	SCP_ARRIVE_30MIN	;如果上一次年检标志为1，本次为0，则退出年检
1799			   
1800			   1800: SCP_CLEAR_ALL:
1801	0x0308	0xe30b	   1801: 	JMP	SCP_DIS_EMERGENCY	;如果自检标志均为0，则关闭应急
1802			   1802: 	
1803			   1803: ;---------------------------------------------------------------------------
1804			   
1805			   1805: SCP_EMERGENCY:
1806	0x0309	0x68a0	   1806: 	ORIM	PWMC0,		0001B	;使能PWM0输出
1807	0x030a	0xe365	   1807: 	JMP	SELF_CHK_PROCESS_END
1808			   
1809			   1809: ;---------------------------------------------------------------------------
1810			   
1811			   1811: SCP_DIS_EMERGENCY:
1812	0x030b	0x7720	   1812: 	ANDIM	PWMC0,		1110B	;关闭PWM0输出
1813	0x030c	0xe365	   1813: 	JMP	SELF_CHK_PROCESS_END
1814			   
1815			   1815: ;---------------------------------------------------------------------------
1816			   
1817			   1817: SCP_MONTH:
1818	0x030d	0x3833	   1818: 	LDA	ALREADY_ENTER
1819	0x030e	0xb315	   1819: 	BA2	SCP_MONTH_1S		;如果已经打开应急，则跳转
1820			   
1821	0x030f	0x6a33	   1821: 	ORIM	ALREADY_ENTER,	0100B	;置已经进入手动月检标志位
1822	0x0310	0x784f	   1822: 	LDI	CNT0_EMERGENCY,	00H	;应急时长清零
1823	0x0311	0x7850	   1823: 	LDI	CNT1_EMERGENCY,	00H
1824	0x0312	0x7851	   1824: 	LDI	CNT2_EMERGENCY,	00H
1825	0x0313	0x68a0	   1825: 	ORIM	PWMC0,		0001B	;使能PWM0输出
1826	0x0314	0xe365	   1826: 	JMP	SELF_CHK_PROCESS_END
1827			   1827: 	
1828			   1828: ;---------------------------------------------------------------------------
1829			   
1830			   1830: SCP_MONTH_1S:
1831	0x0315	0x40b5	   1831: 	ADI	F_1S,		0001B
1832	0x0316	0xa365	   1832: 	BA0	SELF_CHK_PROCESS_END	;还未到1秒，则跳转
1833			   
1834	0x0317	0x7735	   1834: 	ANDIM	F_1S,		1110B	;清供应急计时用的1秒标志位
1835			   
1836	0x0318	0x544f	   1836: 	SBI	CNT0_EMERGENCY,	08H	;和120秒比较(0x78)
1837	0x0319	0x7b8e	   1837: 	LDI	TBR,		07H
1838	0x031a	0x1050	   1838: 	SBC	CNT1_EMERGENCY
1839			   
1840	0x031b	0x9b27	   1840: 	BC	SCP_ARRIVE_120S		;如果应急时长超过120秒，则跳转
1841			   
1842	0x031c	0x48cf	   1842: 	ADIM	CNT0_EMERGENCY,	01H	;应急时长加1
1843	0x031d	0x780e	   1843: 	LDI	TBR,		00H
1844	0x031e	0x0450	   1844: 	ADCM	CNT1_EMERGENCY
1845			   
1846	0x031f	0x6941	   1846: 	ORIM	FLAG_OCCUPIED,	0010B	;锁定通道1最终结果
1847			   
1848	0x0320	0x389d	   1848: 	LDA	CHN1_FINAL_RET1,01H
1849	0x0321	0x1852	   1849: 	SUB	CMP_EXIT_EMER0
1850	0x0322	0x389e	   1850: 	LDA	CHN1_FINAL_RET2,01H
1851	0x0323	0x1053	   1851: 	SBC	CMP_EXIT_EMER1
1852			   
1853	0x0324	0x76c1	   1853: 	ANDIM	FLAG_OCCUPIED,	1101B	;释放对通道1最终结果的锁定
1854			   
1855	0x0325	0x8b65	   1855: 	BNC	SELF_CHK_PROCESS_END	;如果电池还未耗尽，则跳转
1856			   
1857	0x0326	0x6a5c	   1857: 	ORIM	ALARM_STATE,	0100B	;置放电时长不足标志位
1858			   1858: 	
1859			   1859: ;---------------------------------------------------------------------------
1860			   
1861			   1861: SCP_ARRIVE_120S:
1862	0x0327	0x7720	   1862: 	ANDIM	PWMC0,		1110B	;关闭PWM0输出
1863	0x0328	0x7832	   1863: 	LDI	SELF_STATE,	0000B	;清月检标志位
1864	0x0329	0x76e6	   1864: 	ANDIM	GREEN_FLASH,	1101B	;让绿灯停止以1HZ的频率闪烁	
1865	0x032a	0x75b3	   1865: 	ANDIM	ALREADY_ENTER,	1011B	;清在手动月检状态下已经开始应急的标志位
1866			   
1867	0x032b	0x68ce	   1867: 	ORIM	DURATION_EMER,	0001B	;应急时长为2分钟，置应急时长小于5分钟标志位
1868	0x032c	0xc1db	   1868: 	CALL	RE_CALC_TIME		;根据应急时长，重新计算待充电时长
1869	0x032d	0xe365	   1869: 	JMP	SELF_CHK_PROCESS_END
1870			   1870: 	
1871			   1871: ;---------------------------------------------------------------------------
1872			   
1873			   1873: SCP_YEAR:
1874	0x032e	0x3833	   1874: 	LDA	ALREADY_ENTER
1875	0x032f	0xbb36	   1875: 	BA3	SCP_YEAR_1S		;如果已经打开应急，则跳转
1876			   
1877	0x0330	0x6c33	   1877: 	ORIM	ALREADY_ENTER,	1000B	;置已经进入应急标志位
1878	0x0331	0x784f	   1878: 	LDI	CNT0_EMERGENCY,	00H	;应急时长清零
1879	0x0332	0x7850	   1879: 	LDI	CNT1_EMERGENCY,	00H
1880	0x0333	0x7851	   1880: 	LDI	CNT2_EMERGENCY,	00H
1881	0x0334	0x68a0	   1881: 	ORIM	PWMC0,		0001B	;使能PWM0输出
1882	0x0335	0xe365	   1882: 	JMP	SELF_CHK_PROCESS_END
1883			   
1884			   1884: SCP_YEAR_1S:
1885	0x0336	0x40b5	   1885: 	ADI	F_1S,		0001B
1886	0x0337	0xa365	   1886: 	BA0	SELF_CHK_PROCESS_END	;还未到1秒，则跳转
1887			   
1888	0x0338	0x7735	   1888: 	ANDIM	F_1S,		1110B	;清供应急计时用的1秒标志位
1889			   
1890	0x0339	0x48cf	   1890: 	ADIM	CNT0_EMERGENCY,	01H	;应急时长加1
1891	0x033a	0x780e	   1891: 	LDI	TBR,		00H
1892	0x033b	0x0450	   1892: 	ADCM	CNT1_EMERGENCY
1893	0x033c	0x780e	   1893: 	LDI	TBR,		00H
1894	0x033d	0x0451	   1894: 	ADCM	CNT2_EMERGENCY
1895			   1895: 	
1896	0x033e	0x6941	   1896: 	ORIM	FLAG_OCCUPIED,	0010B	;锁定通道1最终结果
1897			   
1898	0x033f	0x389d	   1898: 	LDA	CHN1_FINAL_RET1,01H
1899	0x0340	0x1852	   1899: 	SUB	CMP_EXIT_EMER0
1900	0x0341	0x389e	   1900: 	LDA	CHN1_FINAL_RET2,01H
1901	0x0342	0x1053	   1901: 	SBC	CMP_EXIT_EMER1
1902			   
1903	0x0343	0x76c1	   1903: 	ANDIM	FLAG_OCCUPIED,	1101B	;释放对通道1最终结果的锁定
1904			   
1905	0x0344	0x8b65	   1905: 	BNC	SELF_CHK_PROCESS_END	;如果电池还未耗尽，则跳转
1906			   
1907	0x0345	0x544f	   1907: 	SBI	CNT0_EMERGENCY,	08H	;和30分钟比较(0x708)
1908	0x0346	0x780e	   1908: 	LDI	TBR,		00H
1909	0x0347	0x1050	   1909: 	SBC	CNT1_EMERGENCY
1910	0x0348	0x7b8e	   1910: 	LDI	TBR,		07H
1911	0x0349	0x1051	   1911: 	SBC	CNT2_EMERGENCY	
1912			   
1913	0x034a	0x9b4c	   1913: 	BC	SCP_ARRIVE_30MIN
1914			   
1915	0x034b	0x6a5c	   1915: 	ORIM	ALARM_STATE,	0100B	;置应急放电时长不足标志位
1916			   1916: 	
1917			   1917: ;---------------------------------------------------------------------------
1918			   
1919			   1919: SCP_ARRIVE_30MIN:
1920	0x034c	0x7720	   1920: 	ANDIM	PWMC0,		1110B	;关闭PWM0输出
1921	0x034d	0x7832	   1921: 	LDI	SELF_STATE,	0000B	;清年检标志位
1922	0x034e	0x75e6	   1922: 	ANDIM	GREEN_FLASH,	1011B	;让绿灯停止以3HZ的频率闪烁
1923	0x034f	0x73b3	   1923: 	01H
1924			   
1925	0x0350	0x564f	   1925: 	SBI	CNT0_EMERGENCY,	0CH	;和5分钟比较(0x12C)
1926	0x0351	0x790e	   1926: 	LDI	TBR,		02H
1927	0x0352	0x1050	   1927: 	SBC	CNT1_EMERGENCY
1928	0x0353	0x788e	   1928: 	LDI	TBR,		01H
1929	0x0354	0x1051	   1929: 	SBC	CNT2_EMERGENCY
1930			   
1931	0x0355	0x8b5f	   1931: 	BNC	YEAR_LESS_5_MINUTE	;应急时长小于5分钟
1932			   
1933	0x0356	0x544f	   1933: 	SBI	CNT0_EMERGENCY,	08H	;和30分钟比较(0x708)
1934	0x0357	0x780e	   1934: 	LDI	TBR,		00H
1935	0x0358	0x1050	   1935: 	SBC	CNT1_EMERGENCY
1936	0x0359	0x7b8e	   1936: 	LDI	TBR,		07H
1937	0x035a	0x1051	   1937: 	SBC	CNT2_EMERGENCY
1938			   
1939	0x035b	0x8b62	   1939: 	BNC	YEAR_LESS_30_MINUTE	;应急时长小于30分钟
1940			   
1941			   1941: YEAR_MORE_30_MINUTE:			;应急时长大于30分钟
1942	0x035c	0x6a4e	   1942: 	ORIM	DURATION_EMER,	0100B
1943	0x035d	0xc1db	   1943: 	CALL	RE_CALC_TIME		;发生了应急放电事件，重新计算待充电时长
1944	0x035e	0xe365	   1944: 	JMP	SELF_CHK_PROCESS_END
1945			   
1946			   1946: YEAR_LESS_5_MINUTE:
1947	0x035f	0x68ce	   1947: 	ORIM	DURATION_EMER,	0001B
1948	0x0360	0xc1db	   1948: 	CALL	RE_CALC_TIME		;发生了应急放电事件，重新计算待充电时长
1949	0x0361	0xe365	   1949: 	JMP	SELF_CHK_PROCESS_END
1950			   1950: 	
1951			   1951: YEAR_LESS_30_MINUTE:
1952	0x0362	0x694e	   1952: 	ORIM	DURATION_EMER,	0010B
1953	0x0363	0xc1db	   1953: 	CALL	RE_CALC_TIME		;发生了应急放电事件，重新计算待充电时长
1954	0x0364	0xe365	   1954: 	JMP	SELF_CHK_PROCESS_END
1955			   1955: 	
1956			   1956: ;---------------------------------------------------------------------------
1957			   1957: 	
1958			   1958: SELF_CHK_PROCESS_END:
1959	0x0365	0xd400	   1959: 	RTNI
1960			   
1961			   
1962			   
1963			   1963: ;************************************************************
1964			   1964: ; 延时5 毫秒子程序
1965			   1965: ;************************************************************
1966			   1966: DELAY_5MS:
1967	0x0366	0x79f1	   1967: 	LDI 	DELAY_TIMER2,	03H 	;设置初始值
1968	0x0367	0x79f2	   1968: 	LDI 	DELAY_TIMER1,	03H
1969	0x0368	0x7e73	   1969: 	LDI 	DELAY_TIMER0,	0CH
1970			   
1971			   1971: DELAY_5MS_LOOP:
1972	0x0369	0x58f3	   1972: 	SBIM 	DELAY_TIMER0,	01H 	;每次减1
1973	0x036a	0x7874	   1973: 	LDI 	CLEAR_AC,	00H
1974	0x036b	0x1472	   1974: 	SBCM 	DELAY_TIMER1,	00H
1975	0x036c	0x7874	   1975: 	LDI 	CLEAR_AC,	00H
1976	0x036d	0x1471	   1976: 	SBCM 	DELAY_TIMER2,	00H
1977	0x036e	0x9b69	   1977: 	BC 	DELAY_5MS_LOOP
1978			   1978: 	
1979	0x036f	0xd400	   1979: 	RTNI
1980			   
1981			   
1982			   1982: ;*******************************************
1983			   1983: ; 子程序: CAL_CHN0_ADCDATA
1984			   1984: ; 描述: 防脉冲平均滤波法（N=4，去一个最大值和一个最小值，剩下两个求平均值）
1985			   1985: ;*******************************************
1986			   1986: CAL_CHN0_ADCDATA:
1987	0x0370	0x40c1	   1987: 	ADI	FLAG_OCCUPIED,		0001B
1988	0x0371	0xa373	   1988: 	BA0	CAL_CHN0_AD_MIN01
1989	0x0372	0xe403	   1989: 	JMP	CAL_CHN0_ADCDATA_END		;正在使用转换结果
1990			   
1991			   1991: ;----------------------------
1992			   1992: ;寻找最小值
1993			   1993: CAL_CHN0_AD_MIN01:	
1994	0x0373	0x3881	   1994: 	LDA 	CHN0_RET1_BAK0,		01H
1995	0x0374	0x1884	   1995: 	SUB 	CHN0_RET1_BAK1,		01H
1996	0x0375	0x3882	   1996: 	LDA 	CHN0_RET2_BAK0,		01H
1997	0x0376	0x1085	   1997: 	SBC 	CHN0_RET2_BAK1,		01H
1998	0x0377	0x9b89	   1998: 	BC 	CAL_CHN0_AD_MIN02 		;D0<D1	
1999			   
2000			   2000: CAL_CHN0_AD_MIN12:
2001	0x0378	0x3884	   2001: 	LDA 	CHN0_RET1_BAK1,		01H
2002	0x0379	0x1887	   2002: 	SUB 	CHN0_RET1_BAK2,		01H
2003	0x037a	0x3885	   2003: 	LDA 	CHN0_RET2_BAK1,		01H
2004	0x037b	0x1088	   2004: 	SBC 	CHN0_RET2_BAK2,		01H
2005	0x037c	0x9b83	   2005: 	BC 	CAL_CHN0_AD_MIN13 		;D1<D2
2006			   
2007			   2007: CAL_CHN0_AD_MIN23:
2008	0x037d	0x3887	   2008: 	LDA 	CHN0_RET1_BAK2,		01H
2009	0x037e	0x188a	   2009: 	SUB 	CHN0_RET1_BAK3,		01H
2010	0x037f	0x3888	   2010: 	LDA 	CHN0_RET2_BAK2,		01H
2011	0x0380	0x108b	   2011: 	SBC 	CHN0_RET2_BAK3,		01H
2012	0x0381	0x9b9f	   2012: 	BC 	CAL_CHN0_AD_MIN2 		;D2<D3
2013			   2013: 	;D3<D2
2014	0x0382	0xe3a4	   2014: 	JMP 	CAL_CHN0_AD_MIN3
2015			   
2016			   2016: CAL_CHN0_AD_MIN13:
2017	0x0383	0x3884	   2017: 	LDA 	CHN0_RET1_BAK1,		01H
2018	0x0384	0x188a	   2018: 	SUB 	CHN0_RET1_BAK3,		01H
2019	0x0385	0x3885	   2019: 	LDA 	CHN0_RET2_BAK1,		01H
2020	0x0386	0x108b	   2020: 	SBC 	CHN0_RET2_BAK3,		01H
2021	0x0387	0x9b9a	   2021: 	BC 	CAL_CHN0_AD_MIN1 		;D1<D3
2022			   2022: 	;D3<D1
2023	0x0388	0xe3a4	   2023: 	JMP 	CAL_CHN0_AD_MIN3
2024			   
2025			   2025: ;D0<D1
2026			   2026: CAL_CHN0_AD_MIN02:
2027	0x0389	0x3881	   2027: 	LDA 	CHN0_RET1_BAK0,		01H
2028	0x038a	0x1887	   2028: 	SUB 	CHN0_RET1_BAK2,		01H
2029	0x038b	0x3882	   2029: 	LDA 	CHN0_RET2_BAK0,		01H
2030	0x038c	0x1088	   2030: 	SBC 	CHN0_RET2_BAK2,		01H
2031	0x038d	0x9b8f	   2031: 	BC 	CAL_CHN0_AD_MIN03 		;D0<D2
2032			   2032: 	;D3<D1
2033	0x038e	0xe37d	   2033: 	JMP 	CAL_CHN0_AD_MIN23
2034			   
2035			   2035: ;D0<D2
2036			   2036: CAL_CHN0_AD_MIN03:
2037	0x038f	0x3881	   2037: 	LDA 	CHN0_RET1_BAK0,		01H
2038	0x0390	0x188a	   2038: 	SUB 	CHN0_RET1_BAK3,		01H
2039	0x0391	0x3882	   2039: 	LDA 	CHN0_RET2_BAK0,		01H
2040	0x0392	0x108b	   2040: 	SBC 	CHN0_RET2_BAK3,		01H
2041	0x0393	0x9b95	   2041: 	BC 	CAL_CHN0_AD_MIN0 		;D0<D3
2042			   2042: 	;D3<D0
2043	0x0394	0xe3a4	   2043: 	JMP 	CAL_CHN0_AD_MIN3
2044			   
2045			   2045: ;-----------------------
2046			   2046: ;将最小值清零
2047			   2047: CAL_CHN0_AD_MIN0:
2048	0x0395	0x780e	   2048: 	LDI 	TBR,			00H
2049	0x0396	0x3c80	   2049: 	STA 	CHN0_RET0_BAK0,		01H
2050	0x0397	0x3c81	   2050: 	STA 	CHN0_RET1_BAK0,		01H
2051	0x0398	0x3c82	   2051: 	STA 	CHN0_RET2_BAK0,		01H
2052	0x0399	0xe3a9	   2052: 	JMP 	CAL_CHN0_AD_MAX01
2053			   
2054			   2054: CAL_CHN0_AD_MIN1:
2055	0x039a	0x780e	   2055: 	LDI 	TBR,			00H
2056	0x039b	0x3c83	   2056: 	STA 	CHN0_RET0_BAK1,		01H
2057	0x039c	0x3c84	   2057: 	STA 	CHN0_RET1_BAK1,		01H
2058	0x039d	0x3c85	   2058: 	STA 	CHN0_RET2_BAK1,		01H
2059	0x039e	0xe3a9	   2059: 	JMP 	CAL_CHN0_AD_MAX01
2060			   
2061			   2061: CAL_CHN0_AD_MIN2:
2062	0x039f	0x780e	   2062: 	LDI 	TBR,			00H
2063	0x03a0	0x3c86	   2063: 	STA 	CHN0_RET0_BAK2,		01H
2064	0x03a1	0x3c87	   2064: 	STA 	CHN0_RET1_BAK2,		01H
2065	0x03a2	0x3c88	   2065: 	STA 	CHN0_RET2_BAK2,		01H
2066	0x03a3	0xe3a9	   2066: 	JMP 	CAL_CHN0_AD_MAX01
2067			   
2068			   2068: CAL_CHN0_AD_MIN3:
2069	0x03a4	0x780e	   2069: 	LDI 	TBR,			00H
2070	0x03a5	0x3c89	   2070: 	STA 	CHN0_RET0_BAK3,		01H
2071	0x03a6	0x3c8a	   2071: 	STA 	CHN0_RET1_BAK3,		01H
2072	0x03a7	0x3c8b	   2072: 	STA 	CHN0_RET2_BAK3,		01H
2073	0x03a8	0xe3a9	   2073: 	JMP 	CAL_CHN0_AD_MAX01
2074			   
2075			   2075: ;----------------------------
2076			   2076: ;寻找最大值
2077			   2077: CAL_CHN0_AD_MAX01:
2078	0x03a9	0x3881	   2078: 	LDA 	CHN0_RET1_BAK0,		01H
2079	0x03aa	0x1884	   2079: 	SUB 	CHN0_RET1_BAK1,		01H
2080	0x03ab	0x3882	   2080: 	LDA 	CHN0_RET2_BAK0,		01H
2081	0x03ac	0x1085	   2081: 	SBC 	CHN0_RET2_BAK1,		01H
2082	0x03ad	0x9bbf	   2082: 	BC 	CAL_CHN0_AD_MAX12 		;D1>D0
2083			   
2084			   2084: ;D0>D1
2085			   2085: CAL_CHN0_AD_MAX02:
2086	0x03ae	0x3881	   2086: 	LDA 	CHN0_RET1_BAK0,		01H
2087	0x03af	0x1887	   2087: 	SUB 	CHN0_RET1_BAK2,		01H
2088	0x03b0	0x3882	   2088: 	LDA 	CHN0_RET2_BAK0,		01H
2089	0x03b1	0x1088	   2089: 	SBC 	CHN0_RET2_BAK2,		01H
2090	0x03b2	0x9bb9	   2090: 	BC 	CAL_CHN0_AD_MAX23 		;D2>D0
2091			   
2092			   2092: ;D0>D2
2093			   2093: CAL_CHN0_AD_MAX03:
2094	0x03b3	0x3881	   2094: 	LDA 	CHN0_RET1_BAK0,		01H
2095	0x03b4	0x188a	   2095: 	SUB 	CHN0_RET1_BAK3,		01H
2096	0x03b5	0x3882	   2096: 	LDA 	CHN0_RET2_BAK0,		01H
2097	0x03b6	0x108b	   2097: 	SBC 	CHN0_RET2_BAK3,		01H
2098	0x03b7	0x9bd9	   2098: 	BC 	CAL_CHN0_AD_MAX3 		;D3>D0
2099			   2099: 	;D0>D3
2100	0x03b8	0xe3ca	   2100: 	JMP 	CAL_CHN0_AD_MAX0
2101			   
2102			   2102: ;D2>D0
2103			   2103: CAL_CHN0_AD_MAX23:
2104	0x03b9	0x3887	   2104: 	LDA 	CHN0_RET1_BAK2,		01H
2105	0x03ba	0x188a	   2105: 	SUB 	CHN0_RET1_BAK3,		01H
2106	0x03bb	0x3888	   2106: 	LDA 	CHN0_RET2_BAK2,		01H
2107	0x03bc	0x108b	   2107: 	SBC 	CHN0_RET2_BAK3,		01H
2108	0x03bd	0x9bd9	   2108: 	BC 	CAL_CHN0_AD_MAX3 		;D3>D2
2109			   2109: 	;D2>D3
2110	0x03be	0xe3d4	   2110: 	JMP 	CAL_CHN0_AD_MAX2
2111			   
2112			   2112: ;D1>D0
2113			   2113: CAL_CHN0_AD_MAX12:
2114	0x03bf	0x3884	   2114: 	LDA 	CHN0_RET1_BAK1,		01H
2115	0x03c0	0x1887	   2115: 	SUB 	CHN0_RET1_BAK2,		01H
2116	0x03c1	0x3885	   2116: 	LDA 	CHN0_RET2_BAK1,		01H
2117	0x03c2	0x1088	   2117: 	SBC 	CHN0_RET2_BAK2,		01H
2118	0x03c3	0x9bb9	   2118: 	BC 	CAL_CHN0_AD_MAX23 		;D2>D1
2119			   
2120			   2120: ;D1>D2
2121			   2121: CAL_CHN0_AD_MAX13:
2122	0x03c4	0x3884	   2122: 	LDA 	CHN0_RET1_BAK1,		01H
2123	0x03c5	0x188a	   2123: 	SUB 	CHN0_RET1_BAK3,		01H
2124	0x03c6	0x3885	   2124: 	LDA 	CHN0_RET2_BAK1,		01H
2125	0x03c7	0x108b	   2125: 	SBC 	CHN0_RET2_BAK3,		01H
2126	0x03c8	0x9bd9	   2126: 	BC 	CAL_CHN0_AD_MAX3 		;D3>D1
2127			   2127: 	;D1>D3
2128	0x03c9	0xe3cf	   2128: 	JMP 	CAL_CHN0_AD_MAX1
2129			   
2130			   2130: ;-----------------------
2131			   2131: ;将最大值清零
2132			   2132: CAL_CHN0_AD_MAX0:
2133	0x03ca	0x780e	   2133: 	LDI 	TBR,			00H
2134	0x03cb	0x3c80	   2134: 	STA 	CHN0_RET0_BAK0,		01H
2135	0x03cc	0x3c81	   2135: 	STA 	CHN0_RET1_BAK0,		01H
2136	0x03cd	0x3c82	   2136: 	STA 	CHN0_RET2_BAK0,		01H
2137	0x03ce	0xe3de	   2137: 	JMP 	CAL_CHN0_AD_ADD
2138			   
2139			   2139: CAL_CHN0_AD_MAX1:
2140	0x03cf	0x780e	   2140: 	LDI 	TBR,			00H
2141	0x03d0	0x3c83	   2141: 	STA 	CHN0_RET0_BAK1,		01H
2142	0x03d1	0x3c84	   2142: 	STA 	CHN0_RET1_BAK1,		01H
2143	0x03d2	0x3c85	   2143: 	STA 	CHN0_RET2_BAK1,		01H
2144	0x03d3	0xe3de	   2144: 	JMP 	CAL_CHN0_AD_ADD
2145			   
2146			   2146: CAL_CHN0_AD_MAX2:
2147	0x03d4	0x780e	   2147: 	LDI 	TBR,			00H
2148	0x03d5	0x3c86	   2148: 	STA 	CHN0_RET0_BAK2,		01H
2149	0x03d6	0x3c87	   2149: 	STA 	CHN0_RET1_BAK2,		01H
2150	0x03d7	0x3c88	   2150: 	STA 	CHN0_RET2_BAK2,		01H
2151	0x03d8	0xe3de	   2151: 	JMP 	CAL_CHN0_AD_ADD
2152			   
2153			   2153: CAL_CHN0_AD_MAX3:
2154	0x03d9	0x780e	   2154: 	LDI 	TBR,			00H
2155	0x03da	0x3c89	   2155: 	STA 	CHN0_RET0_BAK3,		01H
2156	0x03db	0x3c8a	   2156: 	STA 	CHN0_RET1_BAK3,		01H
2157	0x03dc	0x3c8b	   2157: 	STA 	CHN0_RET2_BAK3,		01H
2158	0x03dd	0xe3de	   2158: 	JMP 	CAL_CHN0_AD_ADD
2159			   
2160			   2160: ;----------------------------
2161			   2161: ;计算总和并存放在CHN0_RET0_BAK3,CHN0_RET1_BAK3 和CHN0_RET2_BAK3（包括两个被清零的）
2162			   2162: CAL_CHN0_AD_ADD:
2163	0x03de	0x7840	   2163: 	LDI 	TEMP_SUM_CY,		00H
2164			   
2165			   2165: 	;D0 + D1
2166			   2166: 	;LDA 	CHN0_RET0_BAK0,		01H
2167			   2167: 	;ADDM 	CHN0_RET0_BAK1,		01H
2168	0x03df	0x3881	   2168: 	LDA 	CHN0_RET1_BAK0,		01H
2169	0x03e0	0x0c84	   2169: 	ADDM 	CHN0_RET1_BAK1,		01H
2170	0x03e1	0x3882	   2170: 	LDA 	CHN0_RET2_BAK0,		01H
2171	0x03e2	0x0485	   2171: 	ADCM 	CHN0_RET2_BAK1,		01H
2172	0x03e3	0x780e	   2172: 	LDI 	TBR,			00H
2173	0x03e4	0x0440	   2173: 	ADCM 	TEMP_SUM_CY
2174			   
2175			   2175: 	;+ D2
2176			   2176: 	;LDA 	CHN0_RET0_BAK1,		01H
2177			   2177: 	;ADDM 	CHN0_RET0_BAK2,		01H
2178	0x03e5	0x3884	   2178: 	LDA 	CHN0_RET1_BAK1,		01H
2179	0x03e6	0x0c87	   2179: 	ADDM 	CHN0_RET1_BAK2,		01H
2180	0x03e7	0x3885	   2180: 	LDA 	CHN0_RET2_BAK1,		01H
2181	0x03e8	0x0488	   2181: 	ADCM 	CHN0_RET2_BAK2,		01H
2182	0x03e9	0x780e	   2182: 	LDI 	TBR,			00H
2183	0x03ea	0x0440	   2183: 	ADCM 	TEMP_SUM_CY
2184			   
2185			   2185: 	;+ D3
2186			   2186: 	;LDA 	CHN0_RET0_BAK2,		01H
2187			   2187: 	;ADDM 	CHN0_RET0_BAK3,		01H
2188	0x03eb	0x3887	   2188: 	LDA 	CHN0_RET1_BAK2,		01H
2189	0x03ec	0x0c8a	   2189: 	ADDM 	CHN0_RET1_BAK3,		01H
2190	0x03ed	0x3888	   2190: 	LDA 	CHN0_RET2_BAK2,		01H
2191	0x03ee	0x048b	   2191: 	ADCM 	CHN0_RET2_BAK3,		01H
2192	0x03ef	0x780e	   2192: 	LDI 	TBR,			00H
2193	0x03f0	0x0440	   2193: 	ADCM 	TEMP_SUM_CY
2194			   
2195			   2195: ;----------------------------
2196			   2196: ;总和除以2，得到平均值，存放在CHN0_FINAL_RET0(),CHN0_FINAL_RET1 和CHN0_FINAL_RET2
2197			   2197: CAL_CHN0_AD_DIV:
2198			   2198: 	;LDA 	CHN0_RET0_BAK3,		01H
2199			   2199: 	;SHR
2200			   2200: 	;STA 	CHN0_RET0_BAK3,		01H
2201			   2201: 	
2202	0x03f1	0x388a	   2202: 	LDA 	CHN0_RET1_BAK3,		01H
2203	0x03f2	0xf000	   2203: 	SHR
2204	0x03f3	0x3c8a	   2204: 	STA 	CHN0_RET1_BAK3,		01H
2205			   2205: 	
2206			   2206: 	;BNC 	$+3
2207			   2207: 	;LDI 	TBR,			0010B
2208			   2208: 	;ORM 	CHN0_RET0_BAK3
2209			   
2210	0x03f4	0x388b	   2210: 	LDA 	CHN0_RET2_BAK3,		01H
2211	0x03f5	0xf000	   2211: 	SHR
2212	0x03f6	0x3c8b	   2212: 	STA 	CHN0_RET2_BAK3,		01H
2213			   2213: 	
2214	0x03f7	0x8bfa	   2214: 	BNC 	$+3
2215	0x03f8	0x7c0e	   2215: 	LDI 	TBR,			1000B
2216	0x03f9	0x2c8a	   2216: 	ORM 	CHN0_RET1_BAK3,		01H
2217			   
2218	0x03fa	0x3840	   2218: 	LDA 	TEMP_SUM_CY
2219	0x03fb	0xf000	   2219: 	SHR
2220	0x03fc	0x8bff	   2220: 	BNC 	$+3
2221	0x03fd	0x7c0e	   2221: 	LDI 	TBR,			1000B
2222	0x03fe	0x2c8b	   2222: 	ORM 	CHN0_RET2_BAK3,		01H
2223			   
2224			   
2225			   2225: 	;LDA	CHN0_RET0_BAK3,		01H
2226			   2226: 	;STA	CHN0_FINAL_RET0,		01H
2227	0x03ff	0x388a	   2227: 	LDA	CHN0_RET1_BAK3,		01H
2228	0x0400	0x3c8d	   2228: 	STA	CHN0_FINAL_RET1,	01H
2229	0x0401	0x388b	   2229: 	LDA	CHN0_RET2_BAK3,		01H
2230	0x0402	0x3c8e	   2230: 	STA	CHN0_FINAL_RET2,	01H
2231			   
2232			   2232: ;----------------------------
2233			   2233: ;调整为CHN0_FINAL_RET0存放低4位，CHN0_FINAL_RET1存放中4位，CHN0_FINAL_RET2存放高2位
2234			   2234: 	;LDA 	CHN0_FINAL_RET1,		01H
2235			   2235: 	;SHR
2236			   2236: 	;STA 	CHN0_FINAL_RET1,		01H
2237			   
2238			   2238: 	;BNC 	$+3
2239			   2239: 	;LDI 	TBR,			0100B
2240			   2240: 	;ORM 	CHN0_FINAL_RET0,		01H
2241			   
2242			   2242: 	;LDA 	CHN0_FINAL_RET1,		01H
2243			   2243: 	;SHR
2244			   2244: 	;STA 	CHN0_FINAL_RET1,		01H	
2245			   
2246			   2246: 	;BNC 	$+3
2247			   2247: 	;LDI 	TBR,			1000B
2248			   2248: 	;ORM 	CHN0_FINAL_RET0,		01H
2249			   
2250			   
2251			   2251: 	;LDA 	CHN0_FINAL_RET2,		01H
2252			   2252: 	;SHR
2253			   2253: 	;STA 	CHN0_FINAL_RET2,		01H	
2254			   
2255			   2255: 	;BNC 	$+3
2256			   2256: 	;LDI 	TBR,			0100B
2257			   2257: 	;ORM 	CHN0_FINAL_RET1,		01H
2258			   
2259			   2259: 	;LDA 	CHN0_FINAL_RET2,		01H
2260			   2260: 	;SHR
2261			   2261: 	;STA 	CHN0_FINAL_RET2,		01H	
2262			   
2263			   2263: 	;BNC 	$+3
2264			   2264: 	;LDI 	TBR,			1000B
2265			   2265: 	;ORM 	CHN0_FINAL_RET1,		01H
2266			   2266: 	
2267			   2267: ;----------------------------
2268			   2268: CAL_CHN0_ADCDATA_END:	
2269			   
2270	0x0403	0xd400	   2270: 	RTNI
2271			   
2272			   2272: ;*******************************************
2273			   2273: ; 子程序: CAL_CHN1_ADCDATA
2274			   2274: ; 描述: 防脉冲平均滤波法（N=4，去一个最大值和一个最小值，剩下两个求平均值）
2275			   2275: ;*******************************************
2276			   2276: CAL_CHN1_ADCDATA:
2277	0x0404	0x4141	   2277: 	ADI	FLAG_OCCUPIED,		0010B
2278	0x0405	0xac07	   2278: 	BA1	CAL_CHN1_AD_MIN01
2279	0x0406	0xe497	   2279: 	JMP	CAL_CHN1_ADCDATA_END		;正在使用转换结果
2280			   
2281			   2281: ;----------------------------
2282			   2282: ;寻找最小值
2283			   2283: CAL_CHN1_AD_MIN01:	
2284	0x0407	0x3891	   2284: 	LDA 	CHN1_RET1_BAK0,		01H
2285	0x0408	0x1894	   2285: 	SUB 	CHN1_RET1_BAK1,		01H
2286	0x0409	0x3892	   2286: 	LDA 	CHN1_RET2_BAK0,		01H
2287	0x040a	0x1095	   2287: 	SBC 	CHN1_RET2_BAK1,		01H
2288	0x040b	0x9c1d	   2288: 	BC 	CAL_CHN1_AD_MIN02 		;D0<D1	
2289			   
2290			   2290: CAL_CHN1_AD_MIN12:
2291	0x040c	0x3894	   2291: 	LDA 	CHN1_RET1_BAK1,		01H
2292	0x040d	0x1897	   2292: 	SUB 	CHN1_RET1_BAK2,		01H
2293	0x040e	0x3895	   2293: 	LDA 	CHN1_RET2_BAK1,		01H
2294	0x040f	0x1098	   2294: 	SBC 	CHN1_RET2_BAK2,		01H
2295	0x0410	0x9c17	   2295: 	BC 	CAL_CHN1_AD_MIN13 		;D1<D2
2296			   
2297			   2297: CAL_CHN1_AD_MIN23:
2298	0x0411	0x3897	   2298: 	LDA 	CHN1_RET1_BAK2,		01H
2299	0x0412	0x189a	   2299: 	SUB 	CHN1_RET1_BAK3,		01H
2300	0x0413	0x3898	   2300: 	LDA 	CHN1_RET2_BAK2,		01H
2301	0x0414	0x109b	   2301: 	SBC 	CHN1_RET2_BAK3,		01H
2302	0x0415	0x9c33	   2302: 	BC 	CAL_CHN1_AD_MIN2 		;D2<D3
2303			   2303: 	;D3<D2
2304	0x0416	0xe438	   2304: 	JMP 	CAL_CHN1_AD_MIN3
2305			   
2306			   2306: CAL_CHN1_AD_MIN13:
2307	0x0417	0x3894	   2307: 	LDA 	CHN1_RET1_BAK1,		01H
2308	0x0418	0x189a	   2308: 	SUB 	CHN1_RET1_BAK3,		01H
2309	0x0419	0x3895	   2309: 	LDA 	CHN1_RET2_BAK1,		01H
2310	0x041a	0x109b	   2310: D_MAX0:
2311	0x041b	0x9c2e	   2311: 	BC 	CAL_CHN1_AD_MIN1 		;D1<D3
2312			   2312: 	;D3<D1
2313	0x041c	0xe438	   2313: 	JMP 	CAL_CHN1_AD_MIN3
2314			   
2315			   2315: ;D0<D1
2316			   2316: CAL_CHN1_AD_MIN02:
2317	0x041d	0x3891	   2317: 	LDA 	CHN1_RET1_BAK0,		01H
2318	0x041e	0x1897	   2318: 	SUB 	CHN1_RET1_BAK2,		01H
2319	0x041f	0x3892	   2319: 	LDA 	CHN1_RET2_BAK0,		01H
2320	0x0420	0x1098	   2320: 	SBC 	CHN1_RET2_BAK2,		01H
2321	0x0421	0x9c23	   2321: 	BC 	CAL_CHN1_AD_MIN03 		;D0<D2
2322			   2322: 	;D3<D1
2323	0x0422	0xe411	   2323: 	JMP 	CAL_CHN1_AD_MIN23
2324			   
2325			   2325: ;D0<D2
2326			   2326: CAL_CHN1_AD_MIN03:
2327	0x0423	0x3891	   2327: 	LDA 	CHN1_RET1_BAK0,		01H
2328	0x0424	0x189a	   2328: 	SUB 	CHN1_RET1_BAK3,		01H
2329	0x0425	0x3892	   2329: 	LDA 	CHN1_RET2_BAK0,		01H
2330	0x0426	0x109b	   2330: 	SBC 	CHN1_RET2_BAK3,		01H
2331	0x0427	0x9c29	   2331: 	BC 	CAL_CHN1_AD_MIN0 		;D0<D3
2332			   2332: 	;D3<D0
2333	0x0428	0xe438	   2333: 	JMP 	CAL_CHN1_AD_MIN3
2334			   
2335			   2335: ;-----------------------
2336			   2336: ;将最小值清零
2337			   2337: CAL_CHN1_AD_MIN0:
2338	0x0429	0x780e	   2338: 	LDI 	TBR,			00H
2339	0x042a	0x3c90	   2339: 	STA 	CHN1_RET0_BAK0,		01H
2340	0x042b	0x3c91	   2340: 	STA 	CHN1_RET1_BAK0,		01H
2341	0x042c	0x3c92	   2341: 	STA 	CHN1_RET2_BAK0,		01H
2342	0x042d	0xe43d	   2342: 	JMP 	CAL_CHN1_AD_MAX01
2343			   
2344			   2344: CAL_CHN1_AD_MIN1:
2345	0x042e	0x780e	   2345: 	LDI 	TBR,			00H
2346	0x042f	0x3c93	   2346: 	STA 	CHN1_RET0_BAK1,		01H
2347	0x0430	0x3c94	   2347: 	STA 	CHN1_RET1_BAK1,		01H
2348	0x0431	0x3c95	   2348: 	STA 	CHN1_RET2_BAK1,		01H
2349	0x0432	0xe43d	   2349: 	JMP 	CAL_CHN1_AD_MAX01
2350			   
2351			   2351: CAL_CHN1_AD_MIN2:
2352	0x0433	0x780e	   2352: 	LDI 	TBR,			00H
2353	0x0434	0x3c96	   2353: 	STA 	CHN1_RET0_BAK2,		01H
2354	0x0435	0x3c97	   2354: 	STA 	CHN1_RET1_BAK2,		01H
2355	0x0436	0x3c98	   2355: 	STA 	CHN1_RET2_BAK2,		01H
2356	0x0437	0xe43d	   2356: 	JMP 	CAL_CHN1_AD_MAX01
2357			   
2358			   2358: CAL_CHN1_AD_MIN3:
2359	0x0438	0x780e	   2359: 	LDI 	TBR,			00H
2360	0x0439	0x3c99	   2360: 	STA 	CHN1_RET0_BAK3,		01H
2361	0x043a	0x3c9a	   2361: 	STA 	CHN1_RET1_BAK3,		01H
2362	0x043b	0x3c9b	   2362: 	STA 	CHN1_RET2_BAK3,		01H
2363	0x043c	0xe43d	   2363: 	JMP 	CAL_CHN1_AD_MAX01
2364			   
2365			   2365: ;----------------------------
2366			   2366: ;寻找最大值
2367			   2367: CAL_CHN1_AD_MAX01:
2368	0x043d	0x3891	   2368: 	LDA 	CHN1_RET1_BAK0,		01H
2369	0x043e	0x1894	   2369: 	SUB 	CHN1_RET1_BAK1,		01H
2370	0x043f	0x3892	   2370: 	LDA 	CHN1_RET2_BAK0,		01H
2371	0x0440	0x1095	   2371: 	SBC 	CHN1_RET2_BAK1,		01H
2372	0x0441	0x9c53	   2372: 	BC 	CAL_CHN1_AD_MAX12 		;D1>D0
2373			   
2374			   2374: ;D0>D1
2375			   2375: CAL_CHN1_AD_MAX02:
2376	0x0442	0x3891	   2376: 	LDA 	CHN1_RET1_BAK0,		01H
2377	0x0443	0x1897	   2377: 	SUB 	CHN1_RET1_BAK2,		01H
2378	0x0444	0x3892	   2378: 	LDA 	CHN1_RET2_BAK0,		01H
2379	0x0445	0x1098	   2379: 	SBC 	CHN1_RET2_BAK2,		01H
2380	0x0446	0x9c4d	   2380: 	BC 	CAL_CHN1_AD_MAX23 		;D2>D0
2381			   
2382			   2382: ;D0>D2
2383			   2383: CAL_CHN1_AD_MAX03:
2384	0x0447	0x3891	   2384: 	LDA 	CHN1_RET1_BAK0,		01H
2385	0x0448	0x189a	   2385: 	SUB 	CHN1_RET1_BAK3,		01H
2386	0x0449	0x3892	   2386: 	LDA 	CHN1_RET2_BAK0,		01H
2387	0x044a	0x109b	   2387: 	SBC 	CHN1_RET2_BAK3,		01H
2388	0x044b	0x9c6d	   2388: 	BC 	CAL_CHN1_AD_MAX3 		;D3>D0
2389			   2389: 	;D0>D3
2390	0x044c	0xe45e	   2390: 	JMP 	CAL_CHN1_AD_MAX0
2391			   
2392			   2392: ;D2>D0
2393			   2393: CAL_CHN1_AD_MAX23:
2394	0x044d	0x3897	   2394: 	LDA 	CHN1_RET1_BAK2,		01H
2395	0x044e	0x189a	   2395: 	SUB 	CHN1_RET1_BAK3,		01H
2396	0x044f	0x3898	   2396: 	LDA 	CHN1_RET2_BAK2,		01H
2397	0x0450	0x109b	   2397: 	SBC 	CHN1_RET2_BAK3,		01H
2398	0x0451	0x9c6d	   2398: 	BC 	CAL_CHN1_AD_MAX3 		;D3>D2
2399			   2399: 	;D2>D3
2400	0x0452	0xe468	   2400: 	JMP 	CAL_CHN1_AD_MAX2
2401			   
2402			   2402: ;D1>D0
2403			   2403: CAL_CHN1_AD_MAX12:
2404	0x0453	0x3894	   2404: 	LDA 	CHN1_RET1_BAK1,		01H
2405	0x0454	0x1897	   2405: 	SUB 	CHN1_RET1_BAK2,		01H
2406	0x0455	0x3895	   2406: 	LDA 	CHN1_RET2_BAK1,		01H
2407	0x0456	0x1098	   2407: 	SBC 	CHN1_RET2_BAK2,		01H
2408	0x0457	0x9c4d	   2408: 	BC 	CAL_CHN1_AD_MAX23 		;D2>D1
2409			   
2410			   2410: ;D1>D2
2411			   2411: CAL_CHN1_AD_MAX13:
2412	0x0458	0x3894	   2412: 	LDA 	CHN1_RET1_BAK1,		01H
2413	0x0459	0x189a	   2413: 	SUB 	CHN1_RET1_BAK3,		01H
2414	0x045a	0x3895	   2414: 	LDA 	CHN1_RET2_BAK1,		01H
2415	0x045b	0x109b	   2415: 	SBC 	CHN1_RET2_BAK3,		01H
2416	0x045c	0x9c6d	   2416: 	BC 	CAL_CHN1_AD_MAX3 		;D3>D1
2417			   2417: 	;D1>D3
2418	0x045d	0xe463	   2418: 	JMP 	CAL_CHN1_AD_MAX1
2419			   
2420			   2420: ;-----------------------
2421			   2421: ;将最大值清零
2422			   2422: CAL_CHN1_AD_MAX0:
2423	0x045e	0x780e	   2423: 	LDI 	TBR,			00H
2424	0x045f	0x3c90	   2424: 	STA 	CHN1_RET0_BAK0,		01H
2425	0x0460	0x3c91	   2425: 	STA 	CHN1_RET1_BAK0,		01H
2426	0x0461	0x3c92	   2426: 	STA 	CHN1_RET2_BAK0,		01H
2427	0x0462	0xe472	   2427: 	JMP 	CAL_CHN1_AD_ADD
2428			   
2429			   2429: CAL_CHN1_AD_MAX1:
2430	0x0463	0x780e	   2430: 	LDI 	TBR,			00H
2431	0x0464	0x3c93	   2431: 	STA 	CHN1_RET0_BAK1,		01H
2432	0x0465	0x3c94	   2432: 	STA 	CHN1_RET1_BAK1,		01H
2433	0x0466	0x3c95	   2433: 	STA 	CHN1_RET2_BAK1,		01H
2434	0x0467	0xe472	   2434: 	JMP 	CAL_CHN1_AD_ADD
2435			   
2436			   2436: CAL_CHN1_AD_MAX2:
2437	0x0468	0x780e	   2437: 	LDI 	TBR,			00H
2438	0x0469	0x3c96	   2438: 	STA 	CHN1_RET0_BAK2,		01H
2439	0x046a	0x3c97	   2439: 	STA 	CHN1_RET1_BAK2,		01H
2440	0x046b	0x3c98	   2440: 	STA 	CHN1_RET2_BAK2,		01H
2441	0x046c	0xe472	   2441: 	JMP 	CAL_CHN1_AD_ADD
2442			   
2443			   2443: CAL_CHN1_AD_MAX3:
2444	0x046d	0x780e	   2444: 	LDI 	TBR,			00H
2445	0x046e	0x3c99	   2445: 	STA 	CHN1_RET0_BAK3,		01H
2446	0x046f	0x3c9a	   2446: 	STA 	CHN1_RET1_BAK3,		01H
2447	0x0470	0x3c9b	   2447: 	STA 	CHN1_RET2_BAK3,		01H
2448	0x0471	0xe472	   2448: 	JMP 	CAL_CHN1_AD_ADD
2449			   
2450			   2450: ;----------------------------
2451			   2451: ;计算总和并存放在CHN1_RET0_BAK3,CHN1_RET1_BAK3 和CHN1_RET2_BAK3（包括两个被清零的）
2452			   2452: CAL_CHN1_AD_ADD:
2453	0x0472	0x7840	   2453: 	LDI 	TEMP_SUM_CY,		00H
2454			   
2455			   2455: 	;D0 + D1
2456			   2456: 	;LDA 	CHN1_RET0_BAK0,		01H
2457			   2457: 	;ADDM 	CHN1_RET0_BAK1,		01H
2458	0x0473	0x3891	   2458: 	LDA 	CHN1_RET1_BAK0,		01H
2459	0x0474	0x0c94	   2459: 	ADDM 	CHN1_RET1_BAK1,		01H
2460	0x0475	0x3892	   2460: 	LDA 	CHN1_RET2_BAK0,		01H
2461	0x0476	0x0495	   2461: 	ADCM 	CHN1_RET2_BAK1,		01H
2462	0x0477	0x780e	   2462: 	LDI 	TBR,			00H
2463	0x0478	0x0440	   2463: 	ADCM 	TEMP_SUM_CY
2464			   
2465			   2465: 	;+ D2
2466			   2466: 	;LDA 	CHN1_RET0_BAK1,		01H
2467			   2467: 	;ADDM 	CHN1_RET0_BAK2,		01H
2468	0x0479	0x3894	   2468: 	LDA 	CHN1_RET1_BAK1,		01H
2469	0x047a	0x0c97	   2469: 	ADDM 	CHN1_RET1_BAK2,		01H
2470	0x047b	0x3895	   2470: 	LDA 	CHN1_RET2_BAK1,		01H
2471	0x047c	0x0498	   2471: 	ADCM 	CHN1_RET2_BAK2,		01H
2472	0x047d	0x780e	   2472: 	LDI 	TBR,			00H
2473	0x047e	0x0440	   2473: 	ADCM 	TEMP_SUM_CY
2474			   
2475			   2475: 	;+ D3
2476			   2476: 	;LDA 	CHN1_RET0_BAK2,		01H
2477			   2477: 	;ADDM 	CHN1_RET0_BAK3,		01H
2478	0x047f	0x3897	   2478: 	LDA 	CHN1_RET1_BAK2,		01H
2479	0x0480	0x0c9a	   2479: 	ADDM 	CHN1_RET1_BAK3,		01H
2480	0x0481	0x3898	   2480: 	LDA 	CHN1_RET2_BAK2,		01H
2481	0x0482	0x049b	   2481: 	ADCM 	CHN1_RET2_BAK3,		01H
2482	0x0483	0x780e	   2482: 	LDI 	TBR,			00H
2483	0x0484	0x0440	   2483: 	ADCM 	TEMP_SUM_CY
2484			   
2485			   2485: ;----------------------------
2486			   2486: ;总和除以2，得到平均值，存放在CHN1_FINAL_RET0(),CHN1_FINAL_RET1 和CHN1_FINAL_RET2
2487			   2487: CAL_CHN1_AD_DIV:
2488			   2488: 	;LDA 	CHN1_RET0_BAK3,		01H
2489			   2489: 	;SHR
2490			   2490: 	;STA 	CHN1_RET0_BAK3,		01H
2491			   2491: 	
2492	0x0485	0x389a	   2492: 	LDA 	CHN1_RET1_BAK3,		01H
2493	0x0486	0xf000	   2493: 	SHR
2494	0x0487	0x3c9a	   2494: 	STA 	CHN1_RET1_BAK3,		01H
2495			   2495: 	
2496			   2496: 	;BNC 	$+3
2497			   2497: 	;LDI 	TBR,			0010B
2498			   2498: 	;ORM 	CHN1_RET0_BAK3
2499			   
2500	0x0488	0x389b	   2500: 	LDA 	CHN1_RET2_BAK3,		01H
2501	0x0489	0xf000	   2501: 	SHR
2502	0x048a	0x3c9b	   2502: 	STA 	CHN1_RET2_BAK3,		01H
2503			   2503: 	
2504	0x048b	0x8c8e	   2504: 	BNC 	$+3
2505	0x048c	0x7c0e	   2505: 	LDI 	TBR,			1000B
2506	0x048d	0x2c9a	   2506: 	ORM 	CHN1_RET1_BAK3,		01H
2507			   
2508	0x048e	0x3840	   2508: 	LDA 	TEMP_SUM_CY
2509	0x048f	0xf000	   2509: 	SHR
2510	0x0490	0x8c93	   2510: 	BNC 	$+3
2511	0x0491	0x7c0e	   2511: 	LDI 	TBR,			1000B
2512	0x0492	0x2c9b	   2512: 	ORM 	CHN1_RET2_BAK3,		01H
2513			   
2514			   
2515			   2515: 	;LDA	CHN1_RET0_BAK3,		01H
2516			   2516: 	;STA	CHN1_FINAL_RET0,		01H
2517	0x0493	0x389a	   2517: 	LDA	CHN1_RET1_BAK3,		01H
2518	0x0494	0x3c9d	   2518: 	STA	CHN1_FINAL_RET1,	01H
2519	0x0495	0x389b	   2519: 	LDA	CHN1_RET2_BAK3,		01H
2520	0x0496	0x3c9e	   2520: 	STA	CHN1_FINAL_RET2,	01H
2521			   
2522			   2522: ;----------------------------
2523			   2523: ;调整为CHN1_FINAL_RET0存放低4位，CHN1_FINAL_RET1存放中4位，CHN1_FINAL_RET2存放高2位
2524			   2524: 	;LDA 	CHN1_FINAL_RET1,		01H
2525			   2525: 	;SHR
2526			   2526: 	;STA 	CHN1_FINAL_RET1,		01H
2527			   
2528			   2528: 	;BNC 	$+3
2529			   2529: 	;LDI 	TBR,			0100B
2530			   2530: 	;ORM 	CHN1_FINAL_RET0,		01H
2531			   
2532			   2532: 	;LDA 	CHN1_FINAL_RET1,		01H
2533			   2533: 	;SHR
2534			   2534: 	;STA 	CHN1_FINAL_RET1,		01H	
2535			   
2536			   2536: 	;BNC 	$+3
2537			   2537: 	;LDI 	TBR,			1000B
2538			   2538: 	;ORM 	CHN1_FINAL_RET0,		01H
2539			   
2540			   
2541			   2541: 	;LDA 	CHN1_FINAL_RET2,		01H
2542			   2542: 	;SHR
2543			   2543: 	;STA 	CHN1_FINAL_RET2,		01H	
2544			   
2545			   2545: 	;BNC 	$+3
2546			   2546: 	;LDI 	TBR,			0100B
2547			   2547: 	;ORM 	CHN1_FINAL_RET1,		01H
2548			   
2549			   2549: 	;LDA 	CHN1_FINAL_RET2,		01H
2550			   2550: 	;SHR
2551			   2551: 	;STA 	CHN1_FINAL_RET2,		01H	
2552			   
2553			   2553: 	;BNC 	$+3
2554			   2554: 	;LDI 	TBR,			1000B
2555			   2555: 	;ORM 	CHN1_FINAL_RET1,		01H
2556			   2556: 	
2557			   2557: ;----------------------------
2558			   2558: CAL_CHN1_ADCDATA_END:	
2559			   
2560	0x0497	0xd400	   2560: 	RTNI
2561			   
2562			   
2563			   2563: ;*******************************************
2564			   2564: ; 子程序: CAL_CHN6_ADCDATA
2565			   2565: ; 描述: 防脉冲平均滤波法（N=4，去一个最大值和一个最小值，剩下两个求平均值）
2566			   2566: ;*******************************************
2567			   2567: CAL_CHN6_ADCDATA:
2568	0x0498	0x4241	   2568: 	ADI	FLAG_OCCUPIED,		0100B
2569	0x0499	0xb49b	   2569: 	BA2	CAL_CHN6_AD_MIN01
2570	0x049a	0xe52b	   2570: 	JMP	CAL_CHN6_ADCDATA_END		;正在使用转换结果
2571			   2571: 	
2572			   2572: ;----------------------------
2573			   2573: ;寻找最小值
2574			   2574: CAL_CHN6_AD_MIN01:	
2575	0x049b	0x38a1	   2575: 	LDA 	CHN6_RET1_BAK0,		01H
2576	0x049c	0x18a4	   2576: 	SUB 	CHN6_RET1_BAK1,		01H
2577	0x049d	0x38a2	   2577: 	LDA 	CHN6_RET2_BAK0,		01H
2578	0x049e	0x10a5	   2578: 	SBC 	CHN6_RET2_BAK1,		01H
2579	0x049f	0x9cb1	   2579: 	BC 	CAL_CHN6_AD_MIN02 		;D0<D1	
2580			   
2581			   2581: CAL_CHN6_AD_MIN12:
2582	0x04a0	0x38a4	   2582: 	LDA 	CHN6_RET1_BAK1,		01H
2583	0x04a1	0x18a7	   2583: 	SUB 	CHN6_RET1_BAK2,		01H
2584	0x04a2	0x38a5	   2584: 	LDA 	CHN6_RET2_BAK1,		01H
2585	0x04a3	0x10a8	   2585: 	SBC 	CHN6_RET2_BAK2,		01H
2586	0x04a4	0x9cab	   2586: 	BC 	CAL_CHN6_AD_MIN13 		;D1<D2
2587			   
2588			   2588: CAL_CHN6_AD_MIN23:
2589	0x04a5	0x38a7	   2589: 	LDA 	CHN6_RET1_BAK2,		01H
2590	0x04a6	0x18aa	   2590: 	SUB 	CHN6_RET1_BAK3,		01H
2591	0x04a7	0x38a8	   2591: 	LDA 	CHN6_RET2_BAK2,		01H
2592	0x04a8	0x10ab	   2592: 	SBC 	CHN6_RET2_BAK3,		01H
2593	0x04a9	0x9cc7	   2593: 	BC 	CAL_CHN6_AD_MIN2 		;D2<D3
2594			   2594: 	;D3<D2
2595	0x04aa	0xe4cc	   2595: 	JMP 	CAL_CHN6_AD_MIN3
2596			   
2597			   2597: CAL_CHN6_AD_MIN13:
2598	0x04ab	0x38a4	   2598: 	LDA 	CHN6_RET1_BAK1,		01H
2599	0x04ac	0x18aa	   2599: 	SUB 	CHN6_RET1_BAK3,		01H
2600	0x04ad	0x38a5	   2600: 	LDA 	CHN6_RET2_BAK1,		01H
2601	0x04ae	0x10ab	   2601: 	SBC 	CHN6_RET2_BAK3,		01H
2602	0x04af	0x9cc2	   2602: 	BC 	CAL_CHN6_AD_MIN1 		;D1<D3
2603			   2603: 	;D3<D1
2604	0x04b0	0xe4cc	   2604: 	JMP 	CAL_CHN6_AD_MIN3
2605			   
2606			   2606: ;D0<D1
2607			   2607: CAL_CHN6_AD_MIN02:
2608	0x04b1	0x38a1	   2608: 	LDA 	CHN6_RET1_BAK0,		01H
2609	0x04b2	0x18a7	   2609: 	SUB 	CHN6_RET1_BAK2,		01H
2610	0x04b3	0x38a2	   2610: 	LDA 	CHN6_RET2_BAK0,		01H
2611	0x04b4	0x10a8	   2611: 	SBC 	CHN6_RET2_BAK2,		01H
2612	0x04b5	0x9cb7	   2612: 	BC 	CAL_CHN6_AD_MIN03 		;D0<D2
2613			   2613: 	;D3<D1
2614	0x04b6	0xe4a5	   2614: 	JMP 	CAL_CHN6_AD_MIN23
2615			   
2616			   2616: ;D0<D2
2617			   2617: CAL_CHN6_AD_MIN03:
2618	0x04b7	0x38a1	   2618: 	LDA 	CHN6_RET1_BAK0,		01H
2619	0x04b8	0x18aa	   2619: 	SUB 	CHN6_RET1_BAK3,		01H
2620	0x04b9	0x38a2	   2620: 	LDA 	CHN6_RET2_BAK0,		01H
2621	0x04ba	0x10ab	   2621: 	SBC 	CHN6_RET2_BAK3,		01H
2622	0x04bb	0x9cbd	   2622: 	BC 	CAL_CHN6_AD_MIN0 		;D0<D3
2623			   2623: 	;D3<D0
2624	0x04bc	0xe4cc	   2624: 	JMP 	CAL_CHN6_AD_MIN3
2625			   
2626			   2626: ;-----------------------
2627			   2627: ;将最小值清零
2628			   2628: CAL_CHN6_AD_MIN0:
2629	0x04bd	0x780e	   2629: 	LDI 	TBR,			00H
2630	0x04be	0x3ca0	   2630: 	STA 	CHN6_RET0_BAK0,		01H
2631	0x04bf	0x3ca1	   2631: 	STA 	CHN6_RET1_BAK0,		01H
2632	0x04c0	0x3ca2	   2632: 	STA 	CHN6_RET2_BAK0,		01H
2633	0x04c1	0xe4d1	   2633: 	JMP 	CAL_CHN6_AD_MAX01
2634			   
2635			   2635: CAL_CHN6_AD_MIN1:
2636	0x04c2	0x780e	   2636: 	LDI 	TBR,			00H
2637	0x04c3	0x3ca3	   2637: 	STA 	CHN6_RET0_BAK1,		01H
2638	0x04c4	0x3ca4	   2638: 	STA 	CHN6_RET1_BAK1,		01H
2639	0x04c5	0x3ca5	   2639: 	STA 	CHN6_RET2_BAK1,		01H
2640	0x04c6	0xe4d1	   2640: 	JMP 	CAL_CHN6_AD_MAX01
2641			   
2642			   2642: CAL_CHN6_AD_MIN2:
2643	0x04c7	0x780e	   2643: 	LDI 	TBR,			00H
2644	0x04c8	0x3ca6	   2644: 	STA 	CHN6_RET0_BAK2,		01H
2645	0x04c9	0x3ca7	   2645: 	STA 	CHN6_RET1_BAK2,		01H
2646	0x04ca	0x3ca8	   2646: 	STA 	CHN6_RET2_BAK2,		01H
2647	0x04cb	0xe4d1	   2647: 	JMP 	CAL_CHN6_AD_MAX01
2648			   
2649			   2649: CAL_CHN6_AD_MIN3:
2650	0x04cc	0x780e	   2650: 	LDI 	TBR,			00H
2651	0x04cd	0x3ca9	   2651: 	STA 	CHN6_RET0_BAK3,		01H
2652	0x04ce	0x3caa	   2652: 	STA 	CHN6_RET1_BAK3,		01H
2653	0x04cf	0x3cab	   2653: 	STA 	CHN6_RET2_BAK3,		01H
2654	0x04d0	0xe4d1	   2654: 	JMP 	CAL_CHN6_AD_MAX01
2655			   
2656			   2656: ;----------------------------
2657			   2657: ;寻找最大值
2658			   2658: CAL_CHN6_AD_MAX01:
2659	0x04d1	0x38a1	   2659: 	LDA 	CHN6_RET1_BAK0,		01H
2660	0x04d2	0x18a4	   2660: 	SUB 	CHN6_RET1_BAK1,		01H
2661	0x04d3	0x38a2	   2661: 	LDA 	CHN6_RET2_BAK0,		01H
2662	0x04d4	0x10a5	   2662: 	SBC 	CHN6_RET2_BAK1,		01H
2663	0x04d5	0x9ce7	   2663: 	BC 	CAL_CHN6_AD_MAX12 		;D1>D0
2664			   
2665			   2665: ;D0>D1
2666			   2666: CAL_CHN6_AD_MAX02:
2667	0x04d6	0x38a1	   2667: 	LDA 	CHN6_RET1_BAK0,		01H
2668	0x04d7	0x18a7	   2668: 	SUB 	CHN6_RET1_BAK2,		01H
2669	0x04d8	0x38a2	   2669: 	LDA 	CHN6_RET2_BAK0,		01H
2670	0x04d9	0x10a8	   2670: 	SBC 	CHN6_RET2_BAK2,		01H
2671	0x04da	0x9ce1	   2671: 	BC 	CAL_CHN6_AD_MAX23 		;D2>D0
2672			   
2673			   2673: ;D0>D2
2674			   2674: CAL_CHN6_AD_MAX03:
2675	0x04db	0x38a1	   2675: 	LDA 	CHN6_RET1_BAK0,		01H
2676	0x04dc	0x18aa	   2676: 	SUB 	CHN6_RET1_BAK3,		01H
2677	0x04dd	0x38a2	   2677: 	LDA 	CHN6_RET2_BAK0,		01H
2678	0x04de	0x10ab	   2678: 	SBC 	CHN6_RET2_BAK3,		01H
2679	0x04df	0x9d01	   2679: 	BC 	CAL_CHN6_AD_MAX3 		;D3>D0
2680			   2680: 	;D0>D3
2681	0x04e0	0xe4f2	   2681: 	JMP 	CAL_CHN6_AD_MAX0
2682			   
2683			   2683: ;D2>D0
2684			   2684: CAL_CHN6_AD_MAX23:
2685	0x04e1	0x38a7	   2685: 	LDA 	CHN6_RET1_BAK2,		01H
2686	0x04e2	0x18aa	   2686: 	SUB 	CHN6_RET1_BAK3,		01H
2687	0x04e3	0x38a8	   2687: 	LDA 	CHN6_RET2_BAK2,		01H
2688	0x04e4	0x10ab	   2688: 	SBC 	CHN6_RET2_BAK3,		01H
2689	0x04e5	0x9d01	   2689: 	BC 	CAL_CHN6_AD_MAX3 		;D3>D2
2690			   2690: 	;D2>D3
2691	0x04e6	0xe4fc	   2691: 	JMP 	CAL_CHN6_AD_MAX2
2692			   
2693			   2693: ;D1>D0
2694			   2694: CAL_CHN6_AD_MAX12:
2695	0x04e7	0x38a4	   2695: 	LDA 	CHN6_RET1_BAK1,		01H
2696	0x04e8	0x18a7	   2696: 	SUB 	CHN6_RET1_BAK2,		01H
2697	0x04e9	0x38a5	   2697: 	LDA 	CHN6_RET2_BAK1,		01H
2698	0x04ea	0x10a8	   2698: 	SBC 	CHN6_RET2_BAK2,		01H
2699	0x04eb	0x9ce1	   2699: 	BC 	CAL_CHN6_AD_MAX23 		;D2>D1
2700			   
2701			   2701: ;D1>D2
2702			   2702: CAL_CHN6_AD_MAX13:
2703	0x04ec	0x38a4	   2703: 	LDA 	CHN6_RET1_BAK1,		01H
2704	0x04ed	0x18aa	   2704: 	SUB 	CHN6_RET1_BAK3,		01H
2705	0x04ee	0x38a5	   2705: 	LDA 	CHN6_RET2_BAK1,		01H
2706	0x04ef	0x10ab	   2706: 	SBC 	CHN6_RET2_BAK3,		01H
2707	0x04f0	0x9d01	   2707: 	BC 	CAL_CHN6_AD_MAX3 		;D3>D1
2708			   2708: 	;D1>D3
2709	0x04f1	0xe4f7	   2709: 	JMP 	CAL_CHN6_AD_MAX1
2710			   
2711			   2711: ;-----------------------
2712			   2712: ;将最大值清零
2713			   2713: CAL_CHN6_AD_MAX0:
2714	0x04f2	0x780e	   2714: 	LDI 	TBR,			00H
2715	0x04f3	0x3ca0	   2715: 	STA	
2716	0x04f4	0x3ca1	   2716: 	STA 	CHN6_RET1_BAK0,		01H
2717	0x04f5	0x3ca2	   2717: 	STA 	CHN6_RET2_BAK0,		01H
2718	0x04f6	0xe506	   2718: 	JMP 	CAL_CHN6_AD_ADD
2719			   
2720			   2720: CAL_CHN6_AD_MAX1:
2721	0x04f7	0x780e	   2721: 	LDI 	TBR,			00H
2722	0x04f8	0x3ca3	   2722: 	STA 	CHN6_RET0_BAK1,		01H
2723	0x04f9	0x3ca4	   2723: 	STA 	CHN6_RET1_BAK1,		01H
2724	0x04fa	0x3ca5	   2724: 	STA 	CHN6_RET2_BAK1,		01H
2725	0x04fb	0xe506	   2725: 	JMP 	CAL_CHN6_AD_ADD
2726			   
2727			   2727: CAL_CHN6_AD_MAX2:
2728	0x04fc	0x780e	   2728: 	LDI 	TBR,			00H
2729	0x04fd	0x3ca6	   2729: 	STA 	CHN6_RET0_BAK2,		01H
2730	0x04fe	0x3ca7	   2730: 	STA 	CHN6_RET1_BAK2,		01H
2731	0x04ff	0x3ca8	   2731: 	STA 	CHN6_RET2_BAK2,		01H
2732	0x0500	0xe506	   2732: 	JMP 	CAL_CHN6_AD_ADD
2733			   
2734			   2734: CAL_CHN6_AD_MAX3:
2735	0x0501	0x780e	   2735: 	LDI 	TBR,			00H
2736	0x0502	0x3ca9	   2736: 	STA 	CHN6_RET0_BAK3,		01H
2737	0x0503	0x3caa	   2737: 	STA 	CHN6_RET1_BAK3,		01H
2738	0x0504	0x3cab	   2738: 	STA 	CHN6_RET2_BAK3,		01H
2739	0x0505	0xe506	   2739: 	JMP 	CAL_CHN6_AD_ADD
2740			   
2741			   2741: ;----------------------------
2742			   2742: ;计算总和并存放在CHN6_RET0_BAK3,CHN6_RET1_BAK3 和CHN6_RET2_BAK3（包括两个被清零的）
2743			   2743: CAL_CHN6_AD_ADD:
2744	0x0506	0x7840	   2744: 	LDI 	TEMP_SUM_CY,		00H
2745			   
2746			   2746: 	;D0 + D1
2747			   2747: 	;LDA 	CHN6_RET0_BAK0,		01H
2748			   2748: 	;ADDM 	CHN6_RET0_BAK1,		01H
2749	0x0507	0x38a1	   2749: 	LDA 	CHN6_RET1_BAK0,		01H
2750	0x0508	0x0ca4	   2750: 	ADDM 	CHN6_RET1_BAK1,		01H
2751	0x0509	0x38a2	   2751: 	LDA 	CHN6_RET2_BAK0,		01H
2752	0x050a	0x04a5	   2752: 	ADCM 	CHN6_RET2_BAK1,		01H
2753	0x050b	0x780e	   2753: 	LDI 	TBR,			00H
2754	0x050c	0x0440	   2754: 	ADCM 	TEMP_SUM_CY
2755			   
2756			   2756: 	;+ D2
2757			   2757: 	;LDA 	CHN6_RET0_BAK1,		01H
2758			   2758: 	;ADDM 	CHN6_RET0_BAK2,		01H
2759	0x050d	0x38a4	   2759: 	LDA 	CHN6_RET1_BAK1,		01H
2760	0x050e	0x0ca7	   2760: 	ADDM 	CHN6_RET1_BAK2,		01H
2761	0x050f	0x38a5	   2761: 	LDA 	CHN6_RET2_BAK1,		01H
2762	0x0510	0x04a8	   2762: 	ADCM 	CHN6_RET2_BAK2,		01H
2763	0x0511	0x780e	   2763: 	LDI 	TBR,			00H
2764	0x0512	0x0440	   2764: 	ADCM 	TEMP_SUM_CY
2765			   
2766			   2766: 	;+ D3
2767			   2767: 	;LDA 	CHN6_RET0_BAK2,		01H
2768			   2768: 	;ADDM 	CHN6_RET0_BAK3,		01H
2769	0x0513	0x38a7	   2769: 	LDA 	CHN6_RET1_BAK2,		01H
2770	0x0514	0x0caa	   2770: 	ADDM 	CHN6_RET1_BAK3,		01H
2771	0x0515	0x38a8	   2771: 	LDA 	CHN6_RET2_BAK2,		01H
2772	0x0516	0x04ab	   2772: 	ADCM 	CHN6_RET2_BAK3,		01H
2773	0x0517	0x780e	   2773: 	LDI 	TBR,			00H
2774	0x0518	0x0440	   2774: 	ADCM 	TEMP_SUM_CY
2775			   
2776			   2776: ;----------------------------
2777			   2777: ;总和除以2，得到平均值，存放在CHN6_FINAL_RET0(),CHN6_FINAL_RET1 和CHN6_FINAL_RET2
2778			   2778: CAL_CHN6_AD_DIV:
2779			   2779: 	;LDA 	CHN6_RET0_BAK3,		01H
2780			   2780: 	;SHR
2781			   2781: 	;STA 	CHN6_RET0_BAK3,		01H
2782			   2782: 	
2783	0x0519	0x38aa	   2783: 	LDA 	CHN6_RET1_BAK3,		01H
2784	0x051a	0xf000	   2784: 	SHR
2785	0x051b	0x3caa	   2785: 	STA 	CHN6_RET1_BAK3,		01H
2786			   2786: 	
2787			   2787: 	;BNC 	$+3
2788			   2788: 	;LDI 	TBR,			0010B
2789			   2789: 	;ORM 	CHN6_RET0_BAK3
2790			   
2791	0x051c	0x38ab	   2791: 	LDA 	CHN6_RET2_BAK3,		01H
2792	0x051d	0xf000	   2792: 	SHR
2793	0x051e	0x3cab	   2793: 	STA 	CHN6_RET2_BAK3,		01H
2794			   2794: 	
2795	0x051f	0x8d22	   2795: 	BNC 	$+3
2796	0x0520	0x7c0e	   2796: 	LDI 	TBR,			1000B
2797	0x0521	0x2caa	   2797: 	ORM 	CHN6_RET1_BAK3,		01H
2798			   
2799	0x0522	0x3840	   2799: 	LDA 	TEMP_SUM_CY
2800	0x0523	0xf000	   2800: 	SHR
2801	0x0524	0x8d27	   2801: 	BNC 	$+3
2802	0x0525	0x7c0e	   2802: 	LDI 	TBR,			1000B
2803	0x0526	0x2cab	   2803: 	ORM 	CHN6_RET2_BAK3,		01H
2804			   
2805			   
2806			   2806: 	;LDA	CHN6_RET0_BAK3,		01H
2807			   2807: 	;STA	CHN6_FINAL_RET0,		01H
2808	0x0527	0x38aa	   2808: 	LDA	CHN6_RET1_BAK3,		01H
2809	0x0528	0x3cad	   2809: 	STA	CHN6_FINAL_RET1,	01H
2810	0x0529	0x38ab	   2810: 	LDA	CHN6_RET2_BAK3,		01H
2811	0x052a	0x3cae	   2811: 	STA	CHN6_FINAL_RET2,	01H
2812			   
2813			   2813: ;----------------------------
2814			   2814: ;调整为CHN6_FINAL_RET0存放低4位，CHN6_FINAL_RET1存放中4位，CHN6_FINAL_RET2存放高2位
2815			   2815: 	;LDA 	CHN6_FINAL_RET1,		01H
2816			   2816: 	;SHR
2817			   2817: 	;STA 	CHN6_FINAL_RET1,		01H
2818			   
2819			   2819: 	;BNC 	$+3
2820			   2820: 	;LDI 	TBR,			0100B
2821			   2821: 	;ORM 	CHN6_FINAL_RET0,		01H
2822			   
2823			   2823: 	;LDA 	CHN6_FINAL_RET1,		01H
2824			   2824: 	;SHR
2825			   2825: 	;STA 	CHN6_FINAL_RET1,		01H	
2826			   
2827			   2827: 	;BNC 	$+3
2828			   2828: 	;LDI 	TBR,			1000B
2829			   2829: 	;ORM 	CHN6_FINAL_RET0,		01H
2830			   
2831			   
2832			   2832: 	;LDA 	CHN6_FINAL_RET2,		01H
2833			   2833: 	;SHR
2834			   2834: 	;STA 	CHN6_FINAL_RET2,		01H	
2835			   
2836			   2836: 	;BNC 	$+3
2837			   2837: 	;LDI 	TBR,			0100B
2838			   2838: 	;ORM 	CHN6_FINAL_RET1,		01H
2839			   
2840			   2840: 	;LDA 	CHN6_FINAL_RET2,		01H
2841			   2841: 	;SHR
2842			   2842: 	;STA 	CHN6_FINAL_RET2,		01H	
2843			   
2844			   2844: 	;BNC 	$+3
2845			   2845: 	;LDI 	TBR,			1000B
2846			   2846: 	;ORM 	CHN6_FINAL_RET1,		01H
2847			   2847: 	
2848			   2848: ;----------------------------
2849			   2849: CAL_CHN6_ADCDATA_END:	
2850			   
2851	0x052b	0xd400	   2851: 	RTNI
2852			   
2853			   
2854			   2854: ;*******************************************
2855			   2855: ; 子程序: CAL_CHN7_ADCDATA
2856			   2856: ; 描述: 防脉冲平均滤波法（N=4，去一个最大值和一个最小值，剩下两个求平均值）
2857			   2857: ;*******************************************
2858			   2858: CAL_CHN7_ADCDATA:
2859	0x052c	0x4441	   2859: 	ADI	FLAG_OCCUPIED,		1000B
2860	0x052d	0xbd2f	   2860: 	BA3	CAL_CHN7_AD_MIN01
2861	0x052e	0xe5bf	   2861: 	JMP	CAL_CHN7_ADCDATA_END		;正在使用转换结果
2862			   
2863			   2863: ;----------------------------
2864			   2864: ;寻找最小值
2865			   2865: CAL_CHN7_AD_MIN01:	
2866	0x052f	0x38b1	   2866: 	LDA 	CHN7_RET1_BAK0,		01H
2867	0x0530	0x18b4	   2867: 	SUB 	CHN7_RET1_BAK1,		01H
2868	0x0531	0x38b2	   2868: 	LDA 	CHN7_RET2_BAK0,		01H
2869	0x0532	0x10b5	   2869: 	SBC 	CHN7_RET2_BAK1,		01H
2870	0x0533	0x9d45	   2870: 	BC 	CAL_CHN7_AD_MIN02 		;D0<D1	
2871			   
2872			   2872: CAL_CHN7_AD_MIN12:
2873	0x0534	0x38b4	   2873: 	LDA 	CHN7_RET1_BAK1,		01H
2874	0x0535	0x18b7	   2874: 	SUB 	CHN7_RET1_BAK2,		01H
2875	0x0536	0x38b5	   2875: 	LDA 	CHN7_RET2_BAK1,		01H
2876	0x0537	0x10b8	   2876: 	SBC 	CHN7_RET2_BAK2,		01H
2877	0x0538	0x9d3f	   2877: 	BC 	CAL_CHN7_AD_MIN13 		;D1<D2
2878			   
2879			   2879: CAL_CHN7_AD_MIN23:
2880	0x0539	0x38b7	   2880: 	LDA 	CHN7_RET1_BAK2,		01H
2881	0x053a	0x18ba	   2881: 	SUB 	CHN7_RET1_BAK3,		01H
2882	0x053b	0x38b8	   2882: 	LDA 	CHN7_RET2_BAK2,		01H
2883	0x053c	0x10bb	   2883: 	SBC 	CHN7_RET2_BAK3,		01H
2884	0x053d	0x9d5b	   2884: 	BC 	CAL_CHN7_AD_MIN2 		;D2<D3
2885			   2885: 	;D3<D2
2886	0x053e	0xe560	   2886: 	JMP 	CAL_CHN7_AD_MIN3
2887			   
2888			   2888: CAL_CHN7_AD_MIN13:
2889	0x053f	0x38b4	   2889: 	LDA 	CHN7_RET1_BAK1,		01H
2890	0x0540	0x18ba	   2890: 	SUB 	CHN7_RET1_BAK3,		01H
2891	0x0541	0x38b5	   2891: 	LDA 	CHN7_RET2_BAK1,		01H
2892	0x0542	0x10bb	   2892: 	SBC 	CHN7_RET2_BAK3,		01H
2893	0x0543	0x9d56	   2893: 	BC 	CAL_CHN7_AD_MIN1 		;D1<D3
2894			   2894: 	;D3<D1
2895	0x0544	0xe560	   2895: 	JMP 	CAL_CHN7_AD_MIN3
2896			   
2897			   2897: ;D0<D1
2898			   2898: CAL_CHN7_AD_MIN02:
2899	0x0545	0x38b1	   2899: 	LDA 	CHN7_RET1_BAK0,		01H
2900	0x0546	0x18b7	   2900: 	SUB 	CHN7_RET1_BAK2,		01H
2901	0x0547	0x38b2	   2901: 	LDA 	CHN7_RET2_BAK0,		01H
2902	0x0548	0x10b8	   2902: 	SBC 	CHN7_RET2_BAK2,		01H
2903	0x0549	0x9d4b	   2903: 	BC 	CAL_CHN7_AD_MIN03 		;D0<D2
2904			   2904: 	;D3<D1
2905	0x054a	0xe539	   2905: 	JMP 	CAL_CHN7_AD_MIN23
2906			   
2907			   2907: ;D0<D2
2908			   2908: CAL_CHN7_AD_MIN03:
2909	0x054b	0x38b1	   2909: 	LDA 	CHN7_RET1_BAK0,		01H
2910	0x054c	0x18ba	   2910: 	SUB 	CHN7_RET1_BAK3,		01H
2911	0x054d	0x38b2	   2911: 	LDA 	CHN7_RET2_BAK0,		01H
2912	0x054e	0x10bb	   2912: 	SBC 	CHN7_RET2_BAK3,		01H
2913	0x054f	0x9d51	   2913: 	BC 	CAL_CHN7_AD_MIN0 		;D0<D3
2914			   2914: 	;D3<D0
2915	0x0550	0xe560	   2915: 	JMP 	CAL_CHN7_AD_MIN3
2916			   
2917			   2917: ;-----------------------
2918			   2918: ;将最小值清零
2919			   2919: CAL_CHN7_AD_MIN0:
2920	0x0551	0x780e	   2920: 	LDI 	TBR,			00H
2921	0x0552	0x3cb0	   2921: 	STA 	CHN7_RET0_BAK0,		01H
2922	0x0553	0x3cb1	   2922: 	STA 	CHN7_RET1_BAK0,		01H
2923	0x0554	0x3cb2	   2923: 	STA 	CHN7_RET2_BAK0,		01H
2924	0x0555	0xe565	   2924: 	JMP 	CAL_CHN7_AD_MAX01
2925			   
2926			   2926: CAL_CHN7_AD_MIN1:
2927	0x0556	0x780e	   2927: 	LDI 	TBR,			00H
2928	0x0557	0x3cb3	   2928: 	STA 	CHN7_RET0_BAK1,		01H
2929	0x0558	0x3cb4	   2929: 	STA 	CHN7_RET1_BAK1,		01H
2930	0x0559	0x3cb5	   2930: 	STA 	CHN7_RET2_BAK1,		01H
2931	0x055a	0xe565	   2931: 	JMP 	CAL_CHN7_AD_MAX01
2932			   
2933			   2933: CAL_CHN7_AD_MIN2:
2934	0x055b	0x780e	   2934: 	LDI 	TBR,			00H
2935	0x055c	0x3cb6	   2935: 	STA 	CHN7_RET0_BAK2,		01H
2936	0x055d	0x3cb7	   2936: 	STA 	CHN7_RET1_BAK2,		01H
2937	0x055e	0x3cb8	   2937: 	STA 	CHN7_RET2_BAK2,		01H
2938	0x055f	0xe565	   2938: 	JMP 	CAL_CHN7_AD_MAX01
2939			   
2940			   2940: CAL_CHN7_AD_MIN3:
2941	0x0560	0x780e	   2941: 	LDI 	TBR,			00H
2942	0x0561	0x3cb9	   2942: 	STA 	CHN7_RET0_BAK3,		01H
2943	0x0562	0x3cba	   2943: 	STA 	CHN7_RET1_BAK3,		01H
2944	0x0563	0x3cbb	   2944: 	STA 	CHN7_RET2_BAK3,		01H
2945	0x0564	0xe565	   2945: 	JMP 	CAL_CHN7_AD_MAX01
2946			   
2947			   2947: ;----------------------------
2948			   2948: ;寻找最大值
2949			   2949: CAL_CHN7_AD_MAX01:
2950	0x0565	0x38b1	   2950: 	LDA 	CHN7_RET1_BAK0,		01H
2951	0x0566	0x18b4	   2951: 	SUB 	CHN7_RET1_BAK1,		01H
2952	0x0567	0x38b2	   2952: 	LDA 	CHN7_RET2_BAK0,		01H
2953	0x0568	0x10b5	   2953: 	SBC 	CHN7_RET2_BAK1,		01H
2954	0x0569	0x9d7b	   2954: 	BC 	CAL_CHN7_AD_MAX12 		;D1>D0
2955			   
2956			   2956: ;D0>D1
2957			   2957: CAL_CHN7_AD_MAX02:
2958	0x056a	0x38b1	   2958: 	LDA 	CHN7_RET1_BAK0,		01H
2959	0x056b	0x18b7	   2959: 	SUB 	CHN7_RET1_BAK2,		01H
2960	0x056c	0x38b2	   2960: 	LDA 	CHN7_RET2_BAK0,		01H
2961	0x056d	0x10b8	   2961: 	SBC 	CHN7_RET2_BAK2,		01H
2962	0x056e	0x9d75	   2962: 	BC 	CAL_CHN7_AD_MAX23 		;D2>D0
2963			   
2964			   2964: ;D0>D2
2965			   2965: CAL_CHN7_AD_MAX03:
2966	0x056f	0x38b1	   2966: 	LDA 	CHN7_RET1_BAK0,		01H
2967	0x0570	0x18ba	   2967: 	SUB 	CHN7_RET1_BAK3,		01H
2968	0x0571	0x38b2	   2968: 	LDA 	CHN7_RET2_BAK0,		01H
2969	0x0572	0x10bb	   2969: 	SBC 	CHN7_RET2_BAK3,		01H
2970	0x0573	0x9d95	   2970: 	BC 	CAL_CHN7_AD_MAX3 		;D3>D0
2971			   2971: 	;D0>D3
2972	0x0574	0xe586	   2972: 	JMP 	CAL_CHN7_AD_MAX0
2973			   
2974			   2974: ;D2>D0
2975			   2975: CAL_CHN7_AD_MAX23:
2976	0x0575	0x38b7	   2976: 	LDA 	CHN7_RET1_BAK2,		01H
2977	0x0576	0x18ba	   2977: 	SUB 	CHN7_RET1_BAK3,		01H
2978	0x0577	0x38b8	   2978: 	LDA 	CHN7_RET2_BAK2,		01H
2979	0x0578	0x10bb	   2979: 	SBC 	CHN7_RET2_BAK3,		01H
2980	0x0579	0x9d95	   2980: 	BC 	CAL_CHN7_AD_MAX3 		;D3>D2
2981			   2981: 	;D2>D3
2982	0x057a	0xe590	   2982: 	JMP 	CAL_CHN7_AD_MAX2
2983			   
2984			   2984: ;D1>D0
2985			   2985: CAL_CHN7_AD_MAX12:
2986	0x057b	0x38b4	   2986: 	LDA 	CHN7_RET1_BAK1,		01H
2987	0x057c	0x18b7	   2987: 	SUB 	CHN7_RET1_BAK2,		01H
2988	0x057d	0x38b5	   2988: 	LDA 	CHN7_RET2_BAK1,		01H
2989	0x057e	0x10b8	   2989: 	SBC 	CHN7_RET2_BAK2,		01H
2990	0x057f	0x9d75	   2990: 	BC 	CAL_CHN7_AD_MAX23 		;D2>D1
2991			   
2992			   2992: ;D1>D2
2993			   2993: CAL_CHN7_AD_MAX13:
2994	0x0580	0x38b4	   2994: 	LDA 	CHN7_RET1_BAK1,		01H
2995	0x0581	0x18ba	   2995: 	SUB 	CHN7_RET1_BAK3,		01H
2996	0x0582	0x38b5	   2996: 	LDA 	CHN7_RET2_BAK1,		01H
2997	0x0583	0x10bb	   2997: 	SBC 	CHN7_RET2_BAK3,		01H
2998	0x0584	0x9d95	   2998: 	BC 	CAL_CHN7_AD_MAX3 		;D3>D1
2999			   2999: 	;D1>D3
3000	0x0585	0xe58b	   3000: 	JMP 	CAL_CHN7_AD_MAX1
3001			   
3002			   3002: ;-----------------------
3003			   3003: ;将最大值清零
3004			   3004: CAL_CHN7_AD_MAX0:
3005	0x0586	0x780e	   3005: 	LDI 	TBR,			00H
3006	0x0587	0x3cb0	   3006: 	STA 	CHN7_RET0_BAK0,		01H
3007	0x0588	0x3cb1	   3007: 	STA 	CHN7_RET1_BAK0,		01H
3008	0x0589	0x3cb2	   3008: 	STA 	CHN7_RET2_BAK0,		01H
3009	0x058a	0xe59a	   3009: 	JMP 	CAL_CHN7_AD_ADD
3010			   
3011			   3011: CAL_CHN7_AD_MAX1:
3012	0x058b	0x780e	   3012: 	LDI 	TBR,			00H
3013	0x058c	0x3cb3	   3013: 	STA 	CHN7_RET0_BAK1,		01H
3014	0x058d	0x3cb4	   3014: 	STA 	CHN7_RET1_BAK1,		01H
3015	0x058e	0x3cb5	   3015: 	STA 	CHN7_RET2_BAK1,		01H
3016	0x058f	0xe59a	   3016: 	JMP 	CAL_CHN7_AD_ADD
3017			   
3018			   3018: CAL_CHN7_AD_MAX2:
3019	0x0590	0x780e	   3019: 	LDI 	TBR,			00H
3020	0x0591	0x3cb6	   3020: 	STA 	CHN7_RET0_BAK2,		01H
3021	0x0592	0x3cb7	   3021: 	STA 	CHN7_RET1_BAK2,		01H
3022	0x0593	0x3cb8	   3022: 	STA 	CHN7_RET2_BAK2,		01H
3023	0x0594	0xe59a	   3023: 	JMP 	CAL_CHN7_AD_ADD
3024			   
3025			   3025: CAL_CHN7_AD_MAX3:
3026	0x0595	0x780e	   3026: 	LDI 	TBR,			00H
3027	0x0596	0x3cb9	   3027: 	STA 	CHN7_RET0_BAK3,		01H
3028	0x0597	0x3cba	   3028: 	STA 	CHN7_RET1_BAK3,		01H
3029	0x0598	0x3cbb	   3029: 	STA 	CHN7_RET2_BAK3,		01H
3030	0x0599	0xe59a	   3030: 	JMP 	CAL_CHN7_AD_ADD
3031			   
3032			   3032: ;----------------------------
3033			   3033: ;计算总和并存放在CHN7_RET0_BAK3,CHN7_RET1_BAK3 和CHN7_RET2_BAK3（包括两个被清零的）
3034			   3034: CAL_CHN7_AD_ADD:
3035	0x059a	0x7840	   3035: 	LDI 	TEMP_SUM_CY,		00H
3036			   
3037			   3037: 	;D0 + D1
3038			   3038: 	;LDA 	CHN7_RET0_BAK0,		01H
3039			   3039: 	;ADDM 	CHN7_RET0_BAK1,		01H
3040	0x059b	0x38b1	   3040: 	LDA 	CHN7_RET1_BAK0,		01H
3041	0x059c	0x0cb4	   3041: 	ADDM 	CHN7_RET1_BAK1,		01H
3042	0x059d	0x38b2	   3042: 	LDA 	CHN7_RET2_BAK0,		01H
3043	0x059e	0x04b5	   3043: 	ADCM 	CHN7_RET2_BAK1,		01H
3044	0x059f	0x780e	   3044: 	LDI 	TBR,			00H
3045	0x05a0	0x0440	   3045: 	ADCM 	TEMP_SUM_CY
3046			   
3047			   3047: 	;+ D2
3048			   3048: 	;LDA 	CHN7_RET0_BAK1,		01H
3049			   3049: 	;ADDM 	CHN7_RET0_BAK2,		01H
3050	0x05a1	0x38b4	   3050: 	LDA 	CHN7_RET1_BAK1,		01H
3051	0x05a2	0x0cb7	   3051: 	ADDM 	CHN7_RET1_BAK2,		01H
3052	0x05a3	0x38b5	   3052: 	LDA 	CHN7_RET2_BAK1,		01H
3053	0x05a4	0x04b8	   3053: 	ADCM 	CHN7_RET2_BAK2,		01H
3054	0x05a5	0x780e	   3054: 	LDI 	TBR,			00H
3055	0x05a6	0x0440	   3055: 	ADCM 	TEMP_SUM_CY
3056			   
3057			   3057: 	;+ D3
3058			   3058: 	;LDA 	CHN7_RET0_BAK2,		01H
3059			   3059: 	;ADDM 	CHN7_RET0_BAK3,		01H
3060	0x05a7	0x38b7	   3060: 	LDA 	CHN7_RET1_BAK2,		01H
3061	0x05a8	0x0cba	   3061: 	ADDM 	CHN7_RET1_BAK3,		01H
3062	0x05a9	0x38b8	   3062: 	LDA 	CHN7_RET2_BAK2,		01H
3063	0x05aa	0x04bb	   3063: 	ADCM 	CHN7_RET2_BAK3,		01H
3064	0x05ab	0x780e	   3064: 	LDI 	TBR,			00H
3065	0x05ac	0x0440	   3065: 	ADCM 	TEMP_SUM_CY
3066			   
3067			   3067: ;----------------------------
3068			   3068: ;总和除以2，得到平均值，存放在CHN7_FINAL_RET0(),CHN7_FINAL_RET1 和CHN7_FINAL_RET2
3069			   3069: CAL_CHN7_AD_DIV:
3070			   3070: 	;LDA 	CHN7_RET0_BAK3,		01H
3071			   3071: 	;SHR
3072			   3072: 	;STA 	CHN7_RET0_BAK3,		01H
3073			   3073: 	
3074	0x05ad	0x38ba	   3074: 	LDA 	CHN7_RET1_BAK3,		01H
3075	0x05ae	0xf000	   3075: 	SHR
3076	0x05af	0x3cba	   3076: 	STA 	CHN7_RET1_BAK3,		01H
3077			   3077: 	
3078			   3078: 	;BNC 	$+3
3079			   3079: 	;LDI 	TBR,			0010B
3080			   3080: 	;ORM 	CHN7_RET0_BAK3
3081			   
3082	0x05b0	0x38bb	   3082: 	LDA 	CHN7_RET2_BAK3,		01H
3083	0x05b1	0xf000	   3083: 	SHR
3084	0x05b2	0x3cbb	   3084: 	STA 	CHN7_RET2_BAK3,		01H
3085			   3085: 	
3086	0x05b3	0x8db6	   3086: 	BNC 	$+3
3087	0x05b4	0x7c0e	   3087: 	LDI 	TBR,			1000B
3088	0x05b5	0x2cba	   3088: 	ORM 	CHN7_RET1_BAK3,		01H
3089			   
3090	0x05b6	0x3840	   3090: 	LDA 	TEMP_SUM_CY
3091	0x05b7	0xf000	   3091: 	SHR
3092	0x05b8	0x8dbb	   3092: 	BNC 	$+3
3093	0x05b9	0x7c0e	   3093: 	LDI 	TBR,			1000B
3094	0x05ba	0x2cbb	   3094: 	ORM 	CHN7_RET2_BAK3,		01H
3095			   
3096			   
3097			   3097: 	;LDA	CHN7_RET0_BAK3,		01H
3098			   3098: 	;STA	CHN7_FINAL_RET0,		01H
3099	0x05bb	0x38ba	   3099: 	LDA	CHN7_RET1_BAK3,		01H
3100	0x05bc	0x3cbd	   3100: 	STA	CHN7_FINAL_RET1,	01H
3101	0x05bd	0x38bb	   3101: 	LDA	CHN7_RET2_BAK3,		01H
3102	0x05be	0x3cbe	   3102: 	STA	CHN7_FINAL_RET2,	01H
3103			   
3104			   3104: ;----------------------------
3105			   3105: ;调整为CHN7_FINAL_RET0存放低4位，CHN7_FINAL_RET1存放中4位，CHN7_FINAL_RET2存放高2位
3106			   3106: 	;LDA 	CHN7_FINAL_RET1,		01H
3107			   3107: 	;SHR
3108			   3108: 	;STA 	CHN7_FINAL_RET1,		01H
3109			   
3110			   3110: 	;BNC 	$+3
3111			   3111: 	;LDI 	TBR,			0100B
3112			   3112: 	;ORM 	CHN7_FINAL_RET0,		01H
3113			   
3114			   3114: 	;LDA 	CHN7_FINAL_RET1,		01H
3115			   3115: 	;SHR
3116			   3116: 	;STA 	CHN7_FINAL_RET1,		
3117			   
3118			   3118: 	;BNC 	$+3
3119			   3119: 	;LDI 	TBR,			1000B
3120			   3120: 	;ORM 	CHN7_FINAL_RET0,		01H
3121			   
3122			   
3123			   3123: 	;LDA 	CHN7_FINAL_RET2,		01H
3124			   3124: 	;SHR
3125			   3125: 	;STA 	CHN7_FINAL_RET2,		01H	
3126			   
3127			   3127: 	;BNC 	$+3
3128			   3128: 	;LDI 	TBR,			0100B
3129			   3129: 	;ORM 	CHN7_FINAL_RET1,		01H
3130			   
3131			   3131: 	;LDA 	CHN7_FINAL_RET2,		01H
3132			   3132: 	;SHR
3133			   3133: 	;STA 	CHN7_FINAL_RET2,		01H	
3134			   
3135			   3135: 	;BNC 	$+3
3136			   3136: 	;LDI 	TBR,			1000B
3137			   3137: 	;ORM 	CHN7_FINAL_RET1,		01H
3138			   3138: 	
3139			   3139: ;----------------------------
3140			   3140: CAL_CHN7_ADCDATA_END:	
3141			   
3142	0x05bf	0xd400	   3142: 	RTNI
3143			   
3144			   3144: 	
3145			   3145: 	END
